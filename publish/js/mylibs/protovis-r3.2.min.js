var a;if(!Array.prototype.map){Array.prototype.map=function(h,l){for(var k=this.length,j=new Array(k),i=0;i<k;i++){if(i in this){j[i]=h.call(l,this[i],i,this)}}return j}}if(!Array.prototype.filter){Array.prototype.filter=function(i,n){for(var m=this.length,l=[],k=0;k<m;k++){if(k in this){var j=this[k];i.call(n,j,k,this)&&l.push(j)}}return l}}if(!Array.prototype.forEach){Array.prototype.forEach=function(g,j){for(var i=this.length>>>0,h=0;h<i;h++){h in this&&g.call(j,this[h],h,this)}}}if(!Array.prototype.reduce){Array.prototype.reduce=function(g,j){var i=this.length;if(!i&&arguments.length==1){throw new Error("reduce: empty array, no initial value")}var h=0;if(arguments.length<2){for(;;){if(h in this){j=this[h++];break}if(++h>=i){throw new Error("reduce: no values, no initial value")}}}for(;h<i;h++){if(h in this){j=g(j,this[h],h,this)}}return j}}var pv={};pv.version={major:3,minor:2};pv.identity=function(c){return c};pv.index=function(){return this.index};pv.child=function(){return this.childIndex};pv.parent=function(){return this.parent.index};pv.extend=function(d){function f(){}f.prototype=d.prototype||d;return new f};try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(k){for(var r=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),q,p,o=0,n="";q=r.exec(k);){q=q.index+q[0].length;if(k.charAt(q)!="{"){n+=k.substring(o,q)+"{return ";o=q;for(var m=0;m>=0&&q<k.length;q++){var l=k.charAt(q);switch(l){case'"':case"'":for(;++q<k.length&&(p=k.charAt(q))!=l;){p=="\\"&&q++}break;case"[":case"(":m++;break;case"]":case")":m--;break;case";":case",":m==0&&m--;break}}n+=pv.parse(k.substring(o,--q))+";}";o=q}r.lastIndex=q}n+=k.substring(o);return n}}pv.css=function(d,f){return window.getComputedStyle?window.getComputedStyle(d,null).getPropertyValue(f):d.currentStyle[f]};pv.error=function(c){typeof console=="undefined"?alert(c):console.error(c)};pv.listen=function(f,h,g){g=pv.listener(g);return f.addEventListener?f.addEventListener(h,g,false):f.attachEvent("on"+h,g)};pv.listener=function(c){return c.$listener||(c.$listener=function(b){try{pv.event=b;return c.call(this,b)}finally{delete pv.event}})};pv.ancestor=function(d,f){for(;f;){if(f==d){return true}f=f.parentNode}return false};pv.id=function(){var c=1;return function(){return c++}}();pv.functor=function(c){return typeof c=="function"?c:function(){return c}};pv.listen(window,"load",function(){for(pv.$={i:0,x:document.getElementsByTagName("script")};pv.$.i<pv.$.x.length;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis"){try{window.eval(pv.parse(pv.$.s.text))}catch(b){pv.error(b)}}}delete pv.$});pv.Format={};pv.Format.re=function(c){return c.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(f,h,g){h=h-String(g).length;return h<1?g:(new Array(h+1)).join(f)+g};pv.Format.date=function(f){function h(b){return f.replace(/%[a-zA-Z0-9]/g,function(c){switch(c){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][b.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][b.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][b.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][b.getMonth()];case"%c":return b.toLocaleString();case"%C":return g("0",2,Math.floor(b.getFullYear()/100)%100);case"%d":return g("0",2,b.getDate());case"%x":case"%D":return g("0",2,b.getMonth()+1)+"/"+g("0",2,b.getDate())+"/"+g("0",2,b.getFullYear()%100);case"%e":return g(" ",2,b.getDate());case"%H":return g("0",2,b.getHours());case"%I":return(c=b.getHours()%12)?g("0",2,c):12;case"%m":return g("0",2,b.getMonth()+1);case"%M":return g("0",2,b.getMinutes());case"%n":return"\n";case"%p":return b.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":c=b.getHours()%12;return(c?g("0",2,c):12)+":"+g("0",2,b.getMinutes())+":"+g("0",2,b.getSeconds())+" "+(b.getHours()<12?"AM":"PM");case"%R":return g("0",2,b.getHours())+":"+g("0",2,b.getMinutes());
case"%S":return g("0",2,b.getSeconds());case"%Q":return g("0",3,b.getMilliseconds());case"%t":return"\t";case"%u":return(c=b.getDay())?c:1;case"%w":return b.getDay();case"%y":return g("0",2,b.getFullYear()%100);case"%Y":return b.getFullYear();case"%%":return"%"}return c})}var g=pv.Format.pad;h.format=h;h.parse=function(t){var s=1970,r=0,p=1,n=0,d=0,m=0,b=[function(){}],c=pv.Format.re(f).replace(/%[a-zA-Z0-9]/g,function(i){switch(i){case"%b":b.push(function(j){r={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[j]});return"([A-Za-z]+)";case"%h":case"%B":b.push(function(j){r={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[j]});return"([A-Za-z]+)";case"%e":case"%d":b.push(function(j){p=j});return"([0-9]+)";case"%I":case"%H":b.push(function(j){n=j});return"([0-9]+)";case"%m":b.push(function(j){r=j-1});return"([0-9]+)";case"%M":b.push(function(j){d=j});return"([0-9]+)";case"%p":b.push(function(j){if(n==12){if(j=="am"){n=0}}else{if(j=="pm"){n=Number(n)+12}}});return"(am|pm)";case"%S":b.push(function(j){m=j});return"([0-9]+)";case"%y":b.push(function(j){j=Number(j);s=j+(0<=j&&j<69?2000:j>=69&&j<100?1900:0)});return"([0-9]+)";case"%Y":b.push(function(j){s=j});return"([0-9]+)";case"%%":b.push(function(){});return"%"}return i});(t=t.match(c))&&t.forEach(function(j,i){b[i](j)});return new Date(s,r,p,n,d,m)};return h};pv.Format.time=function(f){function h(j){j=Number(j);switch(f){case"short":if(j>=31536000000){return(j/31536000000).toFixed(1)+" years"}else{if(j>=604800000){return(j/604800000).toFixed(1)+" weeks"}else{if(j>=86400000){return(j/86400000).toFixed(1)+" days"}else{if(j>=3600000){return(j/3600000).toFixed(1)+" hours"}else{if(j>=60000){return(j/60000).toFixed(1)+" minutes"}}}}}return(j/1000).toFixed(1)+" seconds";case"long":var d=[],c=j%3600000/60000>>0;d.push(g("0",2,j%60000/1000>>0));if(j>=3600000){var b=j%86400000/3600000>>0;d.push(g("0",2,c));if(j>=86400000){d.push(g("0",2,b));d.push(Math.floor(j/86400000).toFixed())}else{d.push(b.toFixed())}}else{d.push(c.toFixed())}return d.reverse().join(":")}}var g=pv.Format.pad;h.format=h;h.parse=function(n){switch(f){case"short":for(var m=/([0-9,.]+)\s*([a-z]+)/g,k,d=0;k=m.exec(n);){var c=parseFloat(k[0].replace(",","")),b=0;switch(k[2].toLowerCase()){case"year":case"years":b=31536000000;break;case"week":case"weeks":b=604800000;break;case"day":case"days":b=86400000;break;case"hour":case"hours":b=3600000;break;case"minute":case"minutes":b=60000;break;case"second":case"seconds":b=1000;break}d+=c*b}return d;case"long":k=n.replace(",","").split(":").reverse();d=0;if(k.length){d+=parseFloat(k[0])*1000}if(k.length>1){d+=parseFloat(k[1])*60000}if(k.length>2){d+=parseFloat(k[2])*3600000}if(k.length>3){d+=parseFloat(k[3])*86400000}return d}};return h};pv.Format.number=function(){function z(d){if(Infinity>u){d=Math.round(d*t)/t}var b=String(Math.abs(d)).split("."),c=b[0];d=d<0?"-":"";if(c.length>x){c=c.substring(c.length-x)}if(r&&c.length<y){c=d+(new Array(y-c.length+1)).join(s)+c}if(c.length>3){c=c.replace(/\B(?=(?:\d{3})+(?!\d))/g,n)}if(!r&&c.length<w){c=(new Array(w-c.length+1)).join(s)+d+c}b[0]=c;c=b[1]||"";if(c.length<v){b[1]=c+(new Array(v-c.length+1)).join(p)}return b.join(m)}var y=0,x=Infinity,w=0,v=0,u=0,t=1,s="0",p="0",r=true,m=".",n=",";z.format=z;z.parse=function(c){var b=pv.Format.re;c=String(c).replace(new RegExp("^("+b(s)+")*"),"").replace(new RegExp("("+b(p)+")*$"),"").split(m);b=c[0].replace(new RegExp(b(n),"g"),"");if(b.length>x){b=b.substring(b.length-x)}c=c[1]?Number("0."+c[1]):0;if(Infinity>u){c=Math.round(c*t)/t}return Math.round(b)+c};z.integerDigits=function(c,b){if(arguments.length){y=Number(c);x=arguments.length>1?Number(b):y;w=y+Math.floor(y/3)*n.length;return this}return[y,x]};z.fractionDigits=function(c,b){if(arguments.length){v=Number(c);u=arguments.length>1?Number(b):v;t=Math.pow(10,u);return this}return[v,u]};z.integerPad=function(b){if(arguments.length){s=String(b);r=/\d/.test(s);
return this}return s};z.fractionPad=function(b){if(arguments.length){p=String(b);return this}return p};z.decimal=function(b){if(arguments.length){m=String(b);return this}return m};z.group=function(b){if(arguments.length){n=b?String(b):"";w=y+Math.floor(y/3)*n.length;return this}return n};return z};pv.map=function(f,h){var g={};return h?f.map(function(c,b){g.index=b;return h.call(g,c)}):f.slice()};pv.repeat=function(d,f){if(arguments.length==1){f=2}return pv.blend(pv.range(f).map(function(){return d}))};pv.cross=function(k,r){for(var q=[],p=0,o=k.length,n=r.length;p<o;p++){for(var m=0,l=k[p];m<n;m++){q.push([l,r[m]])}}return q};pv.blend=function(c){return Array.prototype.concat.apply([],c)};pv.transpose=function(i){var n=i.length,m=pv.max(i,function(b){return b.length});if(m>n){i.length=m;for(var l=n;l<m;l++){i[l]=new Array(n)}for(l=0;l<n;l++){for(var k=l+1;k<m;k++){var j=i[l][k];i[l][k]=i[k][l];i[k][l]=j}}}else{for(l=0;l<m;l++){i[l].length=n}for(l=0;l<n;l++){for(k=0;k<l;k++){j=i[l][k];i[l][k]=i[k][l];i[k][l]=j}}}i.length=m;for(l=0;l<m;l++){i[l].length=n}return i};pv.normalize=function(f,h){f=pv.map(f,h);h=pv.sum(f);for(var g=0;g<f.length;g++){f[g]/=h}return f};pv.permute=function(h,l,k){if(!k){k=pv.identity}var j=new Array(l.length),i={};l.forEach(function(c,b){i.index=c;j[b]=k.call(i,h[c])});return j};pv.numerate=function(g,j){if(!j){j=pv.identity}var i={},h={};g.forEach(function(c,b){h.index=b;i[j.call(h,c)]=b});return i};pv.uniq=function(i,n){if(!n){n=pv.identity}var m={},l=[],k={},j;i.forEach(function(c,b){k.index=b;j=n.call(k,c);j in m||(m[j]=l.push(j))});return l};pv.naturalOrder=function(d,f){return d<f?-1:d>f?1:0};pv.reverseOrder=function(d,f){return f<d?-1:f>d?1:0};pv.search=function(j,p,o){if(!o){o=pv.identity}for(var n=0,m=j.length-1;n<=m;){var l=n+m>>1,k=o(j[l]);if(k<p){n=l+1}else{if(k>p){m=l-1}else{return l}}}return -n-1};pv.search.index=function(f,h,g){f=pv.search(f,h,g);return f<0?-f-1:f};pv.range=function(i,n,m){if(arguments.length==1){n=i;i=0}if(m==undefined){m=1}if((n-i)/m==Infinity){throw new Error("range must be finite")}var l=[],k=0,j;if(m<0){for(;(j=i+m*k++)>n;){l.push(j)}}else{for(;(j=i+m*k++)<n;){l.push(j)}}return l};pv.random=function(f,h,g){if(arguments.length==1){h=f;f=0}if(g==undefined){g=1}return g?Math.floor(Math.random()*(h-f)/g)*g+f:Math.random()*(h-f)+f};pv.sum=function(f,h){var g={};return f.reduce(h?function(d,c,b){g.index=b;return d+h.call(g,c)}:function(c,b){return c+b},0)};pv.max=function(d,f){if(f==pv.index){return d.length-1}return Math.max.apply(null,f?pv.map(d,f):d)};pv.max.index=function(j,p){if(!j.length){return -1}if(p==pv.index){return j.length-1}if(!p){p=pv.identity}for(var o=0,n=-Infinity,m={},l=0;l<j.length;l++){m.index=l;var k=p.call(m,j[l]);if(k>n){n=k;o=l}}return o};pv.min=function(d,f){if(f==pv.index){return 0}return Math.min.apply(null,f?pv.map(d,f):d)};pv.min.index=function(j,p){if(!j.length){return -1}if(p==pv.index){return 0}if(!p){p=pv.identity}for(var o=0,n=Infinity,m={},l=0;l<j.length;l++){m.index=l;var k=p.call(m,j[l]);if(k<n){n=k;o=l}}return o};pv.mean=function(d,f){return pv.sum(d,f)/d.length};pv.median=function(d,f){if(f==pv.index){return(d.length-1)/2}d=pv.map(d,f).sort(pv.naturalOrder);if(d.length%2){return d[Math.floor(d.length/2)]}f=d.length/2;return(d[f-1]+d[f])/2};pv.variance=function(j,p){if(j.length<1){return NaN}if(j.length==1){return 0}var o=pv.mean(j,p),n=0,m={};if(!p){p=pv.identity}for(var l=0;l<j.length;l++){m.index=l;var k=p.call(m,j[l])-o;n+=k*k}return n};pv.deviation=function(d,f){return Math.sqrt(pv.variance(d,f)/(d.length-1))};pv.log=function(d,f){return Math.log(d)/Math.log(f)};pv.logSymmetric=function(d,f){return d==0?0:d<0?-pv.log(-d,f):pv.log(d,f)};pv.logAdjusted=function(f,h){if(!isFinite(f)){return f}var g=f<0;if(f<h){f+=(h-f)/h}return g?-pv.log(f,h):pv.log(f,h)};pv.logFloor=function(d,f){return d>0?Math.pow(f,Math.floor(pv.log(d,f))):-Math.pow(f,-Math.floor(-pv.log(-d,f)))};pv.logCeil=function(d,f){return d>0?Math.pow(f,Math.ceil(pv.log(d,f))):-Math.pow(f,-Math.ceil(-pv.log(-d,f)))
};(function(){var d=Math.PI/180,f=180/Math.PI;pv.radians=function(b){return d*b};pv.degrees=function(b){return f*b}})();pv.keys=function(f){var h=[];for(var g in f){h.push(g)}return h};pv.entries=function(f){var h=[];for(var g in f){h.push({key:g,value:f[g]})}return h};pv.values=function(f){var h=[];for(var g in f){h.push(f[g])}return h};pv.dict=function(i,n){for(var m={},l={},k=0;k<i.length;k++){if(k in i){var j=i[k];l.index=k;m[j]=n.call(l,j)}}return m};pv.dom=function(c){return new pv.Dom(c)};pv.Dom=function(c){this.$map=c};pv.Dom.prototype.$leaf=function(c){return typeof c!="object"};pv.Dom.prototype.leaf=function(c){if(arguments.length){this.$leaf=c;return this}return this.$leaf};pv.Dom.prototype.root=function(g){function j(f){var d=new pv.Dom.Node;for(var c in f){var b=f[c];d.appendChild(i(b)?new pv.Dom.Node(b):j(b)).nodeName=c}return d}var i=this.$leaf,h=j(this.$map);h.nodeName=g;return h};pv.Dom.prototype.nodes=function(){return this.root().nodes()};pv.Dom.Node=function(c){this.nodeValue=c;this.childNodes=[]};a=pv.Dom.Node.prototype;a.parentNode=null;a.firstChild=null;a.lastChild=null;a.previousSibling=null;a.nextSibling=null;a.removeChild=function(d){var f=this.childNodes.indexOf(d);if(f==-1){throw new Error("child not found")}this.childNodes.splice(f,1);if(d.previousSibling){d.previousSibling.nextSibling=d.nextSibling}else{this.firstChild=d.nextSibling}if(d.nextSibling){d.nextSibling.previousSibling=d.previousSibling}else{this.lastChild=d.previousSibling}delete d.nextSibling;delete d.previousSibling;delete d.parentNode;return d};a.appendChild=function(c){c.parentNode&&c.parentNode.removeChild(c);c.parentNode=this;if(c.previousSibling=this.lastChild){this.lastChild.nextSibling=c}else{this.firstChild=c}this.lastChild=c;this.childNodes.push(c);return c};a.insertBefore=function(f,h){if(!h){return this.appendChild(f)}var g=this.childNodes.indexOf(h);if(g==-1){throw new Error("child not found")}f.parentNode&&f.parentNode.removeChild(f);f.parentNode=this;f.nextSibling=h;if(f.previousSibling=h.previousSibling){h.previousSibling.nextSibling=f}else{if(h==this.lastChild){this.lastChild=f}this.firstChild=f}this.childNodes.splice(g,0,f);return f};a.replaceChild=function(f,h){var g=this.childNodes.indexOf(h);if(g==-1){throw new Error("child not found")}f.parentNode&&f.parentNode.removeChild(f);f.parentNode=this;f.nextSibling=h.nextSibling;if(f.previousSibling=h.previousSibling){h.previousSibling.nextSibling=f}else{this.firstChild=f}if(h.nextSibling){h.nextSibling.previousSibling=f}else{this.lastChild=f}this.childNodes[g]=f;return h};a.visitBefore=function(d){function f(c,b){d(c,b);for(c=c.firstChild;c;c=c.nextSibling){f(c,b+1)}}f(this,0)};a.visitAfter=function(d){function f(h,c){for(var b=h.firstChild;b;b=b.nextSibling){f(b,c+1)}d(h,c)}f(this,0)};a.sort=function(g){if(this.firstChild){this.childNodes.sort(g);var j=this.firstChild=this.childNodes[0],i;delete j.previousSibling;for(var h=1;h<this.childNodes.length;h++){j.sort(g);i=this.childNodes[h];i.previousSibling=j;j=j.nextSibling=i}this.lastChild=j;delete j.nextSibling;j.sort(g)}return this};a.reverse=function(){var c=[];this.visitAfter(function(f){for(;f.lastChild;){c.push(f.removeChild(f.lastChild))}for(var b;b=c.pop();){f.insertBefore(b,f.firstChild)}});return this};a.nodes=function(){function d(b){f.push(b);b.childNodes.forEach(d)}var f=[];d(this,f);return f};a.toggle=function(d){if(d){return this.toggled?this.visitBefore(function(b){b.toggled&&b.toggle()}):this.visitAfter(function(b){b.toggled||b.toggle()})}d=this;if(d.toggled){for(var f;f=d.toggled.pop();){d.appendChild(f)}delete d.toggled}else{if(d.lastChild){for(d.toggled=[];d.lastChild;){d.toggled.push(d.removeChild(d.lastChild))}}}};pv.nodes=function(f){for(var h=new pv.Dom.Node,g=0;g<f.length;g++){h.appendChild(new pv.Dom.Node(f[g]))}return h.nodes()};pv.tree=function(c){return new pv.Tree(c)};pv.Tree=function(c){this.array=c};pv.Tree.prototype.keys=function(c){this.k=c;return this};pv.Tree.prototype.value=function(c){this.v=c;
return this};pv.Tree.prototype.map=function(){for(var j={},p={},o=0;o<this.array.length;o++){p.index=o;for(var n=this.array[o],m=this.k.call(p,n),l=j,k=0;k<m.length-1;k++){l=l[m[k]]||(l[m[k]]={})}l[m[k]]=this.v?this.v.call(p,n):n}return j};pv.nest=function(c){return new pv.Nest(c)};pv.Nest=function(c){this.array=c;this.keys=[]};a=pv.Nest.prototype;a.key=function(c){this.keys.push(c);return this};a.sortKeys=function(c){this.keys[this.keys.length-1].order=c||pv.naturalOrder;return this};a.sortValues=function(c){this.order=c||pv.naturalOrder;return this};a.map=function(){for(var j={},p=[],o,n=0;n<this.array.length;n++){var m=this.array[n],l=j;for(o=0;o<this.keys.length-1;o++){var k=this.keys[o](m);l[k]||(l[k]={});l=l[k]}k=this.keys[o](m);if(!l[k]){o=[];p.push(o);l[k]=o}l[k].push(m)}if(this.order){for(o=0;o<p.length;o++){p[o].sort(this.order)}}return j};a.entries=function(){function d(j){var i=[];for(var c in j){var b=j[c];i.push({key:c,values:b instanceof Array?b:d(b)})}return i}function f(j,i){var c=this.keys[i].order;c&&j.sort(function(h,g){return c(h.key,g.key)});if(++i<this.keys.length){for(var b=0;b<j.length;b++){f.call(this,j[b].values,i)}}return j}return f.call(this,d(this.map()),0)};a.rollup=function(d){function f(h){for(var c in h){var b=h[c];if(b instanceof Array){h[c]=d(b)}else{f(b)}}return h}return f(this.map())};pv.flatten=function(c){return new pv.Flatten(c)};pv.Flatten=function(c){this.map=c;this.keys=[]};pv.Flatten.prototype.key=function(d,f){this.keys.push({name:d,value:f});delete this.$leaf;return this};pv.Flatten.prototype.leaf=function(c){this.keys.length=0;this.$leaf=c;return this};pv.Flatten.prototype.array=function(){function i(d,c){if(c<l.length-1){for(var b in d){m.push(b);i(d[b],c+1);m.pop()}}else{n.push(m.concat(d))}}var n=[],m=[],l=this.keys,k=this.$leaf;if(k){function j(d,c){if(k(d)){n.push({keys:m.slice(),value:d})}else{for(var b in d){m.push(b);j(d[b],c+1);m.pop()}}}j(this.map,0);return n}i(this.map,0);return n.map(function(f){for(var d={},b=0;b<l.length;b++){var c=l[b],g=f[b];d[c.name]=c.value?c.value.call(null,g):g}return d})};pv.vector=function(d,f){return new pv.Vector(d,f)};pv.Vector=function(d,f){this.x=d;this.y=f};a=pv.Vector.prototype;a.perp=function(){return new pv.Vector(-this.y,this.x)};a.norm=function(){var c=this.length();return this.times(c?1/c:1)};a.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.times=function(c){return new pv.Vector(this.x*c,this.y*c)};a.plus=function(d,f){return arguments.length==1?new pv.Vector(this.x+d.x,this.y+d.y):new pv.Vector(this.x+d,this.y+f)};a.minus=function(d,f){return arguments.length==1?new pv.Vector(this.x-d.x,this.y-d.y):new pv.Vector(this.x-d,this.y-f)};a.dot=function(d,f){return arguments.length==1?this.x*d.x+this.y*d.y:this.x*d+this.y*f};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform;pv.Transform.prototype.translate=function(f,h){var g=new pv.Transform;g.k=this.k;g.x=this.k*f+this.x;g.y=this.k*h+this.y;return g};pv.Transform.prototype.scale=function(d){var f=new pv.Transform;f.k=this.k*d;f.x=this.x;f.y=this.y;return f};pv.Transform.prototype.invert=function(){var d=new pv.Transform,f=1/this.k;d.k=f;d.x=-this.x*f;d.y=-this.y*f;return d};pv.Transform.prototype.times=function(d){var f=new pv.Transform;f.k=this.k*d.k;f.x=this.k*d.x+this.x;f.y=this.k*d.y+this.y;return f};pv.Scale=function(){};pv.Scale.interpolator=function(d,f){if(typeof d=="number"){return function(b){return b*(f-d)+d}}d=pv.color(d).rgb();f=pv.color(f).rgb();return function(c){var b=d.a*(1-c)+f.a*c;if(b<0.00001){b=0}return d.a==0?pv.rgb(f.r,f.g,f.b,b):f.a==0?pv.rgb(d.r,d.g,d.b,b):pv.rgb(Math.round(d.r*(1-c)+f.r*c),Math.round(d.g*(1-c)+f.g*c),Math.round(d.b*(1-c)+f.b*c),b)}};pv.Scale.quantitative=function(){function x(b){return new Date(b)}function w(b){var c=pv.search(v,b);if(c<0){c=-c-2}c=Math.max(0,Math.min(s.length-1,c));return s[c]((n(b)-u[c])/(u[c+1]-u[c]))}var v=[0,1],u=[0,1],t=[0,1],s=[pv.identity],r=Number,p=false,n=pv.identity,o=pv.identity,m=String;
w.transform=function(b,c){n=function(d){return p?-b(-d):b(d)};o=function(d){return p?-c(-d):c(d)};u=v.map(n);return this};w.domain=function(d,f,b){if(arguments.length){var c;if(d instanceof Array){if(arguments.length<2){f=pv.identity}if(arguments.length<3){b=f}c=d.length&&f(d[0]);v=d.length?[pv.min(d,f),pv.max(d,b)]:[]}else{c=d;v=Array.prototype.slice.call(arguments).map(Number)}if(v.length){if(v.length==1){v=[v[0],v[0]]}}else{v=[-Infinity,Infinity]}p=(v[0]||v[v.length-1])<0;u=v.map(n);r=c instanceof Date?x:Number;return this}return v.map(r)};w.range=function(){if(arguments.length){t=Array.prototype.slice.call(arguments);if(t.length){if(t.length==1){t=[t[0],t[0]]}}else{t=[-Infinity,Infinity]}s=[];for(var b=0;b<t.length-1;b++){s.push(pv.Scale.interpolator(t[b],t[b+1]))}return this}return t};w.invert=function(b){var c=pv.search(t,b);if(c<0){c=-c-2}c=Math.max(0,Math.min(s.length-1,c));return r(o(u[c]+(b-t[c])/(t[c+1]-t[c])*(u[c+1]-u[c])))};w.ticks=function(d){var f=v[0],g=v[v.length-1],b=g<f,l=b?g:f;g=b?f:g;var j=g-l;if(!j||!isFinite(j)){if(r==x){m=pv.Format.date("%x")}return[r(l)]}if(r==x){function h(q,z){switch(z){case 31536000000:q.setMonth(0);case 2592000000:q.setDate(1);case 604800000:z==604800000&&q.setDate(q.getDate()-q.getDay());case 86400000:q.setHours(0);case 3600000:q.setMinutes(0);case 60000:q.setSeconds(0);case 1000:q.setMilliseconds(0)}}var k,c,i=1;if(j>=94608000000){f=31536000000;k="%Y";c=function(q){q.setFullYear(q.getFullYear()+i)}}else{if(j>=7776000000){f=2592000000;k="%m/%Y";c=function(q){q.setMonth(q.getMonth()+i)}}else{if(j>=1814400000){f=604800000;k="%m/%d";c=function(q){q.setDate(q.getDate()+7*i)}}else{if(j>=259200000){f=86400000;k="%m/%d";c=function(q){q.setDate(q.getDate()+i)}}else{if(j>=10800000){f=3600000;k="%I:%M %p";c=function(q){q.setHours(q.getHours()+i)}}else{if(j>=180000){f=60000;k="%I:%M %p";c=function(q){q.setMinutes(q.getMinutes()+i)}}else{if(j>=3000){f=1000;k="%I:%M:%S";c=function(q){q.setSeconds(q.getSeconds()+i)}}else{f=1;k="%S.%Qs";c=function(q){q.setTime(q.getTime()+i)}}}}}}}}m=pv.Format.date(k);l=new Date(l);k=[];h(l,f);j=j/f;if(j>10){switch(f){case 3600000:i=j>20?6:3;l.setHours(Math.floor(l.getHours()/i)*i);break;case 2592000000:i=3;l.setMonth(Math.floor(l.getMonth()/i)*i);break;case 60000:i=j>30?15:j>15?10:5;l.setMinutes(Math.floor(l.getMinutes()/i)*i);break;case 1000:i=j>90?15:j>60?10:5;l.setSeconds(Math.floor(l.getSeconds()/i)*i);break;case 1:i=j>1000?250:j>200?100:j>100?50:j>50?25:5;l.setMilliseconds(Math.floor(l.getMilliseconds()/i)*i);break;default:i=pv.logCeil(j/15,10);if(j/i<2){i/=5}else{if(j/i<5){i/=2}}l.setFullYear(Math.floor(l.getFullYear()/i)*i);break}}for(;;){c(l);if(l>g){break}k.push(new Date(l))}return b?k.reverse():k}arguments.length||(d=10);i=pv.logFloor(j/d,10);f=d/(j/i);if(f<=0.15){i*=10}else{if(f<=0.35){i*=5}else{if(f<=0.75){i*=2}}}f=Math.ceil(l/i)*i;g=Math.floor(g/i)*i;m=pv.Format.number().fractionDigits(Math.max(0,-Math.floor(pv.log(i,10)+0.01)));g=pv.range(f,g+i,i);return b?g.reverse():g};w.tickFormat=function(b){return m(b)};w.nice=function(){if(v.length!=2){return this}var d=v[0],f=v[v.length-1],b=f<d,c=b?f:d;d=b?d:f;f=d-c;if(!f||!isFinite(f)){return this}f=Math.pow(10,Math.round(Math.log(f)/Math.log(10))-1);v=[Math.floor(c/f)*f,Math.ceil(d/f)*f];b&&v.reverse();u=v.map(n);return this};w.by=function(c){function d(){return w(c.apply(this,arguments))}for(var b in w){d[b]=w[b]}return d};w.domain.apply(w,arguments);return w};pv.Scale.linear=function(){var c=pv.Scale.quantitative();c.domain.apply(c,arguments);return c};pv.Scale.log=function(){var h=pv.Scale.quantitative(1,10),l,k,j=function(b){return Math.log(b)/k},i=function(b){return Math.pow(l,b)};h.ticks=function(){var g=h.domain(),f=g[0]<0,d=Math.floor(f?-j(-g[0]):j(g[0])),b=Math.ceil(f?-j(-g[1]):j(g[1])),c=[];if(f){for(c.push(-i(-d));d++<b;){for(f=l-1;f>0;f--){c.push(-i(-d)*f)}}}else{for(;d<b;d++){for(f=1;f<l;f++){c.push(i(d)*f)}}c.push(i(d))}for(d=0;c[d]<g[0];d++){}for(b=c.length;c[b-1]>g[1];b--){}return c.slice(d,b)
};h.tickFormat=function(b){return b.toPrecision(1)};h.nice=function(){var b=h.domain();return h.domain(pv.logFloor(b[0],l),pv.logCeil(b[1],l))};h.base=function(b){if(arguments.length){l=Number(b);k=Math.log(l);h.transform(j,i);return this}return l};h.domain.apply(h,arguments);return h.base(10)};pv.Scale.root=function(){var c=pv.Scale.quantitative();c.power=function(h){if(arguments.length){var g=Number(h),b=1/g;c.transform(function(d){return Math.pow(d,b)},function(d){return Math.pow(d,g)});return this}return g};c.domain.apply(c,arguments);return c.power(2)};pv.Scale.ordinal=function(){function g(b){b in i||(i[b]=j.push(b)-1);return h[i[b]%h.length]}var j=[],i={},h=[];g.domain=function(k,f){if(arguments.length){k=k instanceof Array?arguments.length>1?pv.map(k,f):k:Array.prototype.slice.call(arguments);j=[];for(var d={},c=0;c<k.length;c++){var b=k[c];if(!(b in d)){d[b]=true;j.push(b)}}i=pv.numerate(j);return this}return j};g.range=function(c,b){if(arguments.length){h=c instanceof Array?arguments.length>1?pv.map(c,b):c:Array.prototype.slice.call(arguments);if(typeof h[0]=="string"){h=h.map(pv.color)}return this}return h};g.split=function(d,c){var b=(c-d)/this.domain().length;h=pv.range(d+b/2,c,b);return this};g.splitFlush=function(f,d){var c=this.domain().length,b=(d-f)/(c-1);h=c==1?[(f+d)/2]:pv.range(f,d+b/2,b);return this};g.splitBanded=function(f,d,c){if(arguments.length<3){c=1}if(c<0){var b=this.domain().length;b=(d-f- -c*b)/(b+1);h=pv.range(f+b,d,b-c);h.band=-c}else{b=(d-f)/(this.domain().length+(1-c));h=pv.range(f+b*(1-c),d,b);h.band=b*c}return this};g.by=function(d){function c(){return g(d.apply(this,arguments))}for(var b in g){c[b]=g[b]}return c};g.domain.apply(g,arguments);return g};pv.Scale.quantile=function(){function i(b){return j(Math.max(0,Math.min(m,pv.search.index(l,b)-1))/m)}var n=-1,m=-1,l=[],k=[],j=pv.Scale.linear();i.quantiles=function(c){if(arguments.length){n=Number(c);if(n<0){l=[k[0]].concat(k);m=k.length-1}else{l=[];l[0]=k[0];for(var b=1;b<=n;b++){l[b]=k[~~(b*(k.length-1)/n)]}m=n-1}return this}return l};i.domain=function(c,b){if(arguments.length){k=c instanceof Array?pv.map(c,b):Array.prototype.slice.call(arguments);k.sort(pv.naturalOrder);i.quantiles(n);return this}return k};i.range=function(){if(arguments.length){j.range.apply(j,arguments);return this}return j.range()};i.by=function(d){function c(){return i(d.apply(this,arguments))}for(var b in i){c[b]=i[b]}return c};i.domain.apply(i,arguments);return i};pv.histogram=function(f,h){var g=true;return{bins:function(l){var k=pv.map(f,h),d=[];arguments.length||(l=pv.Scale.linear(k).ticks());for(var c=0;c<l.length-1;c++){var b=d[c]=[];b.x=l[c];b.dx=l[c+1]-l[c];b.y=0}for(c=0;c<k.length;c++){b=pv.search.index(l,k[c])-1;b=d[Math.max(0,Math.min(d.length-1,b))];b.y++;b.push(f[c])}if(!g){for(c=0;c<d.length;c++){d[c].y/=k.length}}return d},frequency:function(b){if(arguments.length){g=Boolean(b);return this}return g}}};pv.color=function(k){if(k.rgb){return k.rgb()}var r=/([a-z]+)\((.*)\)/i.exec(k);if(r){var q=r[2].split(","),p=1;switch(r[1]){case"hsla":case"rgba":p=parseFloat(q[3]);if(!p){return pv.Color.transparent}break}switch(r[1]){case"hsla":case"hsl":k=parseFloat(q[0]);var o=parseFloat(q[1])/100;q=parseFloat(q[2])/100;return(new pv.Color.Hsl(k,o,q,p)).rgb();case"rgba":case"rgb":function n(b){var c=parseFloat(b);return b[b.length-1]=="%"?Math.round(c*2.55):c}o=n(q[0]);var m=n(q[1]),l=n(q[2]);return pv.rgb(o,m,l,p)}}if(p=pv.Color.names[k]){return p}if(k.charAt(0)=="#"){if(k.length==4){o=k.charAt(1);o+=o;m=k.charAt(2);m+=m;l=k.charAt(3);l+=l}else{if(k.length==7){o=k.substring(1,3);m=k.substring(3,5);l=k.substring(5,7)}}return pv.rgb(parseInt(o,16),parseInt(m,16),parseInt(l,16),1)}return new pv.Color(k,1)};pv.Color=function(d,f){this.color=d;this.opacity=f};pv.Color.prototype.brighter=function(c){return this.rgb().brighter(c)};pv.Color.prototype.darker=function(c){return this.rgb().darker(c)};pv.rgb=function(g,j,i,h){return new pv.Color.Rgb(g,j,i,arguments.length==4?h:1)
};pv.Color.Rgb=function(g,j,i,h){pv.Color.call(this,h?"rgb("+g+","+j+","+i+")":"none",h);this.r=g;this.g=j;this.b=i;this.a=h};pv.Color.Rgb.prototype=pv.extend(pv.Color);a=pv.Color.Rgb.prototype;a.red=function(c){return pv.rgb(c,this.g,this.b,this.a)};a.green=function(c){return pv.rgb(this.r,c,this.b,this.a)};a.blue=function(c){return pv.rgb(this.r,this.g,c,this.a)};a.alpha=function(c){return pv.rgb(this.r,this.g,this.b,c)};a.rgb=function(){return this};a.brighter=function(g){g=Math.pow(0.7,arguments.length?g:1);var j=this.r,i=this.g,h=this.b;if(!j&&!i&&!h){return pv.rgb(30,30,30,this.a)}if(j&&j<30){j=30}if(i&&i<30){i=30}if(h&&h<30){h=30}return pv.rgb(Math.min(255,Math.floor(j/g)),Math.min(255,Math.floor(i/g)),Math.min(255,Math.floor(h/g)),this.a)};a.darker=function(c){c=Math.pow(0.7,arguments.length?c:1);return pv.rgb(Math.max(0,Math.floor(c*this.r)),Math.max(0,Math.floor(c*this.g)),Math.max(0,Math.floor(c*this.b)),this.a)};pv.hsl=function(g,j,i,h){return new pv.Color.Hsl(g,j,i,arguments.length==4?h:1)};pv.Color.Hsl=function(g,j,i,h){pv.Color.call(this,"hsl("+g+","+j*100+"%,"+i*100+"%)",h);this.h=g;this.s=j;this.l=i;this.a=h};pv.Color.Hsl.prototype=pv.extend(pv.Color);a=pv.Color.Hsl.prototype;a.hue=function(c){return pv.hsl(c,this.s,this.l,this.a)};a.saturation=function(c){return pv.hsl(this.h,c,this.l,this.a)};a.lightness=function(c){return pv.hsl(this.h,this.s,c,this.a)};a.alpha=function(c){return pv.hsl(this.h,this.s,this.l,c)};a.rgb=function(){function j(b){if(b>360){b-=360}else{if(b<0){b+=360}}if(b<60){return k+(l-k)*b/60}if(b<180){return l}if(b<240){return k+(l-k)*(240-b)/60}return k}function p(b){return Math.round(j(b)*255)}var o=this.h,n=this.s,m=this.l;o%=360;if(o<0){o+=360}n=Math.max(0,Math.min(n,1));m=Math.max(0,Math.min(m,1));var l=m<=0.5?m*(1+n):m+n-m*n,k=2*m-l;return pv.rgb(p(o+120),p(o),p(o-120),this.a)};pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};
(function(){var d=pv.Color.names;for(var f in d){d[f]=pv.color(d[f])}})();pv.colors=function(){var c=pv.Scale.ordinal();c.range.apply(c,arguments);return c};pv.Colors={};pv.Colors.category10=function(){var c=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");c.domain.apply(c,arguments);return c};pv.Colors.category20=function(){var c=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");c.domain.apply(c,arguments);return c};pv.Colors.category19=function(){var c=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");c.domain.apply(c,arguments);return c};pv.ramp=function(){var c=pv.Scale.linear();c.range.apply(c,arguments);return c};pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter"},css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(g){if(g.length&&g[0].reverse&&g.type!="line"&&g.type!="area"){for(var j=pv.extend(g),i=0,h=g.length-1;h>=0;i++,h--){j[i]=g[h]}g=j}this.removeSiblings(this[g.type](g))};pv.SvgScene.create=function(c){return document.createElementNS(this.svg,c)};pv.SvgScene.expect=function(h,l,k,j){if(h){if(h.tagName=="a"){h=h.firstChild}if(h.tagName!=l){l=this.create(l);h.parentNode.replaceChild(l,h);h=l}}else{h=this.create(l)}for(var i in k){l=k[i];if(l==this.implicit.svg[i]){l=null}l==null?h.removeAttribute(i):h.setAttribute(i,l)}for(i in j){l=j[i];if(l==this.implicit.css[i]){l=null}if(l==null){h.style.removeProperty(i)}else{h.style[i]=l}}return h};pv.SvgScene.append=function(f,h,g){f.$scene={scenes:h,index:g};f=this.title(f,h[g]);f.parentNode||h.$g.appendChild(f);return f.nextSibling};pv.SvgScene.title=function(f,h){var g=f.parentNode;if(g&&g.tagName!="a"){g=null}if(h.title){if(!g){g=this.create("a");f.parentNode&&f.parentNode.replaceChild(g,f);g.appendChild(f)}g.setAttributeNS(this.xlink,"title",h.title);return g}g&&g.parentNode.replaceChild(f,g);return f};pv.SvgScene.dispatch=pv.listener(function(f){var h=f.target.$scene;if(h){var g=f.type;switch(g){case"DOMMouseScroll":g="mousewheel";f.wheel=-480*f.detail;break;case"mousewheel":f.wheel=(window.opera?12:1)*f.wheelDelta;break}pv.Mark.dispatch(g,h.scenes,h.index)&&f.preventDefault()}});pv.SvgScene.removeSiblings=function(d){for(;d;){var f=d.nextSibling;d.parentNode.removeChild(d);d=f}};pv.SvgScene.undefined=function(){};pv.SvgScene.pathBasis=function(){function f(l,k,d,c,b){return{x:l[0]*k.left+l[1]*d.left+l[2]*c.left+l[3]*b.left,y:l[0]*k.top+l[1]*d.top+l[2]*c.top+l[3]*b.top}}var h=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]],g=function(n,m,k,d){var c=f(h[1],n,m,k,d),b=f(h[2],n,m,k,d);n=f(h[3],n,m,k,d);return"C"+c.x+","+c.y+","+b.x+","+b.y+","+n.x+","+n.y};g.segment=function(p,o,n,m){var d=f(h[0],p,o,n,m),b=f(h[1],p,o,n,m),c=f(h[2],p,o,n,m);p=f(h[3],p,o,n,m);return"M"+d.x+","+d.y+"C"+b.x+","+b.y+","+c.x+","+c.y+","+p.x+","+p.y};return g}();pv.SvgScene.curveBasis=function(j){if(j.length<=2){return""}var p="",o=j[0],n=o,m=o,l=j[1];p+=this.pathBasis(o,n,m,l);for(var k=2;k<j.length;k++){o=n;n=m;m=l;l=j[k];p+=this.pathBasis(o,n,m,l)}p+=this.pathBasis(n,m,l,l);p+=this.pathBasis(m,l,l,l);return p};pv.SvgScene.curveBasisSegments=function(j){if(j.length<=2){return""}var p=[],o=j[0],n=o,m=o,l=j[1],k=this.pathBasis.segment(o,n,m,l);
o=n;n=m;m=l;l=j[2];p.push(k+this.pathBasis(o,n,m,l));for(k=3;k<j.length;k++){o=n;n=m;m=l;l=j[k];p.push(this.pathBasis.segment(o,n,m,l))}p.push(this.pathBasis.segment(n,m,l,l)+this.pathBasis(m,l,l,l));return p};pv.SvgScene.curveHermite=function(t,s){if(s.length<1||t.length!=s.length&&t.length!=s.length+2){return""}var r=t.length!=s.length,q="",p=t[0],o=t[1],n=s[0],m=n,k=1;if(r){q+="Q"+(o.left-n.x*2/3)+","+(o.top-n.y*2/3)+","+o.left+","+o.top;p=t[1];k=2}if(s.length>1){m=s[1];o=t[k];k++;q+="C"+(p.left+n.x)+","+(p.top+n.y)+","+(o.left-m.x)+","+(o.top-m.y)+","+o.left+","+o.top;for(p=2;p<s.length;p++,k++){o=t[k];m=s[p];q+="S"+(o.left-m.x)+","+(o.top-m.y)+","+o.left+","+o.top}}if(r){t=t[k];q+="Q"+(o.left+m.x*2/3)+","+(o.top+m.y*2/3)+","+t.left+","+t.top}return q};pv.SvgScene.curveHermiteSegments=function(v,u){if(u.length<1||v.length!=u.length&&v.length!=u.length+2){return[]}var t=v.length!=u.length,s=[],r=v[0],q=r,p=u[0],o=p,m=1;if(t){q=v[1];s.push("M"+r.left+","+r.top+"Q"+(q.left-o.x*2/3)+","+(q.top-o.y*2/3)+","+q.left+","+q.top);m=2}for(var n=1;n<u.length;n++,m++){r=q;p=o;q=v[m];o=u[n];s.push("M"+r.left+","+r.top+"C"+(r.left+p.x)+","+(r.top+p.y)+","+(q.left-o.x)+","+(q.top-o.y)+","+q.left+","+q.top)}if(t){v=v[m];s.push("M"+q.left+","+q.top+"Q"+(q.left+o.x*2/3)+","+(q.top+o.y*2/3)+","+v.left+","+v.top)}return s};pv.SvgScene.cardinalTangents=function(j,p){var o=[];p=(1-p)/2;for(var n=j[0],m=j[1],l=j[2],k=3;k<j.length;k++){o.push({x:p*(l.left-n.left),y:p*(l.top-n.top)});n=m;m=l;l=j[k]}o.push({x:p*(l.left-n.left),y:p*(l.top-n.top)});return o};pv.SvgScene.curveCardinal=function(d,f){if(d.length<=2){return""}return this.curveHermite(d,this.cardinalTangents(d,f))};pv.SvgScene.curveCardinalSegments=function(d,f){if(d.length<=2){return""}return this.curveHermiteSegments(d,this.cardinalTangents(d,f))};pv.SvgScene.monotoneTangents=function(t){var s=[],r=[],q=[],p=[],o=0;for(o=0;o<t.length-1;o++){r[o]=(t[o+1].top-t[o].top)/(t[o+1].left-t[o].left)}q[0]=r[0];p[0]=t[1].left-t[0].left;for(o=1;o<t.length-1;o++){q[o]=(r[o-1]+r[o])/2;p[o]=(t[o+1].left-t[o-1].left)/2}q[o]=r[o-1];p[o]=t[o].left-t[o-1].left;for(o=0;o<t.length-1;o++){if(r[o]==0){q[o]=0;q[o+1]=0}}for(o=0;o<t.length-1;o++){if(!(Math.abs(q[o])<0.00001||Math.abs(q[o+1])<0.00001)){var n=q[o]/r[o],m=q[o+1]/r[o],k=n*n+m*m;if(k>9){k=3/Math.sqrt(k);q[o]=k*n*r[o];q[o+1]=k*m*r[o]}}}for(o=0;o<t.length;o++){r=1+q[o]*q[o];s.push({x:p[o]/3/r,y:q[o]*p[o]/3/r})}return s};pv.SvgScene.curveMonotone=function(c){if(c.length<=2){return""}return this.curveHermite(c,this.monotoneTangents(c))};pv.SvgScene.curveMonotoneSegments=function(c){if(c.length<=2){return""}return this.curveHermiteSegments(c,this.monotoneTangents(c))};pv.SvgScene.area=function(x){function w(d,f){for(var g=[],b=[],k=f;d<=k;d++,f--){var i=x[d],h=x[f];i=i.left+","+i.top;h=h.left+h.width+","+(h.top+h.height);if(d<k){var j=x[d+1],c=x[f-1];switch(t.interpolate){case"step-before":i+="V"+j.top;h+="H"+(c.left+c.width);break;case"step-after":i+="H"+j.left;h+="V"+(c.top+c.height);break}}g.push(i);b.push(h)}return g.concat(b).join("L")}function v(g,h){for(var b=[],f=[],d=h;g<=d;g++,h--){var c=x[h];b.push(x[g]);f.push({left:c.left+c.width,top:c.top+c.height})}if(t.interpolate=="basis"){g=pv.SvgScene.curveBasis(b);h=pv.SvgScene.curveBasis(f)}else{if(t.interpolate=="cardinal"){g=pv.SvgScene.curveCardinal(b,t.tension);h=pv.SvgScene.curveCardinal(f,t.tension)}else{g=pv.SvgScene.curveMonotone(b);h=pv.SvgScene.curveMonotone(f)}}return b[0].left+","+b[0].top+g+"L"+f[0].left+","+f[0].top+h}var u=x.$g.firstChild;if(!x.length){return u}var t=x[0];if(t.segmented){return this.areaSegment(x)}if(!t.visible){return u}var s=t.fillStyle,r=t.strokeStyle;if(!s.opacity&&!r.opacity){return u}for(var p=[],n,o=0;o<x.length;o++){n=x[o];if(n.width||n.height){for(var m=o+1;m<x.length;m++){n=x[m];if(!n.width&&!n.height){break}}o&&t.interpolate!="step-after"&&o--;m<x.length&&t.interpolate!="step-before"&&m++;p.push((m-o>2&&(t.interpolate=="basis"||t.interpolate=="cardinal"||t.interpolate=="monotone")?v:w)(o,m-1));
o=m-1}}if(!p.length){return u}u=this.expect(u,"path",{"shape-rendering":t.antialias?null:"crispEdges","pointer-events":t.events,cursor:t.cursor,d:"M"+p.join("ZM")+"Z",fill:s.color,"fill-opacity":s.opacity||null,stroke:r.color,"stroke-opacity":r.opacity||null,"stroke-width":r.opacity?t.lineWidth/this.scale:null});return this.append(u,x,0)};pv.SvgScene.areaSegment=function(z){var y=z.$g.firstChild,x=z[0],w,v;if(x.interpolate=="basis"||x.interpolate=="cardinal"||x.interpolate=="monotone"){w=[];v=[];for(var u=0,t=z.length;u<t;u++){var s=z[t-u-1];w.push(z[u]);v.push({left:s.left+s.width,top:s.top+s.height})}if(x.interpolate=="basis"){w=this.curveBasisSegments(w);v=this.curveBasisSegments(v)}else{if(x.interpolate=="cardinal"){w=this.curveCardinalSegments(w,x.tension);v=this.curveCardinalSegments(v,x.tension)}else{w=this.curveMonotoneSegments(w);v=this.curveMonotoneSegments(v)}}}u=0;for(t=z.length-1;u<t;u++){x=z[u];var p=z[u+1];if(x.visible&&p.visible){var r=x.fillStyle,m=x.strokeStyle;if(r.opacity||m.opacity){if(w){s=w[u];p="L"+v[t-u-1].substr(1);s=s+p+"Z"}else{var n=x;s=p;switch(x.interpolate){case"step-before":n=p;break;case"step-after":s=x;break}s="M"+x.left+","+n.top+"L"+p.left+","+s.top+"L"+(p.left+p.width)+","+(s.top+s.height)+"L"+(x.left+x.width)+","+(n.top+n.height)+"Z"}y=this.expect(y,"path",{"shape-rendering":x.antialias?null:"crispEdges","pointer-events":x.events,cursor:x.cursor,d:s,fill:r.color,"fill-opacity":r.opacity||null,stroke:m.color,"stroke-opacity":m.opacity||null,"stroke-width":m.opacity?x.lineWidth/this.scale:null});y=this.append(y,z,u)}}}return y};pv.SvgScene.bar=function(i){for(var n=i.$g.firstChild,m=0;m<i.length;m++){var l=i[m];if(l.visible){var k=l.fillStyle,j=l.strokeStyle;if(k.opacity||j.opacity){n=this.expect(n,"rect",{"shape-rendering":l.antialias?null:"crispEdges","pointer-events":l.events,cursor:l.cursor,x:l.left,y:l.top,width:Math.max(1e-10,l.width),height:Math.max(1e-10,l.height),fill:k.color,"fill-opacity":k.opacity||null,stroke:j.color,"stroke-opacity":j.opacity||null,"stroke-width":j.opacity?l.lineWidth/this.scale:null});n=this.append(n,i,m)}}}return n};pv.SvgScene.dot=function(t){for(var s=t.$g.firstChild,r=0;r<t.length;r++){var q=t[r];if(q.visible){var p=q.fillStyle,o=q.strokeStyle;if(p.opacity||o.opacity){var n=q.radius,m=null;switch(q.shape){case"cross":m="M"+-n+","+-n+"L"+n+","+n+"M"+n+","+-n+"L"+-n+","+n;break;case"triangle":m=n;var k=n*1.1547;m="M0,"+m+"L"+k+","+-m+" "+-k+","+-m+"Z";break;case"diamond":n*=Math.SQRT2;m="M0,"+-n+"L"+n+",0 0,"+n+" "+-n+",0Z";break;case"square":m="M"+-n+","+-n+"L"+n+","+-n+" "+n+","+n+" "+-n+","+n+"Z";break;case"tick":m="M0,0L0,"+-q.size;break;case"bar":m="M0,"+q.size/2+"L0,"+-(q.size/2);break}p={"shape-rendering":q.antialias?null:"crispEdges","pointer-events":q.events,cursor:q.cursor,fill:p.color,"fill-opacity":p.opacity||null,stroke:o.color,"stroke-opacity":o.opacity||null,"stroke-width":o.opacity?q.lineWidth/this.scale:null};if(m){p.transform="translate("+q.left+","+q.top+")";if(q.angle){p.transform+=" rotate("+180*q.angle/Math.PI+")"}p.d=m;s=this.expect(s,"path",p)}else{p.cx=q.left;p.cy=q.top;p.r=n;s=this.expect(s,"circle",p)}s=this.append(s,t,r)}}}return s};pv.SvgScene.image=function(h){for(var l=h.$g.firstChild,k=0;k<h.length;k++){var j=h[k];if(j.visible){l=this.fill(l,h,k);if(j.image){l=this.expect(l,"foreignObject",{cursor:j.cursor,x:j.left,y:j.top,width:j.width,height:j.height});var i=l.firstChild||l.appendChild(document.createElementNS(this.xhtml,"canvas"));i.$scene={scenes:h,index:k};i.style.width=j.width;i.style.height=j.height;i.width=j.imageWidth;i.height=j.imageHeight;i.getContext("2d").putImageData(j.image,0,0)}else{l=this.expect(l,"image",{preserveAspectRatio:"none",cursor:j.cursor,x:j.left,y:j.top,width:j.width,height:j.height});l.setAttributeNS(this.xlink,"href",j.url)}l=this.append(l,h,k);l=this.stroke(l,h,k)}}return l};pv.SvgScene.label=function(t){for(var s=t.$g.firstChild,r=0;r<t.length;r++){var q=t[r];if(q.visible){var p=q.textStyle;if(p.opacity&&q.text){var o=0,n=0,m=0,k="start";
switch(q.textBaseline){case"middle":m=".35em";break;case"top":m=".71em";n=q.textMargin;break;case"bottom":n="-"+q.textMargin;break}switch(q.textAlign){case"right":k="end";o="-"+q.textMargin;break;case"center":k="middle";break;case"left":o=q.textMargin;break}s=this.expect(s,"text",{"pointer-events":q.events,cursor:q.cursor,x:o,y:n,dy:m,transform:"translate("+q.left+","+q.top+")"+(q.textAngle?" rotate("+180*q.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:p.color,"fill-opacity":p.opacity||null,"text-anchor":k},{font:q.font,"text-shadow":q.textShadow,"text-decoration":q.textDecoration});if(s.firstChild){s.firstChild.nodeValue=q.text}else{s.appendChild(document.createTextNode(q.text))}s=this.append(s,t,r)}}}return s};pv.SvgScene.line=function(j){var p=j.$g.firstChild;if(j.length<2){return p}var o=j[0];if(o.segmented){return this.lineSegment(j)}if(!o.visible){return p}var n=o.fillStyle,m=o.strokeStyle;if(!n.opacity&&!m.opacity){return p}var l="M"+o.left+","+o.top;if(j.length>2&&(o.interpolate=="basis"||o.interpolate=="cardinal"||o.interpolate=="monotone")){switch(o.interpolate){case"basis":l+=this.curveBasis(j);break;case"cardinal":l+=this.curveCardinal(j,o.tension);break;case"monotone":l+=this.curveMonotone(j);break}}else{for(var k=1;k<j.length;k++){l+=this.pathSegment(j[k-1],j[k])}}p=this.expect(p,"path",{"shape-rendering":o.antialias?null:"crispEdges","pointer-events":o.events,cursor:o.cursor,d:l,fill:n.color,"fill-opacity":n.opacity||null,stroke:m.color,"stroke-opacity":m.opacity||null,"stroke-width":m.opacity?o.lineWidth/this.scale:null,"stroke-linejoin":o.lineJoin});return this.append(p,j,0)};pv.SvgScene.lineSegment=function(t){var s=t.$g.firstChild,r=t[0],q;switch(r.interpolate){case"basis":q=this.curveBasisSegments(t);break;case"cardinal":q=this.curveCardinalSegments(t,r.tension);break;case"monotone":q=this.curveMonotoneSegments(t);break}r=0;for(var p=t.length-1;r<p;r++){var o=t[r],n=t[r+1];if(o.visible&&n.visible){var m=o.strokeStyle,k=pv.Color.transparent;if(m.opacity){if(o.interpolate=="linear"&&o.lineJoin=="miter"){k=m;m=pv.Color.transparent;n=this.pathJoin(t[r-1],o,n,t[r+2])}else{n=q?q[r]:"M"+o.left+","+o.top+this.pathSegment(o,n)}s=this.expect(s,"path",{"shape-rendering":o.antialias?null:"crispEdges","pointer-events":o.events,cursor:o.cursor,d:n,fill:k.color,"fill-opacity":k.opacity||null,stroke:m.color,"stroke-opacity":m.opacity||null,"stroke-width":m.opacity?o.lineWidth/this.scale:null,"stroke-linejoin":o.lineJoin});s=this.append(s,t,r)}}}return s};pv.SvgScene.pathSegment=function(h,l){var k=1;switch(h.interpolate){case"polar-reverse":k=0;case"polar":var j=l.left-h.left,i=l.top-h.top;h=1-h.eccentricity;j=Math.sqrt(j*j+i*i)/(2*h);if(h<=0||h>1){break}return"A"+j+","+j+" 0 0,"+k+" "+l.left+","+l.top;case"step-before":return"V"+l.top+"H"+l.left;case"step-after":return"H"+l.left+"V"+l.top}return"L"+l.left+","+l.top};pv.SvgScene.lineIntersect=function(g,j,i,h){return g.plus(j.times(i.minus(g).dot(h.perp())/j.dot(h.perp())))};pv.SvgScene.pathJoin=function(v,u,t,s){var r=pv.vector(u.left,u.top);t=pv.vector(t.left,t.top);var q=t.minus(r),p=q.perp().norm(),o=p.times(u.lineWidth/(2*this.scale));u=r.plus(o);var m=t.plus(o),n=t.minus(o);o=r.minus(o);if(v&&v.visible){v=r.minus(v.left,v.top).perp().norm().plus(p);o=this.lineIntersect(r,v,o,q);u=this.lineIntersect(r,v,u,q)}if(s&&s.visible){s=pv.vector(s.left,s.top).minus(t).perp().norm().plus(p);n=this.lineIntersect(t,s,n,q);m=this.lineIntersect(t,s,m,q)}return"M"+u.x+","+u.y+"L"+m.x+","+m.y+" "+n.x+","+n.y+" "+o.x+","+o.y};pv.SvgScene.panel=function(x){for(var w=x.$g,v=w&&w.firstChild,u=0;u<x.length;u++){var t=x[u];if(t.visible){if(!x.parent){t.canvas.style.display="inline-block";if(w&&w.parentNode!=t.canvas){v=(w=t.canvas.firstChild)&&w.firstChild}if(!w){w=t.canvas.appendChild(this.create("svg"));w.setAttribute("font-size","10px");w.setAttribute("font-family","sans-serif");w.setAttribute("fill","none");w.setAttribute("stroke","none");w.setAttribute("stroke-width",1.5);
for(var s=0;s<this.events.length;s++){w.addEventListener(this.events[s],this.dispatch,false)}v=w.firstChild}x.$g=w;w.setAttribute("width",t.width+t.left+t.right);w.setAttribute("height",t.height+t.top+t.bottom)}if(t.overflow=="hidden"){s=pv.id().toString(36);var r=this.expect(v,"g",{"clip-path":"url(#"+s+")"});r.parentNode||w.appendChild(r);x.$g=w=r;v=r.firstChild;v=this.expect(v,"clipPath",{id:s});s=v.firstChild||v.appendChild(this.create("rect"));s.setAttribute("x",t.left);s.setAttribute("y",t.top);s.setAttribute("width",t.width);s.setAttribute("height",t.height);v.parentNode||w.appendChild(v);v=v.nextSibling}v=this.fill(v,x,u);var p=this.scale,n=t.transform,o=t.left+n.x,m=t.top+n.y;this.scale*=n.k;for(s=0;s<t.children.length;s++){t.children[s].$g=v=this.expect(v,"g",{transform:"translate("+o+","+m+")"+(n.k!=1?" scale("+n.k+")":"")});this.updateAll(t.children[s]);v.parentNode||w.appendChild(v);v=v.nextSibling}this.scale=p;v=this.stroke(v,x,u);if(t.overflow=="hidden"){x.$g=w=r.parentNode;v=r.nextSibling}}}return v};pv.SvgScene.fill=function(h,l,k){var j=l[k],i=j.fillStyle;if(i.opacity||j.events=="all"){h=this.expect(h,"rect",{"shape-rendering":j.antialias?null:"crispEdges","pointer-events":j.events,cursor:j.cursor,x:j.left,y:j.top,width:j.width,height:j.height,fill:i.color,"fill-opacity":i.opacity,stroke:null});h=this.append(h,l,k)}return h};pv.SvgScene.stroke=function(h,l,k){var j=l[k],i=j.strokeStyle;if(i.opacity||j.events=="all"){h=this.expect(h,"rect",{"shape-rendering":j.antialias?null:"crispEdges","pointer-events":j.events=="all"?"stroke":j.events,cursor:j.cursor,x:j.left,y:j.top,width:Math.max(1e-10,j.width),height:Math.max(1e-10,j.height),fill:null,stroke:i.color,"stroke-opacity":i.opacity,"stroke-width":j.lineWidth/this.scale});h=this.append(h,l,k)}return h};pv.SvgScene.rule=function(h){for(var l=h.$g.firstChild,k=0;k<h.length;k++){var j=h[k];if(j.visible){var i=j.strokeStyle;if(i.opacity){l=this.expect(l,"line",{"shape-rendering":j.antialias?null:"crispEdges","pointer-events":j.events,cursor:j.cursor,x1:j.left,y1:j.top,x2:j.left+j.width,y2:j.top+j.height,stroke:i.color,"stroke-opacity":i.opacity,"stroke-width":j.lineWidth/this.scale});l=this.append(l,h,k)}}}return l};pv.SvgScene.wedge=function(B){for(var A=B.$g.firstChild,z=0;z<B.length;z++){var y=B[z];if(y.visible){var x=y.fillStyle,w=y.strokeStyle;if(x.opacity||w.opacity){var v=y.innerRadius,u=y.outerRadius,s=Math.abs(y.angle);if(s>=2*Math.PI){v=v?"M0,"+u+"A"+u+","+u+" 0 1,1 0,"+-u+"A"+u+","+u+" 0 1,1 0,"+u+"M0,"+v+"A"+v+","+v+" 0 1,1 0,"+-v+"A"+v+","+v+" 0 1,1 0,"+v+"Z":"M0,"+u+"A"+u+","+u+" 0 1,1 0,"+-u+"A"+u+","+u+" 0 1,1 0,"+u+"Z"}else{var t=Math.min(y.startAngle,y.endAngle),m=Math.max(y.startAngle,y.endAngle),p=Math.cos(t),r=Math.cos(m);t=Math.sin(t);m=Math.sin(m);v=v?"M"+u*p+","+u*t+"A"+u+","+u+" 0 "+(s<Math.PI?"0":"1")+",1 "+u*r+","+u*m+"L"+v*r+","+v*m+"A"+v+","+v+" 0 "+(s<Math.PI?"0":"1")+",0 "+v*p+","+v*t+"Z":"M"+u*p+","+u*t+"A"+u+","+u+" 0 "+(s<Math.PI?"0":"1")+",1 "+u*r+","+u*m+"L0,0Z"}A=this.expect(A,"path",{"shape-rendering":y.antialias?null:"crispEdges","pointer-events":y.events,cursor:y.cursor,transform:"translate("+y.left+","+y.top+")",d:v,fill:x.color,"fill-rule":"evenodd","fill-opacity":x.opacity||null,stroke:w.color,"stroke-opacity":w.opacity||null,"stroke-width":w.opacity?y.lineWidth/this.scale:null});A=this.append(A,B,z)}}}return A};pv.Mark=function(){this.$properties=[];this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(d,f){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties)}this.properties[d]=true;pv.Mark.prototype.propertyMethod(d,false,pv.Mark.cast[d]=f);return this};pv.Mark.prototype.propertyMethod=function(f,h,g){g||(g=pv.Mark.cast[f]);this[f]=function(c){if(h&&this.scene){var b=this.scene.defs;if(arguments.length){b[f]={id:c==null?0:pv.id(),value:c!=null&&g?g(c):c};return this}return b[f]?b[f].value:null}if(arguments.length){b=!h<<1|typeof c=="function";this.propertyValue(f,b&1&&g?function(){var d=c.apply(this,arguments);
return d!=null?g(d):null}:c!=null&&g?g(c):c).type=b;return this}return this.instance()[f]}};pv.Mark.prototype.propertyValue=function(g,j){var i=this.$properties;j={name:g,id:pv.id(),value:j};for(var h=0;h<i.length;h++){if(i[h].name==g){i.splice(h,1);break}}i.push(j);return j};pv.Mark.prototype.property("data").property("visible",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String);a=pv.Mark.prototype;a.childIndex=-1;a.index=-1;a.scale=1;a.defaults=(new pv.Mark).data(function(c){return[c]}).visible(true).antialias(true).events("painted");a.extend=function(c){this.proto=c;return this};a.add=function(c){return this.parent.add(c).extend(this)};a.def=function(d,f){this.propertyMethod(d,true);return this[d](arguments.length>1?f:null)};a.anchor=function(g){function j(d){for(var c=i,b=[];!(h=c.scene);){d=d.parent;b.push({index:d.index,childIndex:c.childIndex});c=c.parent}for(;b.length;){d=b.pop();h=h[d.index].children[d.childIndex]}if(i.hasOwnProperty("index")){b=pv.extend(h[i.index]);b.right=b.top=b.left=b.bottom=0;return[b]}return h}var i=this,h;g||(g="center");return(new pv.Anchor(this)).name(g).def("$mark.anchor",function(){h=this.scene.target=j(this)}).data(function(){return h.map(function(b){return b.data})}).visible(function(){return h[this.index].visible}).left(function(){var c=h[this.index],b=c.width||0;switch(this.name()){case"bottom":case"top":case"center":return c.left+b/2;case"left":return null}return c.left+b}).top(function(){var c=h[this.index],b=c.height||0;switch(this.name()){case"left":case"right":case"center":return c.top+b/2;case"top":return null}return c.top+b}).right(function(){var b=h[this.index];return this.name()=="left"?b.right+(b.width||0):null}).bottom(function(){var b=h[this.index];return this.name()=="top"?b.bottom+(b.height||0):null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})};a.anchorTarget=function(){return this.proto.anchorTarget()};a.margin=function(c){return this.left(c).right(c).top(c).bottom(c)};a.instance=function(f){var h=this.scene||this.parent.instance(-1).children[this.childIndex],g=!arguments.length||this.hasOwnProperty("index")?this.index:f;return h[g<0?h.length-1:g]};a.first=function(){return this.scene[0]};a.last=function(){return this.scene[this.scene.length-1]};a.sibling=function(){return this.index==0?null:this.scene[this.index-1]};a.cousin=function(){var c=this.parent;return(c=c&&c.sibling())&&c.children?c.children[this.childIndex][this.index]:null};a.render=function(){function i(f,d,b){f.scale=b;if(d<k.length){l.unshift(null);if(f.hasOwnProperty("index")){n(f,d,b)}else{for(var c=0,g=f.scene.length;c<g;c++){f.index=c;n(f,d,b)}delete f.index}l.shift()}else{f.build();pv.Scene.scale=b;pv.Scene.updateAll(f.scene)}delete f.scale}function n(f,d,b){var c=f.scene[f.index],g;if(c.visible){var h=k[d],p=f.children[h];for(g=0;g<h;g++){f.children[g].scene=c.children[g]}l[0]=c.data;if(p.scene){i(p,d+1,b*c.transform.k)}else{p.scene=c.children[h];i(p,d+1,b*c.transform.k);delete p.scene}for(g=0;g<h;g++){delete f.children[g].scene}}}var m=this.parent,l=pv.Mark.stack;if(m&&!this.root.scene){this.root.render()}else{for(var k=[],j=this;j.parent;j=j.parent){k.unshift(j.childIndex)}for(this.bind();m&&!m.hasOwnProperty("index");){m=m.parent}this.context(m?m.scene:undefined,m?m.index:-1,function(){i(this.root,0,1)})}};pv.Mark.stack=[];a=pv.Mark.prototype;a.bind=function(){function j(d){do{for(var b=d.$properties,c=b.length-1;c>=0;c--){var f=b[c];if(!(f.name in p)){p[f.name]=f;switch(f.name){case"data":n=f;break;case"visible":m=f;break;default:o[f.type].push(f);break}}}}while(d=d.proto)}var p={},o=[[],[],[],[]],n,m;
j(this);j(this.defaults);o[1].reverse();o[3].reverse();var l=this;do{for(var k in l.properties){k in p||o[2].push(p[k]={name:k,type:2,value:null})}}while(l=l.proto);l=o[0].concat(o[1]);for(k=0;k<l.length;k++){this.propertyMethod(l[k].name,true)}this.binds={properties:p,data:n,defs:l,required:[m],optional:pv.blend(o)}};a.build=function(){var i=this.scene,n=pv.Mark.stack;if(!i){i=this.scene=[];i.mark=this;i.type=this.type;i.childIndex=this.childIndex;if(this.parent){i.parent=this.parent.scene;i.parentIndex=this.parent.index}}if(this.binds.defs.length){var m=i.defs;if(!m){i.defs=m={}}for(var l=0;l<this.binds.defs.length;l++){var k=this.binds.defs[l],j=m[k.name];if(!j||k.id>j.id){m[k.name]={id:0,value:k.type&1?k.value.apply(this,n):k.value}}}}m=this.binds.data;m=m.type&1?m.value.apply(this,n):m.value;n.unshift(null);i.length=m.length;for(l=0;l<m.length;l++){pv.Mark.prototype.index=this.index=l;(k=i[l])||(i[l]=k={});k.data=n[0]=m[l];this.buildInstance(k)}pv.Mark.prototype.index=-1;delete this.index;n.shift();return this};a.buildProperties=function(i,n){for(var m=0,l=n.length;m<l;m++){var k=n[m],j=k.value;switch(k.type){case 0:case 1:j=this.scene.defs[k.name].value;break;case 3:j=j.apply(this,pv.Mark.stack);break}i[k.name]=j}};a.buildInstance=function(c){this.buildProperties(c,this.binds.required);if(c.visible){this.buildProperties(c,this.binds.optional);this.buildImplied(c)}};a.buildImplied=function(t){var s=t.left,r=t.right,q=t.top,p=t.bottom,o=this.properties,n=o.width?t.width:0,m=o.height?t.height:0,k=this.parent?this.parent.width():n+s+r;if(n==null){n=k-(r=r||0)-(s=s||0)}else{if(r==null){r=k-n-(s=s||0)}else{if(s==null){s=k-n-(r=r||0)}}}k=this.parent?this.parent.height():m+q+p;if(m==null){m=k-(q=q||0)-(p=p||0)}else{if(p==null){p=k-m-(q=q||0)}else{if(q==null){q=k-m-(p=p||0)}}}t.left=s;t.right=r;t.top=q;t.bottom=p;if(o.width){t.width=n}if(o.height){t.height=m}if(o.textStyle&&!t.textStyle){t.textStyle=pv.Color.transparent}if(o.fillStyle&&!t.fillStyle){t.fillStyle=pv.Color.transparent}if(o.strokeStyle&&!t.strokeStyle){t.strokeStyle=pv.Color.transparent}};a.mouse=function(){var h=pv.event.pageX||0,l=pv.event.pageY||0,k=this.root.canvas();do{h-=k.offsetLeft;l-=k.offsetTop}while(k=k.offsetParent);k=pv.Transform.identity;var j=this.properties.transform?this:this.parent,i=[];do{i.push(j)}while(j=j.parent);for(;j=i.pop();){k=k.translate(j.left(),j.top()).times(j.transform())}k=k.invert();return pv.vector(h*k.k+k.x,l*k.k+k.y)};a.event=function(d,f){this.$handlers[d]=pv.functor(f);return this};a.context=function(t,s,r){function q(c,d){pv.Mark.scene=c;o.index=d;if(c){var f=c.mark,g=f,b=[];do{b.push(g);n.push(c[d].data);g.index=d;g.scene=c;d=c.parentIndex;c=c.parent}while(g=g.parent);c=b.length-1;for(d=1;c>0;c--){g=b[c];g.scale=d;d*=g.scene[g.index].transform.k}if(f.children){c=0;for(b=f.children.length;c<b;c++){g=f.children[c];g.scene=f.scene[f.index].children[c];g.scale=d}}}}function p(b){if(b){b=b.mark;var c;if(b.children){for(var d=0,f=b.children.length;d<f;d++){c=b.children[d];delete c.scene;delete c.scale}}c=b;do{n.pop();if(c.parent){delete c.scene;delete c.scale}delete c.index}while(c=c.parent)}}var o=pv.Mark.prototype,n=pv.Mark.stack,m=pv.Mark.scene,k=o.index;p(m,k);q(t,s);try{r.apply(this,n)}finally{p(t,s);q(m,k)}};pv.Mark.dispatch=function(i,n,m){var l=n.mark,k=n.parent,j=l.$handlers[i];if(!j){return k&&pv.Mark.dispatch(i,k,n.parentIndex)}l.context(n,m,function(){(l=j.apply(l,pv.Mark.stack))&&l.render&&l.render()});return true};pv.Anchor=function(c){pv.Mark.call(this);this.target=c;this.parent=c.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.anchorTarget=function(){return this.target};pv.Area=function(){pv.Mark.call(this)};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("tension",Number);pv.Area.prototype.type="area";
pv.Area.prototype.defaults=(new pv.Area).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(0.7);pv.Area.prototype.buildImplied=function(c){if(c.height==null){c.height=0}if(c.width==null){c.width=0}pv.Mark.prototype.buildImplied.call(this,c)};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1,tension:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var h=this.binds,l=h.required;h=h.optional;for(var k=0,j=h.length;k<j;k++){var i=h[k];i.fixed=i.name in pv.Area.fixed;if(i.name=="segmented"){l.push(i);h.splice(k,1);k--;j--}}this.binds.$required=l;this.binds.$optional=h};pv.Area.prototype.buildInstance=function(i){var n=this.binds;if(this.index){var m=n.fixed;if(!m){m=n.fixed=[];function l(b){return !b.fixed||(m.push(b),false)}n.required=n.required.filter(l);if(!this.scene[0].segmented){n.optional=n.optional.filter(l)}}n=0;for(var k=m.length;n<k;n++){var j=m[n].name;i[j]=this.scene[0][j]}}else{n.required=n.$required;n.optional=n.$optional;n.fixed=null}pv.Mark.prototype.buildInstance.call(this,i)};pv.Area.prototype.anchor=function(d){var f;return pv.Mark.prototype.anchor.call(this,d).def("$area.anchor",function(){f=this.scene.target}).interpolate(function(){return f[this.index].interpolate}).eccentricity(function(){return f[this.index].eccentricity}).tension(function(){return f[this.index].tension})};pv.Bar=function(){pv.Mark.call(this)};pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=(new pv.Bar).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent));pv.Dot=function(){pv.Mark.call(this)};pv.Dot.prototype=pv.extend(pv.Mark).property("size",Number).property("radius",Number).property("shape",String).property("angle",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=(new pv.Dot).extend(pv.Mark.prototype.defaults).size(20).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent));pv.Dot.prototype.anchor=function(d){var f;return pv.Mark.prototype.anchor.call(this,d).def("$wedge.anchor",function(){f=this.scene.target}).left(function(){var b=f[this.index];switch(this.name()){case"bottom":case"top":case"center":return b.left;case"left":return null}return b.left+b.radius}).right(function(){var b=f[this.index];return this.name()=="left"?b.right+b.radius:null}).top(function(){var b=f[this.index];switch(this.name()){case"left":case"right":case"center":return b.top;case"top":return null}return b.top+b.radius}).bottom(function(){var b=f[this.index];return this.name()=="top"?b.bottom+b.radius:null}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top"}return"bottom"})};pv.Dot.prototype.buildImplied=function(c){if(c.radius==null){c.radius=Math.sqrt(c.size)}else{if(c.size==null){c.size=c.radius*c.radius}}pv.Mark.prototype.buildImplied.call(this,c)};pv.Label=function(){pv.Mark.call(this)};pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=(new pv.Label).extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);pv.Line=function(){pv.Mark.call(this)};
pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("eccentricity",Number).property("tension",Number);a=pv.Line.prototype;a.type="line";a.defaults=(new pv.Line).extend(pv.Mark.prototype.defaults).lineJoin("miter").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(0.7);a.bind=pv.Area.prototype.bind;a.buildInstance=pv.Area.prototype.buildInstance;a.anchor=function(c){return pv.Area.prototype.anchor.call(this,c).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left"}}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top"}})};pv.Rule=function(){pv.Mark.call(this)};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=(new pv.Rule).extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(false);pv.Rule.prototype.anchor=pv.Line.prototype.anchor;pv.Rule.prototype.buildImplied=function(f){var h=f.left,g=f.right;if(f.width!=null||h==null&&g==null||g!=null&&h!=null){f.height=0}else{f.width=0}pv.Mark.prototype.buildImplied.call(this,f)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(c){return typeof c=="string"?document.getElementById(c):c});a=pv.Panel.prototype;a.type="panel";a.defaults=(new pv.Panel).extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");a.anchor=function(c){c=pv.Bar.prototype.anchor.call(this,c);c.parent=this;return c};a.add=function(c){c=new c;c.parent=this;c.root=this.root;c.childIndex=this.children.length;this.children.push(c);return c};a.bind=function(){pv.Mark.prototype.bind.call(this);for(var c=0;c<this.children.length;c++){this.children[c].bind()}};a.buildInstance=function(h){pv.Bar.prototype.buildInstance.call(this,h);if(h.visible){if(!h.children){h.children=[]}var l=this.scale*h.transform.k,k,j=this.children.length;pv.Mark.prototype.index=-1;for(var i=0;i<j;i++){k=this.children[i];k.scene=h.children[i];k.scale=l;k.build()}for(i=0;i<j;i++){k=this.children[i];h.children[i]=k.scene;delete k.scene;delete k.scale}h.children.length=j}};a.buildImplied=function(f){if(!this.parent){var h=f.canvas;if(h){if(h.$panel!=this){for(h.$panel=this;h.lastChild;){h.removeChild(h.lastChild)}}var g;if(f.width==null){g=parseFloat(pv.css(h,"width"));f.width=g-f.left-f.right}if(f.height==null){g=parseFloat(pv.css(h,"height"));f.height=g-f.top-f.bottom}}else{g=this.$canvas||(this.$canvas=[]);if(!(h=g[this.index])){h=g[this.index]=document.createElement("span");if(this.$dom){this.$dom.parentNode.insertBefore(h,this.$dom)}else{for(g=document.body;g.lastChild&&g.lastChild.tagName;){g=g.lastChild}if(g!=document.body){g=g.parentNode}g.appendChild(h)}}}f.canvas=h}if(!f.transform){f.transform=pv.Transform.identity}pv.Mark.prototype.buildImplied.call(this,f)};pv.Image=function(){pv.Bar.call(this)};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);a=pv.Image.prototype;a.type="image";a.defaults=(new pv.Image).extend(pv.Bar.prototype.defaults).fillStyle(null);a.image=function(c){this.$image=function(){var b=c.apply(this,arguments);return b==null?pv.Color.transparent:typeof b=="string"?pv.color(b):b};return this};a.bind=function(){pv.Bar.prototype.bind.call(this);var d=this.binds,f=this;do{d.image=f.$image}while(!d.image&&(f=f.proto))};a.buildImplied=function(k){pv.Bar.prototype.buildImplied.call(this,k);if(k.visible){if(k.imageWidth==null){k.imageWidth=k.width
}if(k.imageHeight==null){k.imageHeight=k.height}if(k.url==null&&this.binds.image){var r=this.$canvas||(this.$canvas=document.createElement("canvas")),q=r.getContext("2d"),p=k.imageWidth,o=k.imageHeight,n=pv.Mark.stack;r.width=p;r.height=o;k=(k.image=q.createImageData(p,o)).data;n.unshift(null,null);for(q=r=0;r<o;r++){n[1]=r;for(var m=0;m<p;m++){n[0]=m;var l=this.binds.image.apply(this,n);k[q++]=l.r;k[q++]=l.g;k[q++]=l.b;k[q++]=255*l.a}}n.splice(0,2)}}};pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);a=pv.Wedge.prototype;a.type="wedge";a.defaults=(new pv.Wedge).extend(pv.Mark.prototype.defaults).startAngle(function(){var c=this.sibling();return c?c.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index));a.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};a.midAngle=function(){return(this.startAngle()+this.endAngle())/2};a.anchor=function(h){function l(b){return b.innerRadius||b.angle<2*Math.PI}function k(b){return(b.innerRadius+b.outerRadius)/2}function j(b){return(b.startAngle+b.endAngle)/2}var i;return pv.Mark.prototype.anchor.call(this,h).def("$wedge.anchor",function(){i=this.scene.target}).left(function(){var b=i[this.index];if(l(b)){switch(this.name()){case"outer":return b.left+b.outerRadius*Math.cos(j(b));case"inner":return b.left+b.innerRadius*Math.cos(j(b));case"start":return b.left+k(b)*Math.cos(b.startAngle);case"center":return b.left+k(b)*Math.cos(j(b));case"end":return b.left+k(b)*Math.cos(b.endAngle)}}return b.left}).top(function(){var b=i[this.index];if(l(b)){switch(this.name()){case"outer":return b.top+b.outerRadius*Math.sin(j(b));case"inner":return b.top+b.innerRadius*Math.sin(j(b));case"start":return b.top+k(b)*Math.sin(b.startAngle);case"center":return b.top+k(b)*Math.sin(j(b));case"end":return b.top+k(b)*Math.sin(b.endAngle)}}return b.top}).textAlign(function(){var b=i[this.index];if(l(b)){switch(this.name()){case"outer":return pv.Wedge.upright(j(b))?"right":"left";case"inner":return pv.Wedge.upright(j(b))?"left":"right"}}return"center"}).textBaseline(function(){var b=i[this.index];if(l(b)){switch(this.name()){case"start":return pv.Wedge.upright(b.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(b.endAngle)?"bottom":"top"}}return"middle"}).textAngle(function(){var c=i[this.index],b=0;if(l(c)){switch(this.name()){case"center":case"inner":case"outer":b=j(c);break;case"start":b=c.startAngle;break;case"end":b=c.endAngle;break}}return pv.Wedge.upright(b)?b:b+Math.PI})};pv.Wedge.upright=function(c){c%=2*Math.PI;c=c<0?2*Math.PI+c:c;return c<Math.PI/2||c>=3*Math.PI/2};pv.Wedge.prototype.buildImplied=function(c){if(c.angle==null){c.angle=c.endAngle-c.startAngle}else{if(c.endAngle==null){c.endAngle=c.startAngle+c.angle}}pv.Mark.prototype.buildImplied.call(this,c)};pv.simulation=function(c){return new pv.Simulation(c)};pv.Simulation=function(d){for(var f=0;f<d.length;f++){this.particle(d[f])}};a=pv.Simulation.prototype;a.particle=function(c){c.next=this.particles;if(isNaN(c.px)){c.px=c.x}if(isNaN(c.py)){c.py=c.y}if(isNaN(c.fx)){c.fx=0}if(isNaN(c.fy)){c.fy=0}this.particles=c;return this};a.force=function(c){c.next=this.forces;this.forces=c;return this};a.constraint=function(c){c.next=this.constraints;this.constraints=c;return this};a.stabilize=function(g){var j;arguments.length||(g=3);for(var i=0;i<g;i++){var h=new pv.Quadtree(this.particles);for(j=this.constraints;j;j=j.next){j.apply(this.particles,h)}}for(j=this.particles;j;j=j.next){j.px=j.x;j.py=j.y}return this};a.step=function(){var f;for(f=this.particles;f;f=f.next){var h=f.px,g=f.py;f.px=f.x;f.py=f.y;f.x+=f.vx=f.x-h+f.fx;f.y+=f.vy=f.y-g+f.fy}h=new pv.Quadtree(this.particles);for(f=this.constraints;f;f=f.next){f.apply(this.particles,h)
}for(f=this.particles;f;f=f.next){f.fx=f.fy=0}for(f=this.forces;f;f=f.next){f.apply(this.particles,h)}};pv.Quadtree=function(t){function s(c,g,h,i,b,f){if(!(isNaN(g.x)||isNaN(g.y))){if(c.leaf){if(c.p){if(!(Math.abs(c.p.x-g.x)+Math.abs(c.p.y-g.y)<0.01)){var d=c.p;c.p=null;r(c,d,h,i,b,f)}r(c,g,h,i,b,f)}else{c.p=g}}else{r(c,g,h,i,b,f)}}}function r(h,c,d,f,g,b){var v=(d+g)*0.5,j=(f+b)*0.5,i=c.x>=v,l=c.y>=j;h.leaf=false;switch((l<<1)+i){case 0:h=h.c1||(h.c1=new pv.Quadtree.Node);break;case 1:h=h.c2||(h.c2=new pv.Quadtree.Node);break;case 2:h=h.c3||(h.c3=new pv.Quadtree.Node);break;case 3:h=h.c4||(h.c4=new pv.Quadtree.Node);break}if(i){d=v}else{g=v}if(l){f=j}else{b=j}s(h,c,d,f,g,b)}var q,p=Number.POSITIVE_INFINITY,o=p,n=Number.NEGATIVE_INFINITY,m=n;for(q=t;q;q=q.next){if(q.x<p){p=q.x}if(q.y<o){o=q.y}if(q.x>n){n=q.x}if(q.y>m){m=q.y}}q=n-p;var k=m-o;if(q>k){m=o+q}else{n=p+k}this.xMin=p;this.yMin=o;this.xMax=n;this.yMax=m;this.root=new pv.Quadtree.Node;for(q=t;q;q=q.next){s(this.root,q,p,o,n,m)}};pv.Quadtree.Node=function(){this.leaf=true;this.p=this.c4=this.c3=this.c2=this.c1=null};pv.Force={};pv.Force.charge=function(t){function s(b){function c(g){s(g);b.cn+=g.cn;d+=g.cn*g.cx;f+=g.cn*g.cy}var d=0,f=0;b.cn=0;if(!b.leaf){b.c1&&c(b.c1);b.c2&&c(b.c2);b.c3&&c(b.c3);b.c4&&c(b.c4)}if(b.p){b.cn+=t;d+=t*b.p.x;f+=t*b.p.y}b.cx=d/b.cn;b.cy=f/b.cn}function r(i,c,f,g,h,b){var w=i.cx-c.x,l=i.cy-c.y,j=1/Math.sqrt(w*w+l*l);if(i.leaf&&i.p!=c||(h-f)*j<m){if(!(j<n)){if(j>p){j=p}i=i.cn*j*j*j;w=w*i;l=l*i;c.fx+=w;c.fy+=l}}else{if(!i.leaf){var v=(f+h)*0.5,d=(g+b)*0.5;i.c1&&r(i.c1,c,f,g,v,d);i.c2&&r(i.c2,c,v,g,h,d);i.c3&&r(i.c3,c,f,d,v,b);i.c4&&r(i.c4,c,v,d,h,b);if(!(j<n)){if(j>p){j=p}if(i.p&&i.p!=c){i=t*j*j*j;w=w*i;l=l*i;c.fx+=w;c.fy+=l}}}}}var q=2,p=1/q,o=500,n=1/o,m=0.9,k={};arguments.length||(t=-40);k.constant=function(b){if(arguments.length){t=Number(b);return k}return t};k.domain=function(b,c){if(arguments.length){q=Number(b);p=1/q;o=Number(c);n=1/o;return k}return[q,o]};k.theta=function(b){if(arguments.length){m=Number(b);return k}return m};k.apply=function(b,c){s(c.root);for(b=b;b;b=b.next){r(c.root,b,c.xMin,c.yMin,c.xMax,c.yMax)}};return k};pv.Force.drag=function(d){var f={};arguments.length||(d=0.1);f.constant=function(b){if(arguments.length){d=b;return f}return d};f.apply=function(b){if(d){for(b=b;b;b=b.next){b.fx-=d*b.vx;b.fy-=d*b.vy}}};return f};pv.Force.spring=function(i){var n=0.1,m=20,l,k,j={};arguments.length||(i=0.1);j.links=function(b){if(arguments.length){l=b;k=b.map(function(c){return 1/Math.sqrt(Math.max(c.sourceNode.linkDegree,c.targetNode.linkDegree))});return j}return l};j.constant=function(b){if(arguments.length){i=Number(b);return j}return i};j.damping=function(b){if(arguments.length){n=Number(b);return j}return n};j.length=function(b){if(arguments.length){m=Number(b);return j}return m};j.apply=function(){for(var f=0;f<l.length;f++){var d=l[f].sourceNode,b=l[f].targetNode,c=d.x-b.x,g=d.y-b.y,h=Math.sqrt(c*c+g*g),p=h?1/h:1;p=(i*k[f]*(h-m)+n*k[f]*(c*(d.vx-b.vx)+g*(d.vy-b.vy))*p)*p;c=-p*(h?c:0.01*(0.5-Math.random()));g=-p*(h?g:0.01*(0.5-Math.random()));d.fx+=c;d.fy+=g;b.fx-=c;b.fy-=g}};return j};pv.Constraint={};pv.Constraint.collision=function(t){function s(i,c,f,g,h,b){if(!i.leaf){var w=(f+h)*0.5,l=(g+b)*0.5,j=l<m,v=w>p,d=w<n;if(l>o){i.c1&&v&&s(i.c1,c,f,g,w,l);i.c2&&d&&s(i.c2,c,w,g,h,l)}if(j){i.c3&&v&&s(i.c3,c,f,l,w,b);i.c4&&d&&s(i.c4,c,w,l,h,b)}}if(i.p&&i.p!=c){f=c.x-i.p.x;g=c.y-i.p.y;h=Math.sqrt(f*f+g*g);b=q+t(i.p);if(h<b){h=(h-b)/h*0.5;f*=h;g*=h;c.x-=f;c.y-=g;i.p.x+=f;i.p.y+=g}}}var r=1,q,p,o,n,m,k={};arguments.length||(q=10);k.repeat=function(b){if(arguments.length){r=Number(b);return k}return r};k.apply=function(c,f){var g,h,b=-Infinity;for(g=c;g;g=g.next){h=t(g);if(h>b){b=h}}for(var d=0;d<r;d++){for(g=c;g;g=g.next){h=(q=t(g))+b;p=g.x-h;n=g.x+h;o=g.y-h;m=g.y+h;s(f.root,g,f.xMin,f.yMin,f.xMax,f.yMax)}}};return k};pv.Constraint.position=function(f){var h=1,g={};arguments.length||(f=function(b){return b.fix});g.alpha=function(b){if(arguments.length){h=Number(b);
return g}return h};g.apply=function(c){for(c=c;c;c=c.next){var b=f(c);if(b){c.x+=(b.x-c.x)*h;c.y+=(b.y-c.y)*h;c.fx=c.fy=c.vx=c.vy=0}}};return g};pv.Constraint.bound=function(){var f={},h,g;f.x=function(c,b){if(arguments.length){h={min:Math.min(c,b),max:Math.max(c,b)};return this}return h};f.y=function(c,b){if(arguments.length){g={min:Math.min(c,b),max:Math.max(c,b)};return this}return g};f.apply=function(c){if(h){for(var b=c;b;b=b.next){b.x=b.x<h.min?h.min:b.x>h.max?h.max:b.x}}if(g){for(b=c;b;b=b.next){b.y=b.y<g.min?g.min:b.y>g.max?g.max:b.y}}};return f};pv.Layout=function(){pv.Panel.call(this)};pv.Layout.prototype=pv.extend(pv.Panel);pv.Layout.prototype.property=function(d,f){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties)}this.properties[d]=true;this.propertyMethod(d,false,pv.Mark.cast[d]=f);return this};pv.Layout.Network=function(){pv.Layout.call(this);var c=this;this.$id=pv.id();(this.node=(new pv.Mark).data(function(){return c.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(b){return b.x}).top(function(b){return b.y})).parent=this;this.link=(new pv.Mark).extend(this.node).data(function(b){return[b.sourceNode,b.targetNode]}).fillStyle(null).lineWidth(function(f,b){return b.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(b){return c.add(pv.Panel).data(function(){return c.links()}).add(b).extend(this)};(this.label=(new pv.Mark).extend(this.node).textMargin(7).textBaseline("middle").text(function(b){return b.nodeName||b.nodeValue}).textAngle(function(b){b=b.midAngle;return pv.Wedge.upright(b)?b:b+Math.PI}).textAlign(function(b){return pv.Wedge.upright(b.midAngle)?"left":"right"})).parent=this};pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(c){return c.map(function(f,b){if(typeof f!="object"){f={nodeValue:f}}f.index=b;f.linkDegree=0;return f})}).property("links",function(c){return c.map(function(b){if(isNaN(b.linkValue)){b.linkValue=isNaN(b.value)?1:b.value}return b})});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this};pv.Layout.Network.prototype.buildProperties=function(d,f){if((d.$id||0)<this.$id){pv.Layout.prototype.buildProperties.call(this,d,f)}};pv.Layout.Network.prototype.buildImplied=function(c){pv.Layout.prototype.buildImplied.call(this,c);if(c.$id>=this.$id){return true}c.$id=this.$id;c.links.forEach(function(f){var b=f.linkValue;(f.sourceNode||(f.sourceNode=c.nodes[f.source])).linkDegree+=b;(f.targetNode||(f.targetNode=c.nodes[f.target])).linkDegree+=b})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc")};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.buildImplied=function(c){if(!c.links){c.links=pv.Layout.Hierarchy.links.call(this)}pv.Layout.Network.prototype.buildImplied.call(this,c)};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(c){return c.parentNode}).map(function(c){return{sourceNode:c,targetNode:c.parentNode,linkValue:1}})};pv.Layout.Hierarchy.NodeLink={buildImplied:function(B){function A(b){return b.parentNode?b.depth*(p-m)+m:0}function z(b){return b.parentNode?(b.breadth-0.25)*2*Math.PI:0}function y(b){switch(v){case"left":return b.depth*s;case"right":return s-b.depth*s;case"top":return b.breadth*s;case"bottom":return s-b.breadth*s;case"radial":return s/2+A(b)*Math.cos(b.midAngle)}}function x(b){switch(v){case"left":return b.breadth*t;case"right":return t-b.breadth*t;case"top":return b.depth*t;case"bottom":return t-b.depth*t;case"radial":return t/2+A(b)*Math.sin(b.midAngle)}}var w=B.nodes,v=B.orient,u=/^(top|bottom)$/.test(v),s=B.width,t=B.height;if(v=="radial"){var m=B.innerRadius,p=B.outerRadius;if(m==null){m=0}if(p==null){p=Math.min(s,t)/2}}for(B=0;B<w.length;B++){var r=w[B];r.midAngle=v=="radial"?z(r):u?Math.PI/2:0;r.x=y(r);r.y=x(r);if(r.firstChild){r.midAngle+=Math.PI}}}};pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(c){return c.dx
}).height(function(c){return c.dy}).innerRadius(function(c){return c.innerRadius}).outerRadius(function(c){return c.outerRadius}).startAngle(function(c){return c.startAngle}).angle(function(c){return c.angle});this.label.textAlign("center").left(function(c){return c.x+c.dx/2}).top(function(c){return c.y+c.dy/2});delete this.link},buildImplied:function(N){function M(c,b){return(c+b)/(1+b)}function L(b){switch(B){case"left":return M(b.minDepth,y)*D;case"right":return(1-M(b.maxDepth,y))*D;case"top":return b.minBreadth*D;case"bottom":return(1-b.maxBreadth)*D;case"radial":return D/2}}function K(b){switch(B){case"left":return b.minBreadth*z;case"right":return(1-b.maxBreadth)*z;case"top":return M(b.minDepth,y)*z;case"bottom":return(1-M(b.maxDepth,y))*z;case"radial":return z/2}}function J(b){switch(B){case"left":case"right":return(b.maxDepth-b.minDepth)/(1+y)*D;case"top":case"bottom":return(b.maxBreadth-b.minBreadth)*D;case"radial":return b.parentNode?(b.innerRadius+b.outerRadius)*Math.cos(b.midAngle):0}}function I(b){switch(B){case"left":case"right":return(b.maxBreadth-b.minBreadth)*z;case"top":case"bottom":return(b.maxDepth-b.minDepth)/(1+y)*z;case"radial":return b.parentNode?(b.innerRadius+b.outerRadius)*Math.sin(b.midAngle):0}}function H(b){return Math.max(0,M(b.minDepth,y/2))*(p-v)+v}function G(b){return M(b.maxDepth,y/2)*(p-v)+v}function E(b){return(b.parentNode?b.minBreadth-0.25:0)*2*Math.PI}function F(b){return(b.parentNode?b.maxBreadth-b.minBreadth:1)*2*Math.PI}var A=N.nodes,B=N.orient,C=/^(top|bottom)$/.test(B),D=N.width,z=N.height,y=-A[0].minDepth;if(B=="radial"){var v=N.innerRadius,p=N.outerRadius;if(v==null){v=0}if(v){y*=2}if(p==null){p=Math.min(D,z)/2}}for(N=0;N<A.length;N++){var w=A[N];w.x=L(w);w.y=K(w);if(B=="radial"){w.innerRadius=H(w);w.outerRadius=G(w);w.startAngle=E(w);w.angle=F(w);w.midAngle=w.startAngle+w.angle/2}else{w.midAngle=C?-Math.PI/2:0}w.dx=J(w);w.dy=I(w)}}};pv.Layout.Grid=function(){pv.Layout.call(this);var c=this;(this.cell=(new pv.Mark).data(function(){return c.scene[c.index].$grid}).width(function(){return c.width()/c.cols()}).height(function(){return c.height()/c.rows()}).left(function(){return this.width()*(this.index%c.cols())}).top(function(){return this.height()*Math.floor(this.index/c.cols())})).parent=this};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=(new pv.Layout.Grid).extend(pv.Layout.prototype.defaults).rows(1).cols(1);pv.Layout.Grid.prototype.buildImplied=function(f){pv.Layout.prototype.buildImplied.call(this,f);var h=f.rows,g=f.cols;if(typeof g=="object"){h=pv.transpose(g)}if(typeof h=="object"){f.$grid=pv.blend(h);f.rows=h.length;f.cols=h[0]?h[0].length:0}else{f.$grid=pv.repeat([f.data],h*g)}};pv.Layout.Stack=function(){function i(b){return function(){return l[b](this.parent.index,this.index)}}pv.Layout.call(this);var n=this,m=function(){return null},l={t:m,l:m,r:m,b:m,w:m,h:m},k,j=n.buildImplied;this.buildImplied=function(N){j.call(this,N);var M=N.layers,K=M.length,L,F=N.orient,H=/^(top|bottom)\b/.test(F),I=this.parent[H?"height":"width"](),J=[],E=[],B=[],h=pv.Mark.stack,d={parent:{parent:this}};h.unshift(null);k=[];for(var A=0;A<K;A++){B[A]=[];E[A]=[];d.parent.index=A;h[0]=M[A];k[A]=this.$values.apply(d.parent,h);if(!A){L=k[A].length}h.unshift(null);for(var G=0;G<L;G++){h[0]=k[A][G];d.index=G;A||(J[G]=this.$x.apply(d,h));B[A][G]=this.$y.apply(d,h)}h.shift()}h.shift();switch(N.order){case"inside-out":var g=B.map(function(o){return pv.max.index(o)});d=pv.range(K).sort(function(o,p){return g[o]-g[p]});M=B.map(function(o){return pv.sum(o)});var f=h=0,c=[],b=[];for(A=0;A<K;A++){G=d[A];if(h<f){h+=M[G];c.push(G)}else{f+=M[G];b.push(G)}}M=b.reverse().concat(c);break;case"reverse":M=pv.range(K-1,-1,-1);break;default:M=pv.range(K);break}switch(N.offset){case"silohouette":for(G=0;G<L;G++){for(A=d=0;A<K;A++){d+=B[A][G]}E[M[0]][G]=(I-d)/2}break;case"wiggle":for(A=d=0;A<K;A++){d+=B[A][0]}E[M[0]][0]=d=(I-d)/2;for(G=1;G<L;G++){h=I=0;
f=J[G]-J[G-1];for(A=0;A<K;A++){I+=B[A][G]}for(A=0;A<K;A++){c=(B[M[A]][G]-B[M[A]][G-1])/(2*f);for(N=0;N<A;N++){c+=(B[M[N]][G]-B[M[N]][G-1])/f}h+=c*B[M[A]][G]}E[M[0]][G]=d-=I?h/I*f:0}break;case"expand":for(G=0;G<L;G++){for(A=N=E[M[0]][G]=0;A<K;A++){N+=B[A][G]}if(N){N=I/N;for(A=0;A<K;A++){B[A][G]*=N}}else{N=I/K;for(A=0;A<K;A++){B[A][G]=N}}}break;default:for(G=0;G<L;G++){E[M[0]][G]=0}break}for(G=0;G<L;G++){d=E[M[0]][G];for(A=1;A<K;A++){d+=B[M[A-1]][G];E[M[A]][G]=d}}A=F.indexOf("-");K=H?"h":"w";H=A<0?H?"l":"b":F.charAt(A+1);F=F.charAt(0);for(var D in l){l[D]=m}l[H]=function(o,p){return J[p]};l[F]=function(o,p){return E[o][p]};l[K]=function(o,p){return B[o][p]}};this.layer=(new pv.Mark).data(function(){return k[this.parent.index]}).top(i("t")).left(i("l")).right(i("r")).bottom(i("b")).width(i("w")).height(i("h"));this.layer.add=function(b){return n.add(pv.Panel).data(function(){return n.layers()}).add(b).extend(this)}};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");a=pv.Layout.Stack.prototype;a.defaults=(new pv.Layout.Stack).extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);a.$x=pv.Layout.Stack.prototype.$y=function(){return 0};a.x=function(c){this.$x=pv.functor(c);return this};a.y=function(c){this.$y=pv.functor(c);return this};a.$values=pv.identity;a.values=function(c){this.$values=pv.functor(c);return this};pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(c){return c.dx}).height(function(c){return c.dy});this.label.visible(function(c){return !c.firstChild}).left(function(c){return c.x+c.dx/2}).top(function(c){return c.y+c.dy/2}).textAlign("center").textAngle(function(c){return c.dx>c.dy?0:-Math.PI/2});(this.leaf=(new pv.Mark).extend(this.node).fillStyle(null).strokeStyle(null).visible(function(c){return !c.firstChild})).parent=this;delete this.link};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String);a=pv.Layout.Treemap.prototype;a.defaults=(new pv.Layout.Treemap).extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");a.padding=function(c){return this.paddingLeft(c).paddingRight(c).paddingTop(c).paddingBottom(c)};a.$size=function(c){return Number(c.nodeValue)};a.size=function(c){this.$size=pv.functor(c);return this};a.buildImplied=function(D){function C(b,l,j,g,k,c,i){for(var h=0,f=0;h<b.length;h++){var d=b[h];if(j){d.x=g+f;d.y=k;f+=d.dx=s(c*d.size/l);d.dy=i}else{d.x=g;d.y=k+f;d.dx=c;f+=d.dy=s(i*d.size/l)}}if(d){if(j){d.dx+=c-f}else{d.dy+=i-f}}}function B(h,g){for(var d=-Infinity,b=Infinity,f=0,i=0;i<h.length;i++){var c=h[i].size;if(c<b){b=c}if(c>d){d=c}f+=c}f*=f;g*=g;return Math.max(g*d/f,f/(g*b))}function A(b,m){function k(n){var F=d==g,o=pv.sum(n,r),q=g?s(o/g):0;C(n,o,F,h,l,F?d:q,F?q:j);if(F){l+=q;j-=q}else{h+=q;d-=q}g=Math.min(d,j);return F}var h=b.x+w,l=b.y+v,d=b.dx-w-u,j=b.dy-v-p;if(t!="squarify"){C(b.childNodes,b.size,t=="slice"?true:t=="dice"?false:m&1,h,l,d,j)}else{var i=[];m=Infinity;var g=Math.min(d,j),f=d*j/b.size;if(!(b.size<=0)){b.visitBefore(function(n){n.size*=f});for(b=b.childNodes.slice();b.length;){var c=b[b.length-1];if(c.size){i.push(c);f=B(i,g);if(f<=m){b.pop();m=f}else{i.pop();k(i);i.length=0;m=Infinity}}else{b.pop()}}if(k(i)){for(m=0;m<i.length;m++){i[m].dy+=j}}else{for(m=0;m<i.length;m++){i[m].dx+=d}}}}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,D)){var z=this,y=D.nodes[0],x=pv.Mark.stack,w=D.paddingLeft,u=D.paddingRight,v=D.paddingTop,p=D.paddingBottom,r=function(b){return b.size},s=D.round?Math.round:Number,t=D.mode;x.unshift(null);y.visitAfter(function(c,b){c.depth=b;c.x=c.y=c.dx=c.dy=0;c.size=c.firstChild?pv.sum(c.childNodes,function(d){return d.size
}):z.$size.apply(z,(x[0]=c,x))});x.shift();switch(D.order){case"ascending":y.sort(function(c,b){return c.size-b.size});break;case"descending":y.sort(function(c,b){return b.size-c.size});break;case"reverse":y.reverse();break}y.x=0;y.y=0;y.dx=D.width;y.dy=D.height;y.visitBefore(A)}};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=(new pv.Layout.Tree).extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");pv.Layout.Tree.prototype.buildImplied=function(N){function M(d){var c,b,g;if(d.firstChild){c=d.firstChild;b=d.lastChild;for(var f=g=c;f;f=f.nextSibling){M(f);g=K(f,g)}G(d);b=0.5*(c.prelim+b.prelim);if(c=d.previousSibling){d.prelim=c.prelim+F(d.depth,true);d.mod=d.prelim-b}else{d.prelim=b}}else{if(c=d.previousSibling){d.prelim=c.prelim+F(d.depth,true)}}}function L(d,c,b){d.breadth=d.prelim+c;c+=d.mod;for(d=d.firstChild;d;d=d.nextSibling){L(d,c,b)}}function K(f,k){var j=f.previousSibling;if(j){var i=f,h=f,c=j;j=f.parentNode.firstChild;var g=i.mod,b=h.mod,l=c.mod,m=j.mod;c=I(c);for(i=J(i);c&&i;){c=c;i=i;j=J(j);h=I(h);h.ancestor=f;var d=c.prelim+l-(i.prelim+g)+F(c.depth,false);if(d>0){H(E(c,f,k),f,d);g+=d;b+=d}l+=c.mod;g+=i.mod;m+=j.mod;b+=h.mod;c=I(c);i=J(i)}if(c&&!I(h)){h.thread=c;h.mod+=l-b}if(i&&!J(j)){j.thread=i;j.mod+=g-m;k=f}}return k}function J(b){return b.firstChild||b.thread}function I(b){return b.lastChild||b.thread}function H(d,c,b){var f=c.number-d.number;c.change-=b/f;c.shift+=b;d.change+=b/f;c.prelim+=b;c.mod+=b}function G(d){var c=0,b=0;for(d=d.lastChild;d;d=d.previousSibling){d.prelim+=c;d.mod+=c;b+=d.change;c+=d.shift+b}}function E(d,c,b){return d.ancestor.parentNode==c.parentNode?d.ancestor:b}function F(c,b){return(b?1:v+1)/(D=="radial"?c:1)}function A(b){return D=="radial"?b.breadth/z:0}function B(b){switch(D){case"left":return b.depth;case"right":return p-b.depth;case"top":case"bottom":return b.breadth+p/2;case"radial":return p/2+b.depth*Math.cos(A(b))}}function C(b){switch(D){case"left":case"right":return b.breadth+w/2;case"top":return b.depth;case"bottom":return w-b.depth;case"radial":return w/2+b.depth*Math.sin(A(b))}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,N)){var D=N.orient,z=N.depth,y=N.breadth,v=N.group,p=N.width,w=N.height;N=N.nodes[0];N.visitAfter(function(c,b){c.ancestor=c;c.prelim=0;c.mod=0;c.change=0;c.shift=0;c.number=c.previousSibling?c.previousSibling.number+1:0;c.depth=b});M(N);L(N,-N.prelim,0);N.visitAfter(function(b){b.breadth*=y;b.depth*=z;b.midAngle=A(b);b.x=B(b);b.y=C(b);if(b.firstChild){b.midAngle+=Math.PI}delete b.breadth;delete b.depth;delete b.ancestor;delete b.prelim;delete b.mod;delete b.change;delete b.shift;delete b.number;delete b.thread})}};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=(new pv.Layout.Indent).extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);pv.Layout.Indent.prototype.buildImplied=function(i){function n(d,c,b){d.x=k+b++*l;d.y=j+c++*m;d.midAngle=0;for(d=d.firstChild;d;d=d.nextSibling){c=n(d,c,b)}return c}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,i)){var m=i.breadth,l=i.depth,k=0,j=0;n(i.nodes[0],1,1)}};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.radius(function(c){return c.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=(new pv.Layout.Pack).extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1
};pv.Layout.Pack.prototype.size=function(c){this.$radius=typeof c=="function"?function(){return Math.sqrt(c.apply(this,arguments))}:(c=Math.sqrt(c),function(){return c});return this};pv.Layout.Pack.prototype.buildImplied=function(x){function w(f){var g=pv.Mark.stack;g.unshift(null);for(var b=0,d=f.length;b<d;b++){var c=f[b];if(!c.firstChild){c.radius=r.$radius.apply(r,(g[0]=c,g))}}g.shift()}function v(b){var c=[];for(b=b.firstChild;b;b=b.nextSibling){if(b.firstChild){b.radius=v(b)}b.n=b.p=b;c.push(b)}switch(x.order){case"ascending":c.sort(function(d,f){return d.radius-f.radius});break;case"descending":c.sort(function(d,f){return f.radius-d.radius});break;case"reverse":c.reverse();break}return u(c)}function u(J){function K(y){i=Math.min(y.x-y.radius,i);d=Math.max(y.x+y.radius,d);k=Math.min(y.y-y.radius,k);I=Math.max(y.y+y.radius,I)}function L(A,z){var y=A.n;A.n=z;z.p=A;z.n=y;y.p=z}function F(z,y){z.n=y;y.p=z}function l(C,A){var z=A.x-C.x,y=A.y-C.y;C=C.radius+A.radius;return C*C-z*z-y*y>0.001}var i=Infinity,d=-Infinity,k=Infinity,I=-Infinity,h,f,c,b,B;h=J[0];h.x=-h.radius;h.y=0;K(h);if(J.length>1){f=J[1];f.x=f.radius;f.y=0;K(f);if(J.length>2){c=J[2];t(h,f,c);K(c);L(h,c);h.p=c;L(c,f);f=h.n;for(var H=3;H<J.length;H++){t(h,f,c=J[H]);var q=0,g=1,j=1;for(b=f.n;b!=f;b=b.n,g++){if(l(b,c)){q=1;break}}if(q==1){for(B=h.p;B!=b.p;B=B.p,j++){if(l(B,c)){if(j<g){q=-1;b=B}break}}}if(q==0){L(h,c);f=c;K(c)}else{if(q>0){F(h,b);f=b;H--}else{if(q<0){F(b,f);h=b;H--}}}}}}h=(i+d)/2;f=(k+I)/2;for(H=c=0;H<J.length;H++){b=J[H];b.x-=h;b.y-=f;c=Math.max(c,b.radius+Math.sqrt(b.x*b.x+b.y*b.y))}return c+x.spacing}function t(i,j,c){var h=j.radius+c.radius,g=i.radius+c.radius,d=j.x-i.x;j=j.y-i.y;var b=Math.sqrt(d*d+j*j),f=(g*g+b*b-h*h)/(2*g*b);h=Math.acos(f);f=f*g;g=Math.sin(h)*g;d/=b;j/=b;c.x=i.x+f*d+g*j;c.y=i.y+f*j-g*d}function s(f,g,b,d){for(var c=f.firstChild;c;c=c.nextSibling){c.x+=f.x;c.y+=f.y;s(c,g,b,d)}f.x=g+d*f.x;f.y=b+d*f.y;f.radius*=d}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,x)){var r=this,p=x.nodes,n=p[0];w(p);n.x=0;n.y=0;n.radius=v(n);p=this.width();var o=this.height(),m=1/Math.max(2*n.radius/p,2*n.radius/o);s(n,p/2,o/2,m)}};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(d,f){return Math.sqrt(f.linkValue)*1.5});this.label.textAlign("center")};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=(new pv.Layout.Force).extend(pv.Layout.Network.prototype.defaults).dragConstant(0.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(0.9).springConstant(0.1).springDamping(0.3).springLength(20);pv.Layout.Force.prototype.buildImplied=function(v){function u(b){return b.fix?1:b.vx*b.vx+b.vy*b.vy}if(pv.Layout.Network.prototype.buildImplied.call(this,v)){if(v=v.$force){v.next=this.binds.$force;this.binds.$force=v}}else{for(var t=this,s=v.nodes,r=v.links,q=v.iterations,p=v.width,o=v.height,m=0,n;m<s.length;m++){n=s[m];if(isNaN(n.x)){n.x=p/2+40*Math.random()-20}if(isNaN(n.y)){n.y=o/2+40*Math.random()-20}}n=pv.simulation(s);n.force(pv.Force.drag(v.dragConstant));n.force(pv.Force.charge(v.chargeConstant).domain(v.chargeMinDistance,v.chargeMaxDistance).theta(v.chargeTheta));n.force(pv.Force.spring(v.springConstant).damping(v.springDamping).length(v.springLength).links(r));n.constraint(pv.Constraint.position());v.bound&&n.constraint(pv.Constraint.bound().x(6,p-6).y(6,o-6));if(q==null){n.step();n.step();v.$force=this.binds.$force={next:this.binds.$force,nodes:s,min:0.0001*(r.length+1),sim:n};if(!this.$timer){this.$timer=setInterval(function(){for(var b=false,c=t.binds.$force;c;c=c.next){if(pv.max(c.nodes,u)>c.min){c.sim.step();b=true}}b&&t.render()
},42)}}else{for(m=0;m<q;m++){n.step()}}}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var d,f=this.buildImplied;this.buildImplied=function(b){f.call(this,b);d=/^(top|bottom)$/.test(b.orient)?"step-before":/^(left|right)$/.test(b.orient)?"step-after":"linear"};this.link.interpolate(function(){return d})};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=(new pv.Layout.Cluster).extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");pv.Layout.Cluster.prototype.buildImplied=function(k){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,k)){var r=k.nodes[0],q=k.group,p,o,n=0,m=0.5-q/2,l=undefined;r.visitAfter(function(b){if(b.firstChild){b.depth=1+pv.max(b.childNodes,function(c){return c.depth})}else{if(q&&l!=b.parentNode){l=b.parentNode;n+=q}n++;b.depth=0}});p=1/n;o=1/r.depth;l=undefined;r.visitAfter(function(b){if(b.firstChild){b.breadth=pv.mean(b.childNodes,function(c){return c.breadth})}else{if(q&&l!=b.parentNode){l=b.parentNode;m+=q}b.breadth=p*m++}b.depth=1-b.depth*o});r.visitAfter(function(b){b.minBreadth=b.firstChild?b.firstChild.minBreadth:b.breadth-p/2;b.maxBreadth=b.firstChild?b.lastChild.maxBreadth:b.breadth+p/2});r.visitBefore(function(b){b.minDepth=b.parentNode?b.parentNode.maxDepth:0;b.maxDepth=b.parentNode?b.depth+r.depth:b.minDepth+2*r.depth});r.minDepth=-o;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,k)}};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(c){pv.Layout.Cluster.prototype.buildImplied.call(this,c)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,c)};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Partition.prototype.defaults=(new pv.Layout.Partition).extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1};pv.Layout.Partition.prototype.size=function(c){this.$size=c;return this};pv.Layout.Partition.prototype.buildImplied=function(i){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,i)){var n=this,m=i.nodes[0],l=pv.Mark.stack,k=0;l.unshift(null);m.visitAfter(function(c,b){if(b>k){k=b}c.size=c.firstChild?pv.sum(c.childNodes,function(d){return d.size}):n.$size.apply(n,(l[0]=c,l))});l.shift();switch(i.order){case"ascending":m.sort(function(c,b){return c.size-b.size});break;case"descending":m.sort(function(c,b){return b.size-c.size});break}var j=1/k;m.minBreadth=0;m.breadth=0.5;m.maxBreadth=1;m.visitBefore(function(f){for(var d=f.minBreadth,b=f.maxBreadth-d,c=f.firstChild;c;c=c.nextSibling){c.minBreadth=d;c.maxBreadth=d+=c.size/f.size*b;c.breadth=(d+c.minBreadth)/2}});m.visitAfter(function(c,b){c.minDepth=(b-1)*j;c.maxDepth=c.depth=b*j});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,i)}};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);pv.Layout.Partition.Fill.prototype.buildImplied=function(c){pv.Layout.Partition.prototype.buildImplied.call(this,c)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,c)};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var g,j,i,h=this.buildImplied;this.buildImplied=function(b){h.call(this,b);j=b.directed;g=b.orient=="radial"?"linear":"polar";i=b.orient=="right"||b.orient=="top"};this.link.data(function(c){var b=c.sourceNode;c=c.targetNode;return i!=(j||b.breadth<c.breadth)?[b,c]:[c,b]}).interpolate(function(){return g})};pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);
pv.Layout.Arc.prototype.defaults=(new pv.Layout.Arc).extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(c){this.$sort=c;return this};pv.Layout.Arc.prototype.buildImplied=function(B){function A(b){switch(w){case"top":return -Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return(b-0.25)*2*Math.PI}}function z(b){switch(w){case"top":case"bottom":return b*s;case"left":return 0;case"right":return s;case"radial":return s/2+m*Math.cos(A(b))}}function y(b){switch(w){case"top":return 0;case"bottom":return t;case"left":case"right":return b*t;case"radial":return t/2+m*Math.sin(A(b))}}if(!pv.Layout.Network.prototype.buildImplied.call(this,B)){var x=B.nodes,w=B.orient,v=this.$sort,u=pv.range(x.length),s=B.width,t=B.height,m=Math.min(s,t)/2;v&&u.sort(function(b,c){return v(x[b],x[c])});for(B=0;B<x.length;B++){var p=x[u[B]],r=p.breadth=(B+0.5)/x.length;p.x=z(r);p.y=y(r);p.midAngle=A(r)}}};pv.Layout.Horizon=function(){pv.Layout.call(this);var k=this,r,q,p,o,n,m,l=this.buildImplied;this.buildImplied=function(b){l.call(this,b);r=b.bands;q=b.mode;p=Math.round((q=="color"?0.5:1)*b.height);o=b.backgroundStyle;n=pv.ramp(o,b.negativeStyle).domain(0,r);m=pv.ramp(o,b.positiveStyle).domain(0,r)};r=(new pv.Panel).data(function(){return pv.range(r*2)}).overflow("hidden").height(function(){return p}).top(function(b){return q=="color"?(b&1)*p:0}).fillStyle(function(b){return b?null:o});this.band=(new pv.Mark).top(function(b,c){return q=="mirror"&&c&1?(c+1>>1)*p:null}).bottom(function(b,c){return q=="mirror"?c&1?null:(c+1>>1)*-p:(c&1||-1)*(c+1>>1)*p}).fillStyle(function(b,c){return(c&1?n:m)((c>>1)+1)});this.band.add=function(b){return k.add(pv.Panel).extend(r).add(b).extend(this)}};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color);pv.Layout.Horizon.prototype.defaults=(new pv.Layout.Horizon).extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var g=this,j,i,h=g.buildImplied;this.buildImplied=function(b){h.call(this,b);j=b.$rollup.nodes;i=b.$rollup.links};this.node.data(function(){return j}).size(function(b){return b.nodes.length*20});this.link.interpolate("polar").eccentricity(0.8);this.link.add=function(b){return g.add(pv.Panel).data(function(){return i}).add(b).extend(this)}};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Rollup.prototype.x=function(c){this.$x=pv.functor(c);return this};pv.Layout.Rollup.prototype.y=function(c){this.$y=pv.functor(c);return this};pv.Layout.Rollup.prototype.buildImplied=function(D){function C(b){return x[b]+","+w[b]}if(!pv.Layout.Network.prototype.buildImplied.call(this,D)){var B=D.nodes,A=D.links,z=D.directed,y=B.length,x=[],w=[],u=0,v={},p={},r=pv.Mark.stack,s={parent:this};r.unshift(null);for(var t=0;t<y;t++){s.index=t;r[0]=B[t];x[t]=this.$x.apply(s,r);w[t]=this.$y.apply(s,r)}r.shift();for(t=0;t<B.length;t++){y=C(t);r=v[y];if(!r){r=v[y]=pv.extend(B[t]);r.index=u++;r.x=x[t];r.y=w[t];r.nodes=[]}r.nodes.push(B[t])}for(t=0;t<A.length;t++){u=A[t].targetNode;B=v[C(A[t].sourceNode.index)];u=v[C(u.index)];y=!z&&B.index>u.index?u.index+","+B.index:B.index+","+u.index;(r=p[y])||(r=p[y]={sourceNode:B,targetNode:u,linkValue:0,links:[]});r.links.push(A[t]);r.linkValue+=A[t].linkValue}D.$rollup={nodes:pv.values(v),links:pv.values(p)}}};pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var i,n,m,l,k,j=this.buildImplied;this.buildImplied=function(b){j.call(this,b);i=b.nodes.length;n=b.width/i;m=b.height/i;l=b.$matrix.labels;k=b.$matrix.pairs};this.link.data(function(){return k}).left(function(){return n*(this.index%i)}).top(function(){return m*Math.floor(this.index/i)}).width(function(){return n}).height(function(){return m
}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(b){return b.linkValue?"#555":"#eee"}).parent=this;delete this.link.add;this.label.data(function(){return l}).left(function(){return this.index&1?n*((this.index>>1)+0.5):null}).top(function(){return this.index&1?null:m*((this.index>>1)+0.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0});delete this.node};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(c){this.$sort=c;return this};pv.Layout.Matrix.prototype.buildImplied=function(B){if(!pv.Layout.Network.prototype.buildImplied.call(this,B)){var A=B.nodes,z=B.links,y=this.$sort,x=A.length,w=pv.range(x),v=[],u=[],s={};B.$matrix={labels:v,pairs:u};y&&w.sort(function(b,c){return y(A[b],A[c])});for(var t=0;t<x;t++){for(var m=0;m<x;m++){var p=w[t],r=w[m];u.push(s[p+"."+r]={row:t,col:m,sourceNode:A[p],targetNode:A[r],linkValue:0})}}for(t=0;t<x;t++){p=w[t];v.push(A[p],A[p])}for(t=0;t<z.length;t++){v=z[t];x=v.sourceNode.index;w=v.targetNode.index;v=v.linkValue;s[x+"."+w].linkValue+=v;B.directed||(s[w+"."+x].linkValue+=v)}}};pv.Layout.Bullet=function(){pv.Layout.call(this);var k=this,r=k.buildImplied,q=k.x=pv.Scale.linear(),p,o,n,m,l;this.buildImplied=function(b){r.call(this,l=b);p=b.orient;o=/^left|right$/.test(p);n=pv.ramp("#bbb","#eee").domain(0,Math.max(1,l.ranges.length-1));m=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,l.measures.length-1))};(this.range=new pv.Mark).data(function(){return l.ranges}).reverse(true).left(function(){return p=="left"?0:null}).top(function(){return p=="top"?0:null}).right(function(){return p=="right"?0:null}).bottom(function(){return p=="bottom"?0:null}).width(function(b){return o?q(b):null}).height(function(b){return o?null:q(b)}).fillStyle(function(){return n(this.index)}).antialias(false).parent=k;(this.measure=new pv.Mark).extend(this.range).data(function(){return l.measures}).left(function(){return p=="left"?0:o?null:this.parent.width()/3.25}).top(function(){return p=="top"?0:o?this.parent.height()/3.25:null}).right(function(){return p=="right"?0:o?null:this.parent.width()/3.25}).bottom(function(){return p=="bottom"?0:o?this.parent.height()/3.25:null}).fillStyle(function(){return m(this.index)}).parent=k;(this.marker=new pv.Mark).data(function(){return l.markers}).left(function(b){return p=="left"?q(b):o?null:this.parent.width()/2}).top(function(b){return p=="top"?q(b):o?this.parent.height()/2:null}).right(function(b){return p=="right"?q(b):null}).bottom(function(b){return p=="bottom"?q(b):null}).strokeStyle("black").shape("bar").angle(function(){return o?0:Math.PI/2}).parent=k;(this.tick=new pv.Mark).data(function(){return q.ticks(7)}).left(function(b){return p=="left"?q(b):null}).top(function(b){return p=="top"?q(b):null}).right(function(b){return p=="right"?q(b):o?null:-6}).bottom(function(b){return p=="bottom"?q(b):o?-8:null}).height(function(){return o?6:null}).width(function(){return o?null:6}).parent=k};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number);pv.Layout.Bullet.prototype.defaults=(new pv.Layout.Bullet).extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);pv.Layout.Bullet.prototype.buildImplied=function(d){pv.Layout.prototype.buildImplied.call(this,d);var f=this.parent[/^left|right$/.test(d.orient)?"width":"height"]();d.maximum=d.maximum||pv.max([].concat(d.ranges,d.markers,d.measures));this.x.domain(0,d.maximum).range(0,f)};pv.Behavior={};pv.Behavior.drag=function(){function k(b){o=this.index;p=this.scene;var c=this.mouse();m=((n=b).fix=pv.vector(b.x,b.y)).minus(c);l={x:this.parent.width()-(b.dx||0),y:this.parent.height()-(b.dy||0)};p.mark.context(p,o,function(){this.render()});pv.Mark.dispatch("dragstart",p,o)}function r(){if(p){p.mark.context(p,o,function(){var b=this.mouse();
n.x=n.fix.x=Math.max(0,Math.min(m.x+b.x,l.x));n.y=n.fix.y=Math.max(0,Math.min(m.y+b.y,l.y));this.render()});pv.Mark.dispatch("drag",p,o)}}function q(){if(p){n.fix=null;p.mark.context(p,o,function(){this.render()});pv.Mark.dispatch("dragend",p,o);p=null}}var p,o,n,m,l;pv.listen(window,"mousemove",r);pv.listen(window,"mouseup",q);return k};pv.Behavior.point=function(t){function s(i,c){i=i[c];c={cost:Infinity};for(var f=0,g=i.visible&&i.children.length;f<g;f++){var h=i.children[f],b=h.mark,w;if(b.type=="panel"){b.scene=h;for(var l=0,j=h.length;l<j;l++){b.index=l;w=s(h,l);if(w.cost<c.cost){c=w}}delete b.scene;delete b.index}else{if(b.$handlers.point){b=b.mouse();l=0;for(j=h.length;l<j;l++){var v=h[l];w=b.x-v.left-(v.width||0)/2;v=b.y-v.top-(v.height||0)/2;var d=n*w*w+m*v*v;if(d<c.cost){c.distance=w*w+v*v;c.cost=d;c.scene=h;c.index=l}}}}}return c}function r(){var b=s(this.scene,this.index);if(b.cost==Infinity||b.distance>k){b=null}if(p){if(b&&p.scene==b.scene&&p.index==b.index){return}pv.Mark.dispatch("unpoint",p.scene,p.index)}if(p=b){pv.Mark.dispatch("point",b.scene,b.index);pv.listen(this.root.canvas(),"mouseout",q)}}function q(b){if(p&&!pv.ancestor(this,b.relatedTarget)){pv.Mark.dispatch("unpoint",p.scene,p.index);p=null}}var p,o=null,n=1,m=1,k=arguments.length?t*t:900;r.collapse=function(b){if(arguments.length){o=String(b);switch(o){case"y":n=1;m=0;break;case"x":n=0;m=1;break;default:m=n=1;break}return r}return o};return r};pv.Behavior.select=function(){function j(b){m=this.index;n=this.scene;k=this.mouse();l=b;l.x=k.x;l.y=k.y;l.dx=l.dy=0;pv.Mark.dispatch("selectstart",n,m)}function p(){if(n){n.mark.context(n,m,function(){var b=this.mouse();l.x=Math.max(0,Math.min(k.x,b.x));l.y=Math.max(0,Math.min(k.y,b.y));l.dx=Math.min(this.width(),Math.max(b.x,k.x))-l.x;l.dy=Math.min(this.height(),Math.max(b.y,k.y))-l.y;this.render()});pv.Mark.dispatch("select",n,m)}}function o(){if(n){pv.Mark.dispatch("selectend",n,m);n=null}}var n,m,l,k;pv.listen(window,"mousemove",p);pv.listen(window,"mouseup",o);return j};pv.Behavior.resize=function(k){function r(b){n=this.index;o=this.scene;l=this.mouse();m=b;switch(k){case"left":l.x=m.x+m.dx;break;case"right":l.x=m.x;break;case"top":l.y=m.y+m.dy;break;case"bottom":l.y=m.y;break}pv.Mark.dispatch("resizestart",o,n)}function q(){if(o){o.mark.context(o,n,function(){var b=this.mouse();m.x=Math.max(0,Math.min(l.x,b.x));m.y=Math.max(0,Math.min(l.y,b.y));m.dx=Math.min(this.parent.width(),Math.max(b.x,l.x))-m.x;m.dy=Math.min(this.parent.height(),Math.max(b.y,l.y))-m.y;this.render()});pv.Mark.dispatch("resize",o,n)}}function p(){if(o){pv.Mark.dispatch("resizeend",o,n);o=null}}var o,n,m,l;pv.listen(window,"mousemove",q);pv.listen(window,"mouseup",p);return r};pv.Behavior.pan=function(){function t(){p=this.index;q=this.scene;n=pv.vector(pv.event.pageX,pv.event.pageY);o=this.transform();m=1/(o.k*this.scale);if(k){k={x:(1-o.k)*this.width(),y:(1-o.k)*this.height()}}}function s(){if(q){q.mark.context(q,p,function(){var b=o.translate((pv.event.pageX-n.x)*m,(pv.event.pageY-n.y)*m);if(k){b.x=Math.max(k.x,Math.min(0,b.x));b.y=Math.max(k.y,Math.min(0,b.y))}this.transform(b).render()});pv.Mark.dispatch("pan",q,p)}}function r(){q=null}var q,p,o,n,m,k;t.bound=function(b){if(arguments.length){k=Boolean(b);return this}return Boolean(k)};pv.listen(window,"mousemove",s);pv.listen(window,"mouseup",r);return t};pv.Behavior.zoom=function(f){function h(){var c=this.mouse(),b=pv.event.wheel*f;c=this.transform().translate(c.x,c.y).scale(b<0?1000/(1000-b):(1000+b)/1000).translate(-c.x,-c.y);if(g){c.k=Math.max(1,c.k);c.x=Math.max((1-c.k)*this.width(),Math.min(0,c.x));c.y=Math.max((1-c.k)*this.height(),Math.min(0,c.y))}this.transform(c).render();pv.Mark.dispatch("zoom",this.scene,this.index)}var g;arguments.length||(f=1/48);h.bound=function(b){if(arguments.length){g=Boolean(b);return this}return Boolean(g)};return h};pv.Geo=function(){};pv.Geo.projections={mercator:{project:function(c){return{x:c.lng/180,y:c.lat>85?1:c.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(c.lat)/2))/Math.PI}
},invert:function(c){return{lng:c.x*180,lat:pv.degrees(2*Math.atan(Math.exp(c.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(c){return{x:c.lng/180,y:Math.sin(pv.radians(c.lat))}},invert:function(c){return{lng:c.x*180,lat:pv.degrees(Math.asin(c.y))}}},sinusoidal:{project:function(c){return{x:pv.radians(c.lng)*Math.cos(pv.radians(c.lat))/Math.PI,y:c.lat/90}},invert:function(c){return{lng:pv.degrees(c.x*Math.PI/Math.cos(c.y*Math.PI/2)),lat:c.y*90}}},aitoff:{project:function(f){var h=pv.radians(f.lng);f=pv.radians(f.lat);var g=Math.acos(Math.cos(f)*Math.cos(h/2));return{x:2*(g?Math.cos(f)*Math.sin(h/2)*g/Math.sin(g):0)/Math.PI,y:2*(g?Math.sin(f)*g/Math.sin(g):0)/Math.PI}},invert:function(d){var f=d.y*Math.PI/2;return{lng:pv.degrees(d.x*Math.PI/2/Math.cos(f)),lat:pv.degrees(f)}}},hammer:{project:function(f){var h=pv.radians(f.lng);f=pv.radians(f.lat);var g=Math.sqrt(1+Math.cos(f)*Math.cos(h/2));return{x:2*Math.SQRT2*Math.cos(f)*Math.sin(h/2)/g/3,y:Math.SQRT2*Math.sin(f)/g/1.5}},invert:function(f){var h=f.x*3;f=f.y*1.5;var g=Math.sqrt(1-h*h/16-f*f/4);return{lng:pv.degrees(2*Math.atan2(g*h,2*(2*g*g-1))),lat:pv.degrees(Math.asin(g*f))}}},identity:{project:function(c){return{x:c.lng/180,y:c.lat/90}},invert:function(c){return{lng:c.x*180,lat:c.y*90}}}};pv.Geo.scale=function(B){function A(b){if(!p||b.lng!=p.lng||b.lat!=p.lat){p=b;b=z(b);r={x:s(b.x),y:t(b.y)}}return r}function z(b){return u.project({lng:b.lng-m.lng,lat:b.lat})}function y(b){b=u.invert(b);b.lng+=m.lng;return b}var x={x:0,y:0},w={x:1,y:1},v=[],u=pv.Geo.projections.identity,s=pv.Scale.linear(-1,1).range(0,1),t=pv.Scale.linear(-1,1).range(1,0),m={lng:0,lat:0},p,r;A.x=function(b){return A(b).x};A.y=function(b){return A(b).y};A.ticks={lng:function(b){var d;if(v.length>1){var c=pv.Scale.linear();if(b==undefined){b=10}d=c.domain(v,function(f){return f.lat}).ticks(b);b=c.domain(v,function(f){return f.lng}).ticks(b)}else{d=pv.range(-80,81,10);b=pv.range(-180,181,10)}return b.map(function(f){return d.map(function(g){return{lat:g,lng:f}})})},lat:function(b){return pv.transpose(A.ticks.lng(b))}};A.invert=function(b){return y({x:s.invert(b.x),y:t.invert(b.y)})};A.domain=function(b,f){if(arguments.length){v=b instanceof Array?arguments.length>1?pv.map(b,f):b:Array.prototype.slice.call(arguments);if(v.length>1){var d=v.map(function(g){return g.lng}),c=v.map(function(g){return g.lat});m={lng:(pv.max(d)+pv.min(d))/2,lat:(pv.max(c)+pv.min(c))/2};d=v.map(z);s.domain(d,function(g){return g.x});t.domain(d,function(g){return g.y})}else{m={lng:0,lat:0};s.domain(-1,1);t.domain(-1,1)}p=null;return this}return v};A.range=function(b,c){if(arguments.length){if(typeof b=="object"){x={x:Number(b.x),y:Number(b.y)};w={x:Number(c.x),y:Number(c.y)}}else{x={x:0,y:0};w={x:Number(b),y:Number(c)}}s.range(x.x,w.x);t.range(w.y,x.y);p=null;return this}return[x,w]};A.projection=function(b){if(arguments.length){u=typeof b=="string"?pv.Geo.projections[b]||pv.Geo.projections.identity:b;return this.domain(v)}return b};A.by=function(b){function d(){return A(b.apply(this,arguments))}for(var c in A){d[c]=A[c]}return d};arguments.length&&A.projection(B);return A};