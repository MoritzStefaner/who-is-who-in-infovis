if(!Array.prototype.map){Array.prototype.map=function(c,d){var g=this.length;var a=new Array(g);for(var b=0;b<g;b++){if(b in this){a[b]=c.call(d,this[b],b,this)}}return a}}if(!Array.prototype.filter){Array.prototype.filter=function(d,g){var h=this.length;var a=new Array();for(var c=0;c<h;c++){if(c in this){var b=this[c];if(d.call(g,b,c,this)){a.push(b)}}}return a}}if(!Array.prototype.forEach){Array.prototype.forEach=function(b,c){var d=this.length>>>0;for(var a=0;a<d;a++){if(a in this){b.call(c,this[a],a,this)}}}}if(!Array.prototype.reduce){Array.prototype.reduce=function(d,b){var a=this.length;if(!a&&(arguments.length==1)){throw new Error("reduce: empty array, no initial value")}var c=0;if(arguments.length<2){while(true){if(c in this){b=this[c++];break}if(++c>=a){throw new Error("reduce: no values, no initial value")}}}for(;c<a;c++){if(c in this){b=d(b,this[c],c,this)}}return b}}var pv={};pv.version={major:3,minor:2};pv.identity=function(a){return a};pv.index=function(){return this.index};pv.child=function(){return this.childIndex};pv.parent=function(){return this.parent.index};pv.extend=function(b){function a(){}a.prototype=b.prototype||b;return new a()};try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(a){var n=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),f,k,h=0,o="";while(f=n.exec(a)){var g=f.index+f[0].length;if(a.charAt(g)!="{"){o+=a.substring(h,g)+"{return ";h=g;for(var b=0;b>=0&&g<a.length;g++){var l=a.charAt(g);switch(l){case'"':case"'":while(++g<a.length&&(k=a.charAt(g))!=l){if(k=="\\"){g++}}break;case"[":case"(":b++;break;case"]":case")":b--;break;case";":case",":if(b==0){b--}break}}o+=pv.parse(a.substring(h,--g))+";}";h=g}n.lastIndex=g}o+=a.substring(h);return o}}pv.css=function(b,a){return window.getComputedStyle?window.getComputedStyle(b,null).getPropertyValue(a):b.currentStyle[a]};pv.error=function(a){(typeof console=="undefined")?alert(a):console.error(a)};pv.listen=function(c,a,b){b=pv.listener(b);return c.addEventListener?c.addEventListener(a,b,false):c.attachEvent("on"+a,b)};pv.listener=function(a){return a.$listener||(a.$listener=function(b){try{pv.event=b;return a.call(this,b)}finally{delete pv.event}})};pv.ancestor=function(b,c){while(c){if(c==b){return true}c=c.parentNode}return false};pv.id=function(){var a=1;return function(){return a++}}();pv.functor=function(a){return typeof a=="function"?a:function(){return a}};pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")};for(;pv.$.i<pv.$.x.length;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis"){try{window.eval(pv.parse(pv.$.s.text))}catch(e){pv.error(e)}}}delete pv.$});pv.Format={};pv.Format.re=function(a){return a.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(f,d,b){var a=d-String(b).length;return(a<1)?b:new Array(a+1).join(f)+b};pv.Format.date=function(a){var c=pv.Format.pad;function b(f){return a.replace(/%[a-zA-Z0-9]/g,function(i){switch(i){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][f.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][f.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][f.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][f.getMonth()];case"%c":return f.toLocaleString();case"%C":return c("0",2,Math.floor(f.getFullYear()/100)%100);case"%d":return c("0",2,f.getDate());case"%x":case"%D":return c("0",2,f.getMonth()+1)+"/"+c("0",2,f.getDate())+"/"+c("0",2,f.getFullYear()%100);case"%e":return c(" ",2,f.getDate());case"%H":return c("0",2,f.getHours());case"%I":var g=f.getHours()%12;return g?c("0",2,g):12;case"%m":return c("0",2,f.getMonth()+1);case"%M":return c("0",2,f.getMinutes());case"%n":return"\n";case"%p":return f.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":var g=f.getHours()%12;return(g?c("0",2,g):12)+":"+c("0",2,f.getMinutes())+":"+c("0",2,f.getSeconds())+" "+(f.getHours()<12?"AM":"PM");
case"%R":return c("0",2,f.getHours())+":"+c("0",2,f.getMinutes());case"%S":return c("0",2,f.getSeconds());case"%Q":return c("0",3,f.getMilliseconds());case"%t":return"\t";case"%u":var d=f.getDay();return d?d:1;case"%w":return f.getDay();case"%y":return c("0",2,f.getFullYear()%100);case"%Y":return f.getFullYear();case"%%":return"%"}return i})}b.format=b;b.parse=function(n){var l=1970,k=0,f=1,h=0,g=0,d=0;var j=[function(){}];var m=pv.Format.re(a).replace(/%[a-zA-Z0-9]/g,function(o){switch(o){case"%b":j.push(function(p){k={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[p]});return"([A-Za-z]+)";case"%h":case"%B":j.push(function(p){k={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[p]});return"([A-Za-z]+)";case"%e":case"%d":j.push(function(p){f=p});return"([0-9]+)";case"%I":case"%H":j.push(function(p){h=p});return"([0-9]+)";case"%m":j.push(function(p){k=p-1});return"([0-9]+)";case"%M":j.push(function(p){g=p});return"([0-9]+)";case"%p":j.push(function(p){if(h==12){if(p=="am"){h=0}}else{if(p=="pm"){h=Number(h)+12}}});return"(am|pm)";case"%S":j.push(function(p){d=p});return"([0-9]+)";case"%y":j.push(function(p){p=Number(p);l=p+(((0<=p)&&(p<69))?2000:(((p>=69)&&(p<100)?1900:0)))});return"([0-9]+)";case"%Y":j.push(function(p){l=p});return"([0-9]+)";case"%%":j.push(function(){});return"%"}return o});var i=n.match(m);if(i){i.forEach(function(o,p){j[p](o)})}return new Date(l,k,f,h,g,d)};return b};pv.Format.time=function(a){var c=pv.Format.pad;function b(g){g=Number(g);switch(a){case"short":if(g>=31536000000){return(g/31536000000).toFixed(1)+" years"}else{if(g>=604800000){return(g/604800000).toFixed(1)+" weeks"}else{if(g>=86400000){return(g/86400000).toFixed(1)+" days"}else{if(g>=3600000){return(g/3600000).toFixed(1)+" hours"}else{if(g>=60000){return(g/60000).toFixed(1)+" minutes"}}}}}return(g/1000).toFixed(1)+" seconds";case"long":var f=[],j=((g%60000)/1000)>>0,d=((g%3600000)/60000)>>0;f.push(c("0",2,j));if(g>=3600000){var i=((g%86400000)/3600000)>>0;f.push(c("0",2,d));if(g>=86400000){f.push(c("0",2,i));f.push(Math.floor(g/86400000).toFixed())}else{f.push(i.toFixed())}}else{f.push(d.toFixed())}return f.reverse().join(":")}}b.format=b;b.parse=function(j){switch(a){case"short":var i=/([0-9,.]+)\s*([a-z]+)/g,d,h=0;while(d=i.exec(j)){var k=parseFloat(d[0].replace(",","")),g=0;switch(d[2].toLowerCase()){case"year":case"years":g=31536000000;break;case"week":case"weeks":g=604800000;break;case"day":case"days":g=86400000;break;case"hour":case"hours":g=3600000;break;case"minute":case"minutes":g=60000;break;case"second":case"seconds":g=1000;break}h+=k*g}return h;case"long":var d=j.replace(",","").split(":").reverse(),h=0;if(d.length){h+=parseFloat(d[0])*1000}if(d.length>1){h+=parseFloat(d[1])*60000}if(d.length>2){h+=parseFloat(d[2])*3600000}if(d.length>3){h+=parseFloat(d[3])*86400000}return h}};return b};pv.Format.number=function(){var h=0,c=Infinity,a=0,k=0,f=0,b=1,g="0",j="0",i=true,d=".",m=",";function l(o){if(Infinity>f){o=Math.round(o*b)/b}var q=String(Math.abs(o)).split(".");var p=q[0],t=(o<0)?"-":"";if(p.length>c){p=p.substring(p.length-c)}if(i&&(p.length<h)){p=t+new Array(h-p.length+1).join(g)+p}if(p.length>3){p=p.replace(/\B(?=(?:\d{3})+(?!\d))/g,m)}if(!i&&(p.length<a)){p=new Array(a-p.length+1).join(g)+t+p}q[0]=p;var r=q[1]||"";if(r.length<k){q[1]=r+new Array(k-r.length+1).join(j)}return q.join(d)}l.format=l;l.parse=function(n){var q=pv.Format.re;var p=String(n).replace(new RegExp("^("+q(g)+")*"),"").replace(new RegExp("("+q(j)+")*$"),"").split(d);var o=p[0].replace(new RegExp(q(m),"g"),"");if(o.length>c){o=o.substring(o.length-c)}var r=p[1]?Number("0."+p[1]):0;if(Infinity>f){r=Math.round(r*b)/b}return Math.round(o)+r};l.integerDigits=function(o,n){if(arguments.length){h=Number(o);c=(arguments.length>1)?Number(n):h;a=h+Math.floor(h/3)*m.length;return this}return[h,c]};l.fractionDigits=function(o,n){if(arguments.length){k=Number(o);f=(arguments.length>1)?Number(n):k;
b=Math.pow(10,f);return this}return[k,f]};l.integerPad=function(n){if(arguments.length){g=String(n);i=/\d/.test(g);return this}return g};l.fractionPad=function(n){if(arguments.length){j=String(n);return this}return j};l.decimal=function(n){if(arguments.length){d=String(n);return this}return d};l.group=function(n){if(arguments.length){m=n?String(n):"";a=h+Math.floor(h/3)*m.length;return this}return m};return l};pv.map=function(c,a){var b={};return a?c.map(function(g,f){b.index=f;return a.call(b,g)}):c.slice()};pv.repeat=function(b,a){if(arguments.length==1){a=2}return pv.blend(pv.range(a).map(function(){return b}))};pv.cross=function(g,f){var o=[];for(var k=0,l=g.length,d=f.length;k<l;k++){for(var h=0,c=g[k];h<d;h++){o.push([c,f[h]])}}return o};pv.blend=function(a){return Array.prototype.concat.apply([],a)};pv.transpose=function(f){var g=f.length,a=pv.max(f,function(h){return h.length});if(a>g){f.length=a;for(var d=g;d<a;d++){f[d]=new Array(g)}for(var d=0;d<g;d++){for(var b=d+1;b<a;b++){var c=f[d][b];f[d][b]=f[b][d];f[b][d]=c}}}else{for(var d=0;d<a;d++){f[d].length=g}for(var d=0;d<g;d++){for(var b=0;b<d;b++){var c=f[d][b];f[d][b]=f[b][d];f[b][d]=c}}}f.length=a;for(var d=0;d<a;d++){f[d].length=g}return f};pv.normalize=function(g,d){var b=pv.map(g,d),c=pv.sum(b);for(var a=0;a<b.length;a++){b[a]/=c}return b};pv.permute=function(g,a,b){if(!b){b=pv.identity}var c=new Array(a.length),d={};a.forEach(function(f,h){d.index=f;c[h]=b.call(d,g[f])});return c};pv.numerate=function(a,b){if(!b){b=pv.identity}var c={},d={};a.forEach(function(f,g){d.index=g;c[b.call(d,f)]=g});return c};pv.uniq=function(h,b){if(!b){b=pv.identity}var c={},a=[],d={},g;h.forEach(function(f,j){d.index=j;g=b.call(d,f);if(!(g in c)){c[g]=a.push(g)}});return a};pv.naturalOrder=function(d,c){return(d<c)?-1:((d>c)?1:0)};pv.reverseOrder=function(c,d){return(d<c)?-1:((d>c)?1:0)};pv.search=function(i,h,g){if(!g){g=pv.identity}var a=0,d=i.length-1;while(a<=d){var b=(a+d)>>1,c=g(i[b]);if(c<h){a=b+1}else{if(c>h){d=b-1}else{return b}}}return -a-1};pv.search.index=function(d,c,b){var a=pv.search(d,c,b);return(a<0)?(-a-1):a};pv.range=function(g,c,d){if(arguments.length==1){c=g;g=0}if(d==undefined){d=1}if((c-g)/d==Infinity){throw new Error("range must be finite")}var f=[],b=0,a;if(d<0){while((a=g+d*b++)>c){f.push(a)}}else{while((a=g+d*b++)<c){f.push(a)}}return f};pv.random=function(c,a,b){if(arguments.length==1){a=c;c=0}if(b==undefined){b=1}return b?(Math.floor(Math.random()*(a-c)/b)*b+c):(Math.random()*(a-c)+c)};pv.sum=function(c,a){var b={};return c.reduce(a?function(g,h,f){b.index=f;return g+a.call(b,h)}:function(f,g){return f+g},0)};pv.max=function(b,a){if(a==pv.index){return b.length-1}return Math.max.apply(null,a?pv.map(b,a):b)};pv.max.index=function(j,d){if(!j.length){return -1}if(d==pv.index){return j.length-1}if(!d){d=pv.identity}var b=0,h=-Infinity,g={};for(var c=0;c<j.length;c++){g.index=c;var a=d.call(g,j[c]);if(a>h){h=a;b=c}}return b};pv.min=function(b,a){if(a==pv.index){return 0}return Math.min.apply(null,a?pv.map(b,a):b)};pv.min.index=function(j,g){if(!j.length){return -1}if(g==pv.index){return 0}if(!g){g=pv.identity}var d=0,b=Infinity,h={};for(var c=0;c<j.length;c++){h.index=c;var a=g.call(h,j[c]);if(a<b){b=a;d=c}}return d};pv.mean=function(b,a){return pv.sum(b,a)/b.length};pv.median=function(c,b){if(b==pv.index){return(c.length-1)/2}c=pv.map(c,b).sort(pv.naturalOrder);if(c.length%2){return c[Math.floor(c.length/2)]}var a=c.length/2;return(c[a-1]+c[a])/2};pv.variance=function(k,g){if(k.length<1){return NaN}if(k.length==1){return 0}var a=pv.mean(k,g),c=0,j={};if(!g){g=pv.identity}for(var b=0;b<k.length;b++){j.index=b;var h=g.call(j,k[b])-a;c+=h*h}return c};pv.deviation=function(b,a){return Math.sqrt(pv.variance(b,a)/(b.length-1))};pv.log=function(c,a){return Math.log(c)/Math.log(a)};pv.logSymmetric=function(c,a){return(c==0)?0:((c<0)?-pv.log(-c,a):pv.log(c,a))};pv.logAdjusted=function(c,a){if(!isFinite(c)){return c}var d=c<0;if(c<a){c+=(a-c)/a}return d?-pv.log(c,a):pv.log(c,a)
};pv.logFloor=function(c,a){return(c>0)?Math.pow(a,Math.floor(pv.log(c,a))):-Math.pow(a,-Math.floor(-pv.log(-c,a)))};pv.logCeil=function(c,a){return(c>0)?Math.pow(a,Math.ceil(pv.log(c,a))):-Math.pow(a,-Math.ceil(-pv.log(-c,a)))};(function(){var a=Math.PI/180,b=180/Math.PI;pv.radians=function(c){return a*c};pv.degrees=function(c){return b*c}})();pv.keys=function(b){var c=[];for(var a in b){c.push(a)}return c};pv.entries=function(b){var c=[];for(var a in b){c.push({key:a,value:b[a]})}return c};pv.values=function(b){var c=[];for(var a in b){c.push(b[a])}return c};pv.dict=function(d,g){var a={},h={};for(var c=0;c<d.length;c++){if(c in d){var b=d[c];h.index=c;a[b]=g.call(h,b)}}return a};pv.dom=function(a){return new pv.Dom(a)};pv.Dom=function(a){this.$map=a};pv.Dom.prototype.$leaf=function(a){return typeof a!="object"};pv.Dom.prototype.leaf=function(a){if(arguments.length){this.$leaf=a;return this}return this.$leaf};pv.Dom.prototype.root=function(d){var b=this.$leaf,a=c(this.$map);function c(h){var i=new pv.Dom.Node();for(var g in h){var f=h[g];i.appendChild(b(f)?new pv.Dom.Node(f):c(f)).nodeName=g}return i}a.nodeName=d;return a};pv.Dom.prototype.nodes=function(){return this.root().nodes()};pv.Dom.Node=function(a){this.nodeValue=a;this.childNodes=[]};pv.Dom.Node.prototype.parentNode=null;pv.Dom.Node.prototype.firstChild=null;pv.Dom.Node.prototype.lastChild=null;pv.Dom.Node.prototype.previousSibling=null;pv.Dom.Node.prototype.nextSibling=null;pv.Dom.Node.prototype.removeChild=function(b){var a=this.childNodes.indexOf(b);if(a==-1){throw new Error("child not found")}this.childNodes.splice(a,1);if(b.previousSibling){b.previousSibling.nextSibling=b.nextSibling}else{this.firstChild=b.nextSibling}if(b.nextSibling){b.nextSibling.previousSibling=b.previousSibling}else{this.lastChild=b.previousSibling}delete b.nextSibling;delete b.previousSibling;delete b.parentNode;return b};pv.Dom.Node.prototype.appendChild=function(a){if(a.parentNode){a.parentNode.removeChild(a)}a.parentNode=this;a.previousSibling=this.lastChild;if(this.lastChild){this.lastChild.nextSibling=a}else{this.firstChild=a}this.lastChild=a;this.childNodes.push(a);return a};pv.Dom.Node.prototype.insertBefore=function(c,b){if(!b){return this.appendChild(c)}var a=this.childNodes.indexOf(b);if(a==-1){throw new Error("child not found")}if(c.parentNode){c.parentNode.removeChild(c)}c.parentNode=this;c.nextSibling=b;c.previousSibling=b.previousSibling;if(b.previousSibling){b.previousSibling.nextSibling=c}else{if(b==this.lastChild){this.lastChild=c}this.firstChild=c}this.childNodes.splice(a,0,c);return c};pv.Dom.Node.prototype.replaceChild=function(c,b){var a=this.childNodes.indexOf(b);if(a==-1){throw new Error("child not found")}if(c.parentNode){c.parentNode.removeChild(c)}c.parentNode=this;c.nextSibling=b.nextSibling;c.previousSibling=b.previousSibling;if(b.previousSibling){b.previousSibling.nextSibling=c}else{this.firstChild=c}if(b.nextSibling){b.nextSibling.previousSibling=c}else{this.lastChild=c}this.childNodes[a]=c;return b};pv.Dom.Node.prototype.visitBefore=function(b){function a(g,d){b(g,d);for(var f=g.firstChild;f;f=f.nextSibling){a(f,d+1)}}a(this,0)};pv.Dom.Node.prototype.visitAfter=function(b){function a(g,d){for(var f=g.firstChild;f;f=f.nextSibling){a(f,d+1)}b(g,d)}a(this,0)};pv.Dom.Node.prototype.sort=function(b){if(this.firstChild){this.childNodes.sort(b);var d=this.firstChild=this.childNodes[0],g;delete d.previousSibling;for(var a=1;a<this.childNodes.length;a++){d.sort(b);g=this.childNodes[a];g.previousSibling=d;d=d.nextSibling=g}this.lastChild=d;delete d.nextSibling;d.sort(b)}return this};pv.Dom.Node.prototype.reverse=function(){var a=[];this.visitAfter(function(d){while(d.lastChild){a.push(d.removeChild(d.lastChild))}for(var b;b=a.pop();){d.insertBefore(b,d.firstChild)}});return this};pv.Dom.Node.prototype.nodes=function(){var b=[];function a(c){b.push(c);c.childNodes.forEach(a)}a(this,b);return b};pv.Dom.Node.prototype.toggle=function(a){if(a){return this.toggled?this.visitBefore(function(c){if(c.toggled){c.toggle()
}}):this.visitAfter(function(c){if(!c.toggled){c.toggle()}})}var d=this;if(d.toggled){for(var b;b=d.toggled.pop();){d.appendChild(b)}delete d.toggled}else{if(d.lastChild){d.toggled=[];while(d.lastChild){d.toggled.push(d.removeChild(d.lastChild))}}}};pv.nodes=function(b){var a=new pv.Dom.Node();for(var c=0;c<b.length;c++){a.appendChild(new pv.Dom.Node(b[c]))}return a.nodes()};pv.tree=function(a){return new pv.Tree(a)};pv.Tree=function(a){this.array=a};pv.Tree.prototype.keys=function(a){this.k=a;return this};pv.Tree.prototype.value=function(a){this.v=a;return this};pv.Tree.prototype.map=function(){var g={},h={};for(var b=0;b<this.array.length;b++){h.index=b;var f=this.array[b],d=this.k.call(h,f),c=g;for(var a=0;a<d.length-1;a++){c=c[d[a]]||(c[d[a]]={})}c[d[a]]=this.v?this.v.call(h,f):f}return g};pv.nest=function(a){return new pv.Nest(a)};pv.Nest=function(a){this.array=a;this.keys=[]};pv.Nest.prototype.key=function(a){this.keys.push(a);return this};pv.Nest.prototype.sortKeys=function(a){this.keys[this.keys.length-1].order=a||pv.naturalOrder;return this};pv.Nest.prototype.sortValues=function(a){this.order=a||pv.naturalOrder;return this};pv.Nest.prototype.map=function(){var n={},g=[];for(var l,h=0;h<this.array.length;h++){var c=this.array[h];var b=n;for(l=0;l<this.keys.length-1;l++){var f=this.keys[l](c);if(!b[f]){b[f]={}}b=b[f]}f=this.keys[l](c);if(!b[f]){var d=[];g.push(d);b[f]=d}b[f].push(c)}if(this.order){for(var l=0;l<g.length;l++){g[l].sort(this.order)}}return n};pv.Nest.prototype.entries=function(){function a(f){var g=[];for(var d in f){var c=f[d];g.push({key:d,values:(c instanceof Array)?c:a(c)})}return g}function b(g,d){var f=this.keys[d].order;if(f){g.sort(function(i,h){return f(i.key,h.key)})}if(++d<this.keys.length){for(var c=0;c<g.length;c++){b.call(this,g[c].values,d)}}return g}return b.call(this,a(this.map()),0)};pv.Nest.prototype.rollup=function(b){function a(f){for(var c in f){var d=f[c];if(d instanceof Array){f[c]=b(d)}else{a(d)}}return f}return a(this.map())};pv.flatten=function(a){return new pv.Flatten(a)};pv.Flatten=function(a){this.map=a;this.keys=[]};pv.Flatten.prototype.key=function(a,b){this.keys.push({name:a,value:b});delete this.$leaf;return this};pv.Flatten.prototype.leaf=function(a){this.keys.length=0;this.$leaf=a;return this};pv.Flatten.prototype.array=function(){var b=[],a=[],g=this.keys,c=this.$leaf;if(c){function f(k,j){if(c(k)){b.push({keys:a.slice(),value:k})}else{for(var h in k){a.push(h);f(k[h],j+1);a.pop()}}}f(this.map,0);return b}function d(k,j){if(j<g.length-1){for(var h in k){a.push(h);d(k[h],j+1);a.pop()}}else{b.push(a.concat(k))}}d(this.map,0);return b.map(function(j){var h={};for(var o=0;o<g.length;o++){var n=g[o],l=j[o];h[n.name]=n.value?n.value.call(null,l):l}return h})};pv.vector=function(a,b){return new pv.Vector(a,b)};pv.Vector=function(a,b){this.x=a;this.y=b};pv.Vector.prototype.perp=function(){return new pv.Vector(-this.y,this.x)};pv.Vector.prototype.norm=function(){var a=this.length();return this.times(a?(1/a):1)};pv.Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};pv.Vector.prototype.times=function(a){return new pv.Vector(this.x*a,this.y*a)};pv.Vector.prototype.plus=function(a,b){return(arguments.length==1)?new pv.Vector(this.x+a.x,this.y+a.y):new pv.Vector(this.x+a,this.y+b)};pv.Vector.prototype.minus=function(a,b){return(arguments.length==1)?new pv.Vector(this.x-a.x,this.y-a.y):new pv.Vector(this.x-a,this.y-b)};pv.Vector.prototype.dot=function(a,b){return(arguments.length==1)?this.x*a.x+this.y*a.y:this.x*a+this.y*b};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform();pv.Transform.prototype.translate=function(a,c){var b=new pv.Transform();b.k=this.k;b.x=this.k*a+this.x;b.y=this.k*c+this.y;return b};pv.Transform.prototype.scale=function(b){var a=new pv.Transform();a.k=this.k*b;a.x=this.x;a.y=this.y;return a};pv.Transform.prototype.invert=function(){var b=new pv.Transform(),a=1/this.k;b.k=a;b.x=-this.x*a;
b.y=-this.y*a;return b};pv.Transform.prototype.times=function(a){var b=new pv.Transform();b.k=this.k*a.k;b.x=this.k*a.x+this.x;b.y=this.k*a.y+this.y;return b};pv.Scale=function(){};pv.Scale.interpolator=function(b,a){if(typeof b=="number"){return function(c){return c*(a-b)+b}}b=pv.color(b).rgb();a=pv.color(a).rgb();return function(d){var c=b.a*(1-d)+a.a*d;if(c<0.00001){c=0}return(b.a==0)?pv.rgb(a.r,a.g,a.b,c):((a.a==0)?pv.rgb(b.r,b.g,b.b,c):pv.rgb(Math.round(b.r*(1-d)+a.r*d),Math.round(b.g*(1-d)+a.g*d),Math.round(b.b*(1-d)+a.b*d),c))}};pv.Scale.quantitative=function(){var p=[0,1],j=[0,1],a=[0,1],k=[pv.identity],q=Number,b=false,o=pv.identity,m=pv.identity,h=String;function s(d){return new Date(d)}function c(d){var f=pv.search(p,d);if(f<0){f=-f-2}f=Math.max(0,Math.min(k.length-1,f));return k[f]((o(d)-j[f])/(j[f+1]-j[f]))}c.transform=function(f,d){o=function(g){return b?-f(-g):f(g)};m=function(g){return b?-d(-g):d(g)};j=p.map(o);return this};c.domain=function(i,f,d){if(arguments.length){var g;if(i instanceof Array){if(arguments.length<2){f=pv.identity}if(arguments.length<3){d=f}g=i.length&&f(i[0]);p=i.length?[pv.min(i,f),pv.max(i,d)]:[]}else{g=i;p=Array.prototype.slice.call(arguments).map(Number)}if(!p.length){p=[-Infinity,Infinity]}else{if(p.length==1){p=[p[0],p[0]]}}b=(p[0]||p[p.length-1])<0;j=p.map(o);q=(g instanceof Date)?s:Number;return this}return p.map(q)};c.range=function(){if(arguments.length){a=Array.prototype.slice.call(arguments);if(!a.length){a=[-Infinity,Infinity]}else{if(a.length==1){a=[a[0],a[0]]}}k=[];for(var d=0;d<a.length-1;d++){k.push(pv.Scale.interpolator(a[d],a[d+1]))}return this}return a};c.invert=function(f){var d=pv.search(a,f);if(d<0){d=-d-2}d=Math.max(0,Math.min(k.length-1,d));return q(m(j[d]+(f-a[d])/(a[d+1]-a[d])*(j[d+1]-j[d])))};c.ticks=function(r){var f=p[0],u=p[p.length-1],y=u<f,v=y?u:f,z=y?f:u,D=z-v;if(!D||!isFinite(D)){if(q==s){h=pv.Format.date("%x")}return[q(v)]}if(q==s){function x(E,n){switch(n){case 31536000000:E.setMonth(0);case 2592000000:E.setDate(1);case 604800000:if(n==604800000){E.setDate(E.getDate()-E.getDay())}case 86400000:E.setHours(0);case 3600000:E.setMinutes(0);case 60000:E.setSeconds(0);case 1000:E.setMilliseconds(0)}}var w,C,B,i=1;if(D>=3*31536000000){w=31536000000;C="%Y";B=function(n){n.setFullYear(n.getFullYear()+i)}}else{if(D>=3*2592000000){w=2592000000;C="%m/%Y";B=function(n){n.setMonth(n.getMonth()+i)}}else{if(D>=3*604800000){w=604800000;C="%m/%d";B=function(n){n.setDate(n.getDate()+7*i)}}else{if(D>=3*86400000){w=86400000;C="%m/%d";B=function(n){n.setDate(n.getDate()+i)}}else{if(D>=3*3600000){w=3600000;C="%I:%M %p";B=function(n){n.setHours(n.getHours()+i)}}else{if(D>=3*60000){w=60000;C="%I:%M %p";B=function(n){n.setMinutes(n.getMinutes()+i)}}else{if(D>=3*1000){w=1000;C="%I:%M:%S";B=function(n){n.setSeconds(n.getSeconds()+i)}}else{w=1;C="%S.%Qs";B=function(n){n.setTime(n.getTime()+i)}}}}}}}}h=pv.Format.date(C);var l=new Date(v),d=[];x(l,w);var g=D/w;if(g>10){switch(w){case 3600000:i=(g>20)?6:3;l.setHours(Math.floor(l.getHours()/i)*i);break;case 2592000000:i=3;l.setMonth(Math.floor(l.getMonth()/i)*i);break;case 60000:i=(g>30)?15:((g>15)?10:5);l.setMinutes(Math.floor(l.getMinutes()/i)*i);break;case 1000:i=(g>90)?15:((g>60)?10:5);l.setSeconds(Math.floor(l.getSeconds()/i)*i);break;case 1:i=(g>1000)?250:((g>200)?100:((g>100)?50:((g>50)?25:5)));l.setMilliseconds(Math.floor(l.getMilliseconds()/i)*i);break;default:i=pv.logCeil(g/15,10);if(g/i<2){i/=5}else{if(g/i<5){i/=2}}l.setFullYear(Math.floor(l.getFullYear()/i)*i);break}}while(true){B(l);if(l>z){break}d.push(new Date(l))}return y?d.reverse():d}if(!arguments.length){r=10}var i=pv.logFloor(D/r,10),t=r/(D/i);if(t<=0.15){i*=10}else{if(t<=0.35){i*=5}else{if(t<=0.75){i*=2}}}var f=Math.ceil(v/i)*i,u=Math.floor(z/i)*i;h=pv.Format.number().fractionDigits(Math.max(0,-Math.floor(pv.log(i,10)+0.01)));var A=pv.range(f,u+i,i);return y?A.reverse():A};c.tickFormat=function(d){return h(d)};c.nice=function(){if(p.length!=2){return this}var r=p[0],f=p[p.length-1],g=f<r,i=g?f:r,d=g?r:f,l=d-i;
if(!l||!isFinite(l)){return this}var n=Math.pow(10,Math.round(Math.log(l)/Math.log(10))-1);p=[Math.floor(i/n)*n,Math.ceil(d/n)*n];if(g){p.reverse()}j=p.map(o);return this};c.by=function(d){function g(){return c(d.apply(this,arguments))}for(var i in c){g[i]=c[i]}return g};c.domain.apply(c,arguments);return c};pv.Scale.linear=function(){var a=pv.Scale.quantitative();a.domain.apply(a,arguments);return a};pv.Scale.log=function(){var g=pv.Scale.quantitative(1,10),a,f,c=function(b){return Math.log(b)/f},d=function(b){return Math.pow(a,b)};g.ticks=function(){var o=g.domain(),p=o[0]<0,l=Math.floor(p?-c(-o[0]):c(o[0])),h=Math.ceil(p?-c(-o[1]):c(o[1])),m=[];if(p){m.push(-d(-l));for(;l++<h;){for(var b=a-1;b>0;b--){m.push(-d(-l)*b)}}}else{for(;l<h;l++){for(var b=1;b<a;b++){m.push(d(l)*b)}}m.push(d(l))}for(l=0;m[l]<o[0];l++){}for(h=m.length;m[h-1]>o[1];h--){}return m.slice(l,h)};g.tickFormat=function(b){return b.toPrecision(1)};g.nice=function(){var b=g.domain();return g.domain(pv.logFloor(b[0],a),pv.logCeil(b[1],a))};g.base=function(b){if(arguments.length){a=Number(b);f=Math.log(a);g.transform(c,d);return this}return a};g.domain.apply(g,arguments);return g.base(10)};pv.Scale.root=function(){var a=pv.Scale.quantitative();a.power=function(d){if(arguments.length){var c=Number(d),f=1/c;a.transform(function(b){return Math.pow(b,f)},function(b){return Math.pow(b,c)});return this}return c};a.domain.apply(a,arguments);return a.power(2)};pv.Scale.ordinal=function(){var g=[],a={},b=[],f=0;function c(d){if(!(d in a)){a[d]=g.push(d)-1}return b[a[d]%b.length]}c.domain=function(l,i){if(arguments.length){l=(l instanceof Array)?((arguments.length>1)?pv.map(l,i):l):Array.prototype.slice.call(arguments);g=[];var d={};for(var h=0;h<l.length;h++){var k=l[h];if(!(k in d)){d[k]=true;g.push(k)}}a=pv.numerate(g);return this}return g};c.range=function(h,d){if(arguments.length){b=(h instanceof Array)?((arguments.length>1)?pv.map(h,d):h):Array.prototype.slice.call(arguments);if(typeof b[0]=="string"){b=b.map(pv.color)}return this}return b};c.split=function(h,d){var i=(d-h)/this.domain().length;b=pv.range(h+i/2,d,i);return this};c.splitFlush=function(h,d){var j=this.domain().length,i=(d-h)/(j-1);b=(j==1)?[(h+d)/2]:pv.range(h,d+i/2,i);return this};c.splitBanded=function(h,d,m){if(arguments.length<3){m=1}if(m<0){var o=this.domain().length,k=-m*o,i=d-h-k,l=i/(o+1);b=pv.range(h+l,d,l-m);b.band=-m}else{var j=(d-h)/(this.domain().length+(1-m));b=pv.range(h+j*(1-m),d,j);b.band=j*m}return this};c.by=function(d){function h(){return c(d.apply(this,arguments))}for(var i in c){h[i]=c[i]}return h};c.domain.apply(c,arguments);return c};pv.Scale.quantile=function(){var h=-1,a=-1,b=[],f=[],g=pv.Scale.linear();function c(d){return g(Math.max(0,Math.min(a,pv.search.index(b,d)-1))/a)}c.quantiles=function(d){if(arguments.length){h=Number(d);if(h<0){b=[f[0]].concat(f);a=f.length-1}else{b=[];b[0]=f[0];for(var j=1;j<=h;j++){b[j]=f[~~(j*(f.length-1)/h)]}a=h-1}return this}return b};c.domain=function(i,d){if(arguments.length){f=(i instanceof Array)?pv.map(i,d):Array.prototype.slice.call(arguments);f.sort(pv.naturalOrder);c.quantiles(h);return this}return f};c.range=function(){if(arguments.length){g.range.apply(g,arguments);return this}return g.range()};c.by=function(d){function i(){return c(d.apply(this,arguments))}for(var j in c){i[j]=c[j]}return i};c.domain.apply(c,arguments);return c};pv.histogram=function(b,a){var c=true;return{bins:function(l){var d=pv.map(b,a),k=[];if(!arguments.length){l=pv.Scale.linear(d).ticks()}for(var h=0;h<l.length-1;h++){var g=k[h]=[];g.x=l[h];g.dx=l[h+1]-l[h];g.y=0}for(var h=0;h<d.length;h++){var f=pv.search.index(l,d[h])-1,g=k[Math.max(0,Math.min(k.length-1,f))];g.y++;g.push(b[h])}if(!c){for(var h=0;h<k.length;h++){k[h].y/=d.length}}return k},frequency:function(d){if(arguments.length){c=Boolean(d);return this}return c}}};pv.color=function(o){if(o.rgb){return o.rgb()}var q=/([a-z]+)\((.*)\)/i.exec(o);if(q){var p=q[2].split(","),n=1;switch(q[1]){case"hsla":case"rgba":n=parseFloat(p[3]);
if(!n){return pv.Color.transparent}break}switch(q[1]){case"hsla":case"hsl":var j=parseFloat(p[0]),t=parseFloat(p[1])/100,d=parseFloat(p[2])/100;return(new pv.Color.Hsl(j,t,d,n)).rgb();case"rgba":case"rgb":function i(b){var a=parseFloat(b);return(b[b.length-1]=="%")?Math.round(a*2.55):a}var c=i(p[0]),k=i(p[1]),m=i(p[2]);return pv.rgb(c,k,m,n)}}var f=pv.Color.names[o];if(f){return f}if(o.charAt(0)=="#"){var c,k,m;if(o.length==4){c=o.charAt(1);c+=c;k=o.charAt(2);k+=k;m=o.charAt(3);m+=m}else{if(o.length==7){c=o.substring(1,3);k=o.substring(3,5);m=o.substring(5,7)}}return pv.rgb(parseInt(c,16),parseInt(k,16),parseInt(m,16),1)}return new pv.Color(o,1)};pv.Color=function(a,b){this.color=a;this.opacity=b};pv.Color.prototype.brighter=function(a){return this.rgb().brighter(a)};pv.Color.prototype.darker=function(a){return this.rgb().darker(a)};pv.rgb=function(h,f,c,d){return new pv.Color.Rgb(h,f,c,(arguments.length==4)?d:1)};pv.Color.Rgb=function(h,f,c,d){pv.Color.call(this,d?("rgb("+h+","+f+","+c+")"):"none",d);this.r=h;this.g=f;this.b=c;this.a=d};pv.Color.Rgb.prototype=pv.extend(pv.Color);pv.Color.Rgb.prototype.red=function(a){return pv.rgb(a,this.g,this.b,this.a)};pv.Color.Rgb.prototype.green=function(a){return pv.rgb(this.r,a,this.b,this.a)};pv.Color.Rgb.prototype.blue=function(a){return pv.rgb(this.r,this.g,a,this.a)};pv.Color.Rgb.prototype.alpha=function(b){return pv.rgb(this.r,this.g,this.b,b)};pv.Color.Rgb.prototype.rgb=function(){return this};pv.Color.Rgb.prototype.brighter=function(c){c=Math.pow(0.7,arguments.length?c:1);var h=this.r,f=this.g,a=this.b,d=30;if(!h&&!f&&!a){return pv.rgb(d,d,d,this.a)}if(h&&(h<d)){h=d}if(f&&(f<d)){f=d}if(a&&(a<d)){a=d}return pv.rgb(Math.min(255,Math.floor(h/c)),Math.min(255,Math.floor(f/c)),Math.min(255,Math.floor(a/c)),this.a)};pv.Color.Rgb.prototype.darker=function(a){a=Math.pow(0.7,arguments.length?a:1);return pv.rgb(Math.max(0,Math.floor(a*this.r)),Math.max(0,Math.floor(a*this.g)),Math.max(0,Math.floor(a*this.b)),this.a)};pv.hsl=function(f,d,c,b){return new pv.Color.Hsl(f,d,c,(arguments.length==4)?b:1)};pv.Color.Hsl=function(f,d,c,b){pv.Color.call(this,"hsl("+f+","+(d*100)+"%,"+(c*100)+"%)",b);this.h=f;this.s=d;this.l=c;this.a=b};pv.Color.Hsl.prototype=pv.extend(pv.Color);pv.Color.Hsl.prototype.hue=function(a){return pv.hsl(a,this.s,this.l,this.a)};pv.Color.Hsl.prototype.saturation=function(a){return pv.hsl(this.h,a,this.l,this.a)};pv.Color.Hsl.prototype.lightness=function(a){return pv.hsl(this.h,this.s,a,this.a)};pv.Color.Hsl.prototype.alpha=function(b){return pv.hsl(this.h,this.s,this.l,b)};pv.Color.Hsl.prototype.rgb=function(){var g=this.h,f=this.s,a=this.l;g=g%360;if(g<0){g+=360}f=Math.max(0,Math.min(f,1));a=Math.max(0,Math.min(a,1));var c=(a<=0.5)?(a*(1+f)):(a+f-a*f);var d=2*a-c;function b(j){if(j>360){j-=360}else{if(j<0){j+=360}}if(j<60){return d+(c-d)*j/60}if(j<180){return c}if(j<240){return d+(c-d)*(240-j)/60}return d}function i(j){return Math.round(b(j)*255)}return pv.rgb(i(g+120),i(g),i(g-120),this.a)};pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};
(function(){var b=pv.Color.names;for(var a in b){b[a]=pv.color(b[a])}})();pv.colors=function(){var a=pv.Scale.ordinal();a.range.apply(a,arguments);return a};pv.Colors={};pv.Colors.category10=function(){var a=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");a.domain.apply(a,arguments);return a};pv.Colors.category20=function(){var a=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");a.domain.apply(a,arguments);return a};pv.Colors.category19=function(){var a=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");a.domain.apply(a,arguments);return a};pv.ramp=function(c,a){var b=pv.Scale.linear();b.range.apply(b,arguments);return b};pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter"},css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(a){if(a.length&&a[0].reverse&&(a.type!="line")&&(a.type!="area")){var d=pv.extend(a);for(var c=0,b=a.length-1;b>=0;c++,b--){d[c]=a[b]}a=d}this.removeSiblings(this[a.type](a))};pv.SvgScene.create=function(a){return document.createElementNS(this.svg,a)};pv.SvgScene.expect=function(g,d,a,c){if(g){if(g.tagName=="a"){g=g.firstChild}if(g.tagName!=d){var h=this.create(d);g.parentNode.replaceChild(h,g);g=h}}else{g=this.create(d)}for(var b in a){var f=a[b];if(f==this.implicit.svg[b]){f=null}if(f==null){g.removeAttribute(b)}else{g.setAttribute(b,f)}}for(var b in c){var f=c[b];if(f==this.implicit.css[b]){f=null}if(f==null){g.style.removeProperty(b)}else{g.style[b]=f}}return g};pv.SvgScene.append=function(c,a,b){c.$scene={scenes:a,index:b};c=this.title(c,a[b]);if(!c.parentNode){a.$g.appendChild(c)}return c.nextSibling};pv.SvgScene.title=function(d,c){var b=d.parentNode;if(b&&(b.tagName!="a")){b=null}if(c.title){if(!b){b=this.create("a");if(d.parentNode){d.parentNode.replaceChild(b,d)}b.appendChild(d)}b.setAttributeNS(this.xlink,"title",c.title);return b}if(b){b.parentNode.replaceChild(d,b)}return d};pv.SvgScene.dispatch=pv.listener(function(c){var a=c.target.$scene;if(a){var b=c.type;switch(b){case"DOMMouseScroll":b="mousewheel";c.wheel=-480*c.detail;break;case"mousewheel":c.wheel=(window.opera?12:1)*c.wheelDelta;break}if(pv.Mark.dispatch(b,a.scenes,a.index)){c.preventDefault()}}});pv.SvgScene.removeSiblings=function(a){while(a){var b=a.nextSibling;a.parentNode.removeChild(a);a=b}};pv.SvgScene.undefined=function(){};pv.SvgScene.pathBasis=(function(){var c=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]];function a(d,i,h,g,f){return{x:d[0]*i.left+d[1]*h.left+d[2]*g.left+d[3]*f.left,y:d[0]*i.top+d[1]*h.top+d[2]*g.top+d[3]*f.top}}var b=function(k,j,i,h){var g=a(c[1],k,j,i,h),f=a(c[2],k,j,i,h),d=a(c[3],k,j,i,h);return"C"+g.x+","+g.y+","+f.x+","+f.y+","+d.x+","+d.y};b.segment=function(l,k,j,i){var h=a(c[0],l,k,j,i),g=a(c[1],l,k,j,i),f=a(c[2],l,k,j,i),d=a(c[3],l,k,j,i);return"M"+h.x+","+h.y+"C"+g.x+","+g.y+","+f.x+","+f.y+","+d.x+","+d.y};return b})();pv.SvgScene.curveBasis=function(b){if(b.length<=2){return""}var f="",h=b[0],g=h,d=h,c=b[1];f+=this.pathBasis(h,g,d,c);for(var a=2;a<b.length;a++){h=g;g=d;d=c;c=b[a];f+=this.pathBasis(h,g,d,c)}f+=this.pathBasis(g,d,c,c);f+=this.pathBasis(d,c,c,c);return f};pv.SvgScene.curveBasisSegments=function(b){if(b.length<=2){return""}var g=[],j=b[0],f=j,d=j,c=b[1],h=this.pathBasis.segment(j,f,d,c);
j=f;f=d;d=c;c=b[2];g.push(h+this.pathBasis(j,f,d,c));for(var a=3;a<b.length;a++){j=f;f=d;d=c;c=b[a];g.push(this.pathBasis.segment(j,f,d,c))}g.push(this.pathBasis.segment(f,d,c,c)+this.pathBasis(d,c,c,c));return g};pv.SvgScene.curveHermite=function(h,g){if(g.length<1||(h.length!=g.length&&h.length!=g.length+2)){return""}var j=h.length!=g.length,m="",k=h[0],a=h[1],f=g[0],l=f,c=1;if(j){m+="Q"+(a.left-f.x*2/3)+","+(a.top-f.y*2/3)+","+a.left+","+a.top;k=h[1];c=2}if(g.length>1){l=g[1];a=h[c];c++;m+="C"+(k.left+f.x)+","+(k.top+f.y)+","+(a.left-l.x)+","+(a.top-l.y)+","+a.left+","+a.top;for(var b=2;b<g.length;b++,c++){a=h[c];l=g[b];m+="S"+(a.left-l.x)+","+(a.top-l.y)+","+a.left+","+a.top}}if(j){var d=h[c];m+="Q"+(a.left+l.x*2/3)+","+(a.top+l.y*2/3)+","+d.left+","+d.top}return m};pv.SvgScene.curveHermiteSegments=function(h,g){if(g.length<1||(h.length!=g.length&&h.length!=g.length+2)){return[]}var j=h.length!=g.length,m=[],k=h[0],a=k,f=g[0],l=f,c=1;if(j){a=h[1];m.push("M"+k.left+","+k.top+"Q"+(a.left-l.x*2/3)+","+(a.top-l.y*2/3)+","+a.left+","+a.top);c=2}for(var b=1;b<g.length;b++,c++){k=a;f=l;a=h[c];l=g[b];m.push("M"+k.left+","+k.top+"C"+(k.left+f.x)+","+(k.top+f.y)+","+(a.left-l.x)+","+(a.top-l.y)+","+a.left+","+a.top)}if(j){var d=h[c];m.push("M"+a.left+","+a.top+"Q"+(a.left+l.x*2/3)+","+(a.top+l.y*2/3)+","+d.left+","+d.top)}return m};pv.SvgScene.cardinalTangents=function(g,f){var c=[],b=(1-f)/2,k=g[0],j=g[1],h=g[2];for(var d=3;d<g.length;d++){c.push({x:b*(h.left-k.left),y:b*(h.top-k.top)});k=j;j=h;h=g[d]}c.push({x:b*(h.left-k.left),y:b*(h.top-k.top)});return c};pv.SvgScene.curveCardinal=function(b,a){if(b.length<=2){return""}return this.curveHermite(b,this.cardinalTangents(b,a))};pv.SvgScene.curveCardinalSegments=function(b,a){if(b.length<=2){return""}return this.curveHermiteSegments(b,this.cardinalTangents(b,a))};pv.SvgScene.monotoneTangents=function(n){var l=[],j=[],a=[],q=[],c=0;for(c=0;c<n.length-1;c++){j[c]=(n[c+1].top-n[c].top)/(n[c+1].left-n[c].left)}a[0]=j[0];q[0]=n[1].left-n[0].left;for(c=1;c<n.length-1;c++){a[c]=(j[c-1]+j[c])/2;q[c]=(n[c+1].left-n[c-1].left)/2}a[c]=j[c-1];q[c]=(n[c].left-n[c-1].left);for(c=0;c<n.length-1;c++){if(j[c]==0){a[c]=0;a[c+1]=0}}for(c=0;c<n.length-1;c++){if((Math.abs(a[c])<0.00001)||(Math.abs(a[c+1])<0.00001)){continue}var h=a[c]/j[c],b=a[c+1]/j[c],p=h*h+b*b;if(p>9){var o=3/Math.sqrt(p);a[c]=o*h*j[c];a[c+1]=o*b*j[c]}}var g;for(var f=0;f<n.length;f++){g=1+a[f]*a[f];l.push({x:q[f]/3/g,y:a[f]*q[f]/3/g})}return l};pv.SvgScene.curveMonotone=function(a){if(a.length<=2){return""}return this.curveHermite(a,this.monotoneTangents(a))};pv.SvgScene.curveMonotoneSegments=function(a){if(a.length<=2){return""}return this.curveHermiteSegments(a,this.monotoneTangents(a))};pv.SvgScene.area=function(a){var h=a.$g.firstChild;if(!a.length){return h}var p=a[0];if(p.segmented){return this.areaSegment(a)}if(!p.visible){return h}var m=p.fillStyle,n=p.strokeStyle;if(!m.opacity&&!n.opacity){return h}function o(v,s){var z=[],y=[];for(var r=s;v<=r;v++,s--){var w=a[v],t=a[s],x=w.left+","+w.top,u=(t.left+t.width)+","+(t.top+t.height);if(v<r){var q=a[v+1],d=a[s-1];switch(p.interpolate){case"step-before":x+="V"+q.top;u+="H"+(d.left+d.width);break;case"step-after":x+="H"+q.left;u+="V"+(d.top+d.height);break}}z.push(x);y.push(u)}return z.concat(y).join("L")}function l(u,t){var d=[],w=[],v,s;for(var r=t;u<=r;u++,t--){var q=a[t];d.push(a[u]);w.push({left:q.left+q.width,top:q.top+q.height})}if(p.interpolate=="basis"){v=pv.SvgScene.curveBasis(d);s=pv.SvgScene.curveBasis(w)}else{if(p.interpolate=="cardinal"){v=pv.SvgScene.curveCardinal(d,p.tension);s=pv.SvgScene.curveCardinal(w,p.tension)}else{v=pv.SvgScene.curveMonotone(d);s=pv.SvgScene.curveMonotone(w)}}return d[0].left+","+d[0].top+v+"L"+w[0].left+","+w[0].top+s}var k=[],g,c;for(var f=0;f<a.length;f++){g=a[f];if(!g.width&&!g.height){continue}for(var b=f+1;b<a.length;b++){c=a[b];if(!c.width&&!c.height){break}}if(f&&(p.interpolate!="step-after")){f--}if((b<a.length)&&(p.interpolate!="step-before")){b++
}k.push(((b-f>2&&(p.interpolate=="basis"||p.interpolate=="cardinal"||p.interpolate=="monotone"))?l:o)(f,b-1));f=b-1}if(!k.length){return h}h=this.expect(h,"path",{"shape-rendering":p.antialias?null:"crispEdges","pointer-events":p.events,cursor:p.cursor,d:"M"+k.join("ZM")+"Z",fill:m.color,"fill-opacity":m.opacity||null,stroke:n.color,"stroke-opacity":n.opacity||null,"stroke-width":n.opacity?p.lineWidth/this.scale:null});return this.append(h,a,0)};pv.SvgScene.areaSegment=function(a){var t=a.$g.firstChild,l=a[0],q,g;if(l.interpolate=="basis"||l.interpolate=="cardinal"||l.interpolate=="monotone"){var f=[],k=[];for(var r=0,m=a.length;r<m;r++){var v=a[m-r-1];f.push(a[r]);k.push({left:v.left+v.width,top:v.top+v.height})}if(l.interpolate=="basis"){q=this.curveBasisSegments(f);g=this.curveBasisSegments(k)}else{if(l.interpolate=="cardinal"){q=this.curveCardinalSegments(f,l.tension);g=this.curveCardinalSegments(k,l.tension)}else{q=this.curveMonotoneSegments(f);g=this.curveMonotoneSegments(k)}}}for(var r=0,m=a.length-1;r<m;r++){var c=a[r],b=a[r+1];if(!c.visible||!b.visible){continue}var p=c.fillStyle,j=c.strokeStyle;if(!p.opacity&&!j.opacity){continue}var u;if(q){var h=q[r],o="L"+g[m-r-1].substr(1);u=h+o+"Z"}else{var w=c,v=b;switch(c.interpolate){case"step-before":w=b;break;case"step-after":v=c;break}u="M"+c.left+","+w.top+"L"+b.left+","+v.top+"L"+(b.left+b.width)+","+(v.top+v.height)+"L"+(c.left+c.width)+","+(w.top+w.height)+"Z"}t=this.expect(t,"path",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,d:u,fill:p.color,"fill-opacity":p.opacity||null,stroke:j.color,"stroke-opacity":j.opacity||null,"stroke-width":j.opacity?c.lineWidth/this.scale:null});t=this.append(t,a,r)}return t};pv.SvgScene.bar=function(a){var g=a.$g.firstChild;for(var b=0;b<a.length;b++){var c=a[b];if(!c.visible){continue}var f=c.fillStyle,d=c.strokeStyle;if(!f.opacity&&!d.opacity){continue}g=this.expect(g,"rect",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,x:c.left,y:c.top,width:Math.max(1e-10,c.width),height:Math.max(1e-10,c.height),fill:f.color,"fill-opacity":f.opacity||null,stroke:d.color,"stroke-opacity":d.opacity||null,"stroke-width":d.opacity?c.lineWidth/this.scale:null});g=this.append(g,a,b)}return g};pv.SvgScene.dot=function(a){var g=a.$g.firstChild;for(var b=0;b<a.length;b++){var n=a[b];if(!n.visible){continue}var k=n.fillStyle,l=n.strokeStyle;if(!k.opacity&&!l.opacity){continue}var f=n.radius,m=null;switch(n.shape){case"cross":m="M"+-f+","+-f+"L"+f+","+f+"M"+f+","+-f+"L"+-f+","+f;break;case"triangle":var d=f,j=f*1.1547;m="M0,"+d+"L"+j+","+-d+" "+-j+","+-d+"Z";break;case"diamond":f*=Math.SQRT2;m="M0,"+-f+"L"+f+",0 0,"+f+" "+-f+",0Z";break;case"square":m="M"+-f+","+-f+"L"+f+","+-f+" "+f+","+f+" "+-f+","+f+"Z";break;case"tick":m="M0,0L0,"+-n.size;break;case"bar":m="M0,"+(n.size/2)+"L0,"+-(n.size/2);break}var c={"shape-rendering":n.antialias?null:"crispEdges","pointer-events":n.events,cursor:n.cursor,fill:k.color,"fill-opacity":k.opacity||null,stroke:l.color,"stroke-opacity":l.opacity||null,"stroke-width":l.opacity?n.lineWidth/this.scale:null};if(m){c.transform="translate("+n.left+","+n.top+")";if(n.angle){c.transform+=" rotate("+180*n.angle/Math.PI+")"}c.d=m;g=this.expect(g,"path",c)}else{c.cx=n.left;c.cy=n.top;c.r=f;g=this.expect(g,"circle",c)}g=this.append(g,a,b)}return g};pv.SvgScene.image=function(a){var f=a.$g.firstChild;for(var b=0;b<a.length;b++){var d=a[b];if(!d.visible){continue}f=this.fill(f,a,b);if(d.image){f=this.expect(f,"foreignObject",{cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height});var g=f.firstChild||f.appendChild(document.createElementNS(this.xhtml,"canvas"));g.$scene={scenes:a,index:b};g.style.width=d.width;g.style.height=d.height;g.width=d.imageWidth;g.height=d.imageHeight;g.getContext("2d").putImageData(d.image,0,0)}else{f=this.expect(f,"image",{preserveAspectRatio:"none",cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height});f.setAttributeNS(this.xlink,"href",d.url)
}f=this.append(f,a,b);f=this.stroke(f,a,b)}return f};pv.SvgScene.label=function(a){var d=a.$g.firstChild;for(var c=0;c<a.length;c++){var k=a[c];if(!k.visible){continue}var h=k.textStyle;if(!h.opacity||!k.text){continue}var g=0,f=0,j=0,b="start";switch(k.textBaseline){case"middle":j=".35em";break;case"top":j=".71em";f=k.textMargin;break;case"bottom":f="-"+k.textMargin;break}switch(k.textAlign){case"right":b="end";g="-"+k.textMargin;break;case"center":b="middle";break;case"left":g=k.textMargin;break}d=this.expect(d,"text",{"pointer-events":k.events,cursor:k.cursor,x:g,y:f,dy:j,transform:"translate("+k.left+","+k.top+")"+(k.textAngle?" rotate("+180*k.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:h.color,"fill-opacity":h.opacity||null,"text-anchor":b},{font:k.font,"text-shadow":k.textShadow,"text-decoration":k.textDecoration});if(d.firstChild){d.firstChild.nodeValue=k.text}else{d.appendChild(document.createTextNode(k.text))}d=this.append(d,a,c)}return d};pv.SvgScene.line=function(a){var h=a.$g.firstChild;if(a.length<2){return h}var c=a[0];if(c.segmented){return this.lineSegment(a)}if(!c.visible){return h}var g=c.fillStyle,f=c.strokeStyle;if(!g.opacity&&!f.opacity){return h}var j="M"+c.left+","+c.top;if(a.length>2&&(c.interpolate=="basis"||c.interpolate=="cardinal"||c.interpolate=="monotone")){switch(c.interpolate){case"basis":j+=this.curveBasis(a);break;case"cardinal":j+=this.curveCardinal(a,c.tension);break;case"monotone":j+=this.curveMonotone(a);break}}else{for(var b=1;b<a.length;b++){j+=this.pathSegment(a[b-1],a[b])}}h=this.expect(h,"path",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,d:j,fill:g.color,"fill-opacity":g.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-width":f.opacity?c.lineWidth/this.scale:null,"stroke-linejoin":c.lineJoin});return this.append(h,a,0)};pv.SvgScene.lineSegment=function(a){var f=a.$g.firstChild;var o=a[0];var m;switch(o.interpolate){case"basis":m=this.curveBasisSegments(a);break;case"cardinal":m=this.curveCardinalSegments(a,o.tension);break;case"monotone":m=this.curveMonotoneSegments(a);break}for(var c=0,b=a.length-1;c<b;c++){var j=a[c],h=a[c+1];if(!j.visible||!h.visible){continue}var l=j.strokeStyle,k=pv.Color.transparent;if(!l.opacity){continue}var g;if((j.interpolate=="linear")&&(j.lineJoin=="miter")){k=l;l=pv.Color.transparent;g=this.pathJoin(a[c-1],j,h,a[c+2])}else{if(m){g=m[c]}else{g="M"+j.left+","+j.top+this.pathSegment(j,h)}}f=this.expect(f,"path",{"shape-rendering":j.antialias?null:"crispEdges","pointer-events":j.events,cursor:j.cursor,d:g,fill:k.color,"fill-opacity":k.opacity||null,stroke:l.color,"stroke-opacity":l.opacity||null,"stroke-width":l.opacity?j.lineWidth/this.scale:null,"stroke-linejoin":j.lineJoin});f=this.append(f,a,c)}return f};pv.SvgScene.pathSegment=function(f,d){var b=1;switch(f.interpolate){case"polar-reverse":b=0;case"polar":var c=d.left-f.left,a=d.top-f.top,h=1-f.eccentricity,g=Math.sqrt(c*c+a*a)/(2*h);if((h<=0)||(h>1)){break}return"A"+g+","+g+" 0 0,"+b+" "+d.left+","+d.top;case"step-before":return"V"+d.top+"H"+d.left;case"step-after":return"H"+d.left+"V"+d.top}return"L"+d.left+","+d.top};pv.SvgScene.lineIntersect=function(d,c,b,a){return d.plus(c.times(b.minus(d).dot(a.perp())/c.dot(a.perp())))};pv.SvgScene.pathJoin=function(u,r,o,l){var t=pv.vector(r.left,r.top),q=pv.vector(o.left,o.top),f=q.minus(t),s=f.perp().norm(),n=s.times(r.lineWidth/(2*this.scale)),k=t.plus(n),i=q.plus(n),h=q.minus(n),g=t.minus(n);if(u&&u.visible){var m=t.minus(u.left,u.top).perp().norm().plus(s);g=this.lineIntersect(t,m,g,f);k=this.lineIntersect(t,m,k,f)}if(l&&l.visible){var j=pv.vector(l.left,l.top).minus(q).perp().norm().plus(s);h=this.lineIntersect(q,j,h,f);i=this.lineIntersect(q,j,i,f)}return"M"+k.x+","+k.y+"L"+i.x+","+i.y+" "+h.x+","+h.y+" "+g.x+","+g.y};pv.SvgScene.panel=function(b){var m=b.$g,n=m&&m.firstChild;for(var l=0;l<b.length;l++){var v=b[l];if(!v.visible){continue}if(!b.parent){v.canvas.style.display="inline-block";
if(m&&(m.parentNode!=v.canvas)){m=v.canvas.firstChild;n=m&&m.firstChild}if(!m){m=v.canvas.appendChild(this.create("svg"));m.setAttribute("font-size","10px");m.setAttribute("font-family","sans-serif");m.setAttribute("fill","none");m.setAttribute("stroke","none");m.setAttribute("stroke-width",1.5);for(var h=0;h<this.events.length;h++){m.addEventListener(this.events[h],this.dispatch,false)}n=m.firstChild}b.$g=m;m.setAttribute("width",v.width+v.left+v.right);m.setAttribute("height",v.height+v.top+v.bottom)}if(v.overflow=="hidden"){var d=pv.id().toString(36),o=this.expect(n,"g",{"clip-path":"url(#"+d+")"});if(!o.parentNode){m.appendChild(o)}b.$g=m=o;n=o.firstChild;n=this.expect(n,"clipPath",{id:d});var a=n.firstChild||n.appendChild(this.create("rect"));a.setAttribute("x",v.left);a.setAttribute("y",v.top);a.setAttribute("width",v.width);a.setAttribute("height",v.height);if(!n.parentNode){m.appendChild(n)}n=n.nextSibling}n=this.fill(n,b,l);var f=this.scale,u=v.transform,q=v.left+u.x,p=v.top+u.y;this.scale*=u.k;for(var h=0;h<v.children.length;h++){v.children[h].$g=n=this.expect(n,"g",{transform:"translate("+q+","+p+")"+(u.k!=1?" scale("+u.k+")":"")});this.updateAll(v.children[h]);if(!n.parentNode){m.appendChild(n)}n=n.nextSibling}this.scale=f;n=this.stroke(n,b,l);if(v.overflow=="hidden"){b.$g=m=o.parentNode;n=o.nextSibling}}return n};pv.SvgScene.fill=function(f,a,b){var c=a[b],d=c.fillStyle;if(d.opacity||c.events=="all"){f=this.expect(f,"rect",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,x:c.left,y:c.top,width:c.width,height:c.height,fill:d.color,"fill-opacity":d.opacity,stroke:null});f=this.append(f,a,b)}return f};pv.SvgScene.stroke=function(f,a,b){var c=a[b],d=c.strokeStyle;if(d.opacity||c.events=="all"){f=this.expect(f,"rect",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events=="all"?"stroke":c.events,cursor:c.cursor,x:c.left,y:c.top,width:Math.max(1e-10,c.width),height:Math.max(1e-10,c.height),fill:null,stroke:d.color,"stroke-opacity":d.opacity,"stroke-width":c.lineWidth/this.scale});f=this.append(f,a,b)}return f};pv.SvgScene.rule=function(a){var f=a.$g.firstChild;for(var b=0;b<a.length;b++){var c=a[b];if(!c.visible){continue}var d=c.strokeStyle;if(!d.opacity){continue}f=this.expect(f,"line",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,x1:c.left,y1:c.top,x2:c.left+c.width,y2:c.top+c.height,stroke:d.color,"stroke-opacity":d.opacity,"stroke-width":c.lineWidth/this.scale});f=this.append(f,a,b)}return f};pv.SvgScene.wedge=function(b){var k=b.$g.firstChild;for(var j=0;j<b.length;j++){var u=b[j];if(!u.visible){continue}var r=u.fillStyle,t=u.strokeStyle;if(!r.opacity&&!t.opacity){continue}var f=u.innerRadius,d=u.outerRadius,n=Math.abs(u.angle),c;if(n>=2*Math.PI){if(f){c="M0,"+d+"A"+d+","+d+" 0 1,1 0,"+(-d)+"A"+d+","+d+" 0 1,1 0,"+d+"M0,"+f+"A"+f+","+f+" 0 1,1 0,"+(-f)+"A"+f+","+f+" 0 1,1 0,"+f+"Z"}else{c="M0,"+d+"A"+d+","+d+" 0 1,1 0,"+(-d)+"A"+d+","+d+" 0 1,1 0,"+d+"Z"}}else{var m=Math.min(u.startAngle,u.endAngle),l=Math.max(u.startAngle,u.endAngle),h=Math.cos(m),g=Math.cos(l),q=Math.sin(m),o=Math.sin(l);if(f){c="M"+d*h+","+d*q+"A"+d+","+d+" 0 "+((n<Math.PI)?"0":"1")+",1 "+d*g+","+d*o+"L"+f*g+","+f*o+"A"+f+","+f+" 0 "+((n<Math.PI)?"0":"1")+",0 "+f*h+","+f*q+"Z"}else{c="M"+d*h+","+d*q+"A"+d+","+d+" 0 "+((n<Math.PI)?"0":"1")+",1 "+d*g+","+d*o+"L0,0Z"}}k=this.expect(k,"path",{"shape-rendering":u.antialias?null:"crispEdges","pointer-events":u.events,cursor:u.cursor,transform:"translate("+u.left+","+u.top+")",d:c,fill:r.color,"fill-rule":"evenodd","fill-opacity":r.opacity||null,stroke:t.color,"stroke-opacity":t.opacity||null,"stroke-width":t.opacity?u.lineWidth/this.scale:null});k=this.append(k,b,j)}return k};pv.Mark=function(){this.$properties=[];this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(b,a){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties)
}this.properties[b]=true;pv.Mark.prototype.propertyMethod(b,false,pv.Mark.cast[b]=a);return this};pv.Mark.prototype.propertyMethod=function(b,c,a){if(!a){a=pv.Mark.cast[b]}this[b]=function(f){if(c&&this.scene){var d=this.scene.defs;if(arguments.length){d[b]={id:(f==null)?0:pv.id(),value:((f!=null)&&a)?a(f):f};return this}return d[b]?d[b].value:null}if(arguments.length){var g=!c<<1|(typeof f=="function");this.propertyValue(b,(g&1&&a)?function(){var h=f.apply(this,arguments);return(h!=null)?a(h):null}:(((f!=null)&&a)?a(f):f)).type=g;return this}return this.instance()[b]}};pv.Mark.prototype.propertyValue=function(b,a){var d=this.$properties,f={name:b,id:pv.id(),value:a};for(var c=0;c<d.length;c++){if(d[c].name==b){d.splice(c,1);break}}d.push(f);return f};pv.Mark.prototype.property("data").property("visible",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String);pv.Mark.prototype.childIndex=-1;pv.Mark.prototype.index=-1;pv.Mark.prototype.scale=1;pv.Mark.prototype.defaults=new pv.Mark().data(function(a){return[a]}).visible(true).antialias(true).events("painted");pv.Mark.prototype.extend=function(a){this.proto=a;return this};pv.Mark.prototype.add=function(a){return this.parent.add(a).extend(this)};pv.Mark.prototype.def=function(b,a){this.propertyMethod(b,true);return this[b](arguments.length>1?a:null)};pv.Mark.prototype.anchor=function(a){var d=this,c;if(!a){a="center"}function b(j){var k=d,f=[];while(!(c=k.scene)){j=j.parent;f.push({index:j.index,childIndex:k.childIndex});k=k.parent}while(f.length){var g=f.pop();c=c[g.index].children[g.childIndex]}if(d.hasOwnProperty("index")){var h=pv.extend(c[d.index]);h.right=h.top=h.left=h.bottom=0;return[h]}return c}return new pv.Anchor(this).name(a).def("$mark.anchor",function(){c=this.scene.target=b(this)}).data(function(){return c.map(function(f){return f.data})}).visible(function(){return c[this.index].visible}).left(function(){var g=c[this.index],f=g.width||0;switch(this.name()){case"bottom":case"top":case"center":return g.left+f/2;case"left":return null}return g.left+f}).top(function(){var g=c[this.index],f=g.height||0;switch(this.name()){case"left":case"right":case"center":return g.top+f/2;case"top":return null}return g.top+f}).right(function(){var f=c[this.index];return this.name()=="left"?f.right+(f.width||0):null}).bottom(function(){var f=c[this.index];return this.name()=="top"?f.bottom+(f.height||0):null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})};pv.Mark.prototype.anchorTarget=function(){return this.proto.anchorTarget()};pv.Mark.prototype.margin=function(a){return this.left(a).right(a).top(a).bottom(a)};pv.Mark.prototype.instance=function(c){var b=this.scene||this.parent.instance(-1).children[this.childIndex],a=!arguments.length||this.hasOwnProperty("index")?this.index:c;return b[a<0?b.length-1:a]};pv.Mark.prototype.first=function(){return this.scene[0]};pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1]};pv.Mark.prototype.sibling=function(){return(this.index==0)?null:this.scene[this.index-1]};pv.Mark.prototype.cousin=function(){var b=this.parent,a=b&&b.sibling();return(a&&a.children)?a.children[this.childIndex][this.index]:null};pv.Mark.prototype.render=function(){var d=this.parent,a=pv.Mark.stack;if(d&&!this.root.scene){this.root.render();return}var b=[];for(var g=this;g.parent;g=g.parent){b.unshift(g.childIndex)}function c(m,k,j){m.scale=j;if(k<b.length){a.unshift(null);if(m.hasOwnProperty("index")){f(m,k,j)}else{for(var h=0,l=m.scene.length;h<l;h++){m.index=h;f(m,k,j)}delete m.index}a.shift()}else{m.build();pv.Scene.scale=j;pv.Scene.updateAll(m.scene)}delete m.scale
}function f(o,l,k){var j=o.scene[o.index],h;if(j.visible){var n=b[l],m=o.children[n];for(h=0;h<n;h++){o.children[h].scene=j.children[h]}a[0]=j.data;if(m.scene){c(m,l+1,k*j.transform.k)}else{m.scene=j.children[n];c(m,l+1,k*j.transform.k);delete m.scene}for(h=0;h<n;h++){delete o.children[h].scene}}}this.bind();while(d&&!d.hasOwnProperty("index")){d=d.parent}this.context(d?d.scene:undefined,d?d.index:-1,function(){c(this.root,0,1)})};pv.Mark.stack=[];pv.Mark.prototype.bind=function(){var a={},j=[[],[],[],[]],h,c;function k(o){do{var m=o.$properties;for(var l=m.length-1;l>=0;l--){var n=m[l];if(!(n.name in a)){a[n.name]=n;switch(n.name){case"data":h=n;break;case"visible":c=n;break;default:j[n.type].push(n);break}}}}while(o=o.proto)}k(this);k(this.defaults);j[1].reverse();j[3].reverse();var d=this;do{for(var b in d.properties){if(!(b in a)){j[2].push(a[b]={name:b,type:2,value:null})}}}while(d=d.proto);var f=j[0].concat(j[1]);for(var g=0;g<f.length;g++){this.propertyMethod(f[g].name,true)}this.binds={properties:a,data:h,defs:f,required:[c],optional:pv.blend(j)}};pv.Mark.prototype.build=function(){var j=this.scene,b=pv.Mark.stack;if(!j){j=this.scene=[];j.mark=this;j.type=this.type;j.childIndex=this.childIndex;if(this.parent){j.parent=this.parent.scene;j.parentIndex=this.parent.index}}if(this.binds.defs.length){var a=j.defs;if(!a){j.defs=a={}}for(var c=0;c<this.binds.defs.length;c++){var h=this.binds.defs[c],k=a[h.name];if(!k||(h.id>k.id)){a[h.name]={id:0,value:(h.type&1)?h.value.apply(this,b):h.value}}}}var g=this.binds.data;g=g.type&1?g.value.apply(this,b):g.value;b.unshift(null);j.length=g.length;for(var c=0;c<g.length;c++){pv.Mark.prototype.index=this.index=c;var f=j[c];if(!f){j[c]=f={}}f.data=b[0]=g[c];this.buildInstance(f)}pv.Mark.prototype.index=-1;delete this.index;b.shift();return this};pv.Mark.prototype.buildProperties=function(d,c){for(var b=0,g=c.length;b<g;b++){var f=c[b],a=f.value;switch(f.type){case 0:case 1:a=this.scene.defs[f.name].value;break;case 3:a=a.apply(this,pv.Mark.stack);break}d[f.name]=a}};pv.Mark.prototype.buildInstance=function(a){this.buildProperties(a,this.binds.required);if(a.visible){this.buildProperties(a,this.binds.optional);this.buildImplied(a)}};pv.Mark.prototype.buildImplied=function(n){var f=n.left;var a=n.right;var m=n.top;var i=n.bottom;var d=this.properties;var j=d.width?n.width:0;var g=d.height?n.height:0;var c=this.parent?this.parent.width():(j+f+a);if(j==null){j=c-(a=a||0)-(f=f||0)}else{if(a==null){a=c-j-(f=f||0)}else{if(f==null){f=c-j-(a=a||0)}}}var k=this.parent?this.parent.height():(g+m+i);if(g==null){g=k-(m=m||0)-(i=i||0)}else{if(i==null){i=k-g-(m=m||0)}else{if(m==null){m=k-g-(i=i||0)}}}n.left=f;n.right=a;n.top=m;n.bottom=i;if(d.width){n.width=j}if(d.height){n.height=g}if(d.textStyle&&!n.textStyle){n.textStyle=pv.Color.transparent}if(d.fillStyle&&!n.fillStyle){n.fillStyle=pv.Color.transparent}if(d.strokeStyle&&!n.strokeStyle){n.strokeStyle=pv.Color.transparent}};pv.Mark.prototype.mouse=function(){var a=pv.event.pageX||0,g=pv.event.pageY||0,f=this.root.canvas();do{a-=f.offsetLeft;g-=f.offsetTop}while(f=f.offsetParent);var c=pv.Transform.identity,d=this.properties.transform?this:this.parent,b=[];do{b.push(d)}while(d=d.parent);while(d=b.pop()){c=c.translate(d.left(),d.top()).times(d.transform())}c=c.invert();return pv.vector(a*c.k+c.x,g*c.k+c.y)};pv.Mark.prototype.event=function(b,a){this.$handlers[b]=pv.functor(a);return this};pv.Mark.prototype.context=function(b,h,g){var c=pv.Mark.prototype,j=pv.Mark.stack,d=pv.Mark.scene,i=c.index;function k(q,l){pv.Mark.scene=q;c.index=l;if(!q){return}var p=q.mark,s=p,o=[];do{o.push(s);j.push(q[l].data);s.index=l;s.scene=q;l=q.parentIndex;q=q.parent}while(s=s.parent);for(var m=o.length-1,f=1;m>0;m--){s=o[m];s.scale=f;f*=s.scene[s.index].transform.k}if(p.children){for(var m=0,r=p.children.length;m<r;m++){s=p.children[m];s.scene=p.scene[p.index].children[m];s.scale=f}}}function a(o,f){if(!o){return}var m=o.mark,q;if(m.children){for(var l=0,p=m.children.length;
l<p;l++){q=m.children[l];delete q.scene;delete q.scale}}q=m;do{j.pop();if(q.parent){delete q.scene;delete q.scale}delete q.index}while(q=q.parent)}a(d,i);k(b,h);try{g.apply(this,j)}finally{a(b,h);k(d,i)}};pv.Mark.dispatch=function(d,g,c){var a=g.mark,f=g.parent,b=a.$handlers[d];if(!b){return f&&pv.Mark.dispatch(d,f,g.parentIndex)}a.context(g,c,function(){a=b.apply(a,pv.Mark.stack);if(a&&a.render){a.render()}});return true};pv.Anchor=function(a){pv.Mark.call(this);this.target=a;this.parent=a.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.anchorTarget=function(){return this.target};pv.Area=function(){pv.Mark.call(this)};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("tension",Number);pv.Area.prototype.type="area";pv.Area.prototype.defaults=new pv.Area().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(0.7);pv.Area.prototype.buildImplied=function(a){if(a.height==null){a.height=0}if(a.width==null){a.width=0}pv.Mark.prototype.buildImplied.call(this,a)};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1,tension:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var c=this.binds,f=c.required,a=c.optional;for(var b=0,g=a.length;b<g;b++){var d=a[b];d.fixed=d.name in pv.Area.fixed;if(d.name=="segmented"){f.push(d);a.splice(b,1);b--;g--}}this.binds.$required=f;this.binds.$optional=a};pv.Area.prototype.buildInstance=function(c){var b=this.binds;if(this.index){var d=b.fixed;if(!d){d=b.fixed=[];function g(f){return !f.fixed||(d.push(f),false)}b.required=b.required.filter(g);if(!this.scene[0].segmented){b.optional=b.optional.filter(g)}}for(var a=0,j=d.length;a<j;a++){var h=d[a].name;c[h]=this.scene[0][h]}}else{b.required=b.$required;b.optional=b.$optional;b.fixed=null}pv.Mark.prototype.buildInstance.call(this,c)};pv.Area.prototype.anchor=function(a){var b;return pv.Mark.prototype.anchor.call(this,a).def("$area.anchor",function(){b=this.scene.target}).interpolate(function(){return b[this.index].interpolate}).eccentricity(function(){return b[this.index].eccentricity}).tension(function(){return b[this.index].tension})};pv.Bar=function(){pv.Mark.call(this)};pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=new pv.Bar().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent));pv.Dot=function(){pv.Mark.call(this)};pv.Dot.prototype=pv.extend(pv.Mark).property("size",Number).property("radius",Number).property("shape",String).property("angle",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=new pv.Dot().extend(pv.Mark.prototype.defaults).size(20).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent));pv.Dot.prototype.anchor=function(a){var b;return pv.Mark.prototype.anchor.call(this,a).def("$wedge.anchor",function(){b=this.scene.target}).left(function(){var c=b[this.index];switch(this.name()){case"bottom":case"top":case"center":return c.left;case"left":return null}return c.left+c.radius}).right(function(){var c=b[this.index];return this.name()=="left"?c.right+c.radius:null}).top(function(){var c=b[this.index];switch(this.name()){case"left":case"right":case"center":return c.top;case"top":return null}return c.top+c.radius}).bottom(function(){var c=b[this.index];return this.name()=="top"?c.bottom+c.radius:null}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center"
}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top"}return"bottom"})};pv.Dot.prototype.buildImplied=function(a){if(a.radius==null){a.radius=Math.sqrt(a.size)}else{if(a.size==null){a.size=a.radius*a.radius}}pv.Mark.prototype.buildImplied.call(this,a)};pv.Label=function(){pv.Mark.call(this)};pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=new pv.Label().extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);pv.Line=function(){pv.Mark.call(this)};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("eccentricity",Number).property("tension",Number);pv.Line.prototype.type="line";pv.Line.prototype.defaults=new pv.Line().extend(pv.Mark.prototype.defaults).lineJoin("miter").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(0.7);pv.Line.prototype.bind=pv.Area.prototype.bind;pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance;pv.Line.prototype.anchor=function(a){return pv.Area.prototype.anchor.call(this,a).textAlign(function(b){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left"}}).textBaseline(function(b){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top"}})};pv.Rule=function(){pv.Mark.call(this)};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=new pv.Rule().extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(false);pv.Rule.prototype.anchor=pv.Line.prototype.anchor;pv.Rule.prototype.buildImplied=function(f){var c=f.left,g=f.right,d=f.top,a=f.bottom;if((f.width!=null)||((c==null)&&(g==null))||((g!=null)&&(c!=null))){f.height=0}else{f.width=0}pv.Mark.prototype.buildImplied.call(this,f)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(a){return(typeof a=="string")?document.getElementById(a):a});pv.Panel.prototype.type="panel";pv.Panel.prototype.defaults=new pv.Panel().extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");pv.Panel.prototype.anchor=function(b){var a=pv.Bar.prototype.anchor.call(this,b);a.parent=this;return a};pv.Panel.prototype.add=function(a){var b=new a();b.parent=this;b.root=this.root;b.childIndex=this.children.length;this.children.push(b);return b};pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var a=0;a<this.children.length;a++){this.children[a].bind()}};pv.Panel.prototype.buildInstance=function(b){pv.Bar.prototype.buildInstance.call(this,b);if(!b.visible){return}if(!b.children){b.children=[]}var c=this.scale*b.transform.k,f,d=this.children.length;pv.Mark.prototype.index=-1;for(var a=0;a<d;a++){f=this.children[a];f.scene=b.children[a];f.scale=c;f.build()}for(var a=0;a<d;a++){f=this.children[a];b.children[a]=f.scene;delete f.scene;delete f.scale}b.children.length=d};pv.Panel.prototype.buildImplied=function(f){if(!this.parent){var i=f.canvas;if(i){if(i.$panel!=this){i.$panel=this;while(i.lastChild){i.removeChild(i.lastChild)}}var a,d;if(f.width==null){a=parseFloat(pv.css(i,"width"));
f.width=a-f.left-f.right}if(f.height==null){d=parseFloat(pv.css(i,"height"));f.height=d-f.top-f.bottom}}else{var b=this.$canvas||(this.$canvas=[]);if(!(i=b[this.index])){i=b[this.index]=document.createElement("span");if(this.$dom){this.$dom.parentNode.insertBefore(i,this.$dom)}else{var g=document.body;while(g.lastChild&&g.lastChild.tagName){g=g.lastChild}if(g!=document.body){g=g.parentNode}g.appendChild(i)}}}f.canvas=i}if(!f.transform){f.transform=pv.Transform.identity}pv.Mark.prototype.buildImplied.call(this,f)};pv.Image=function(){pv.Bar.call(this)};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);pv.Image.prototype.type="image";pv.Image.prototype.defaults=new pv.Image().extend(pv.Bar.prototype.defaults).fillStyle(null);pv.Image.prototype.image=function(a){this.$image=function(){var b=a.apply(this,arguments);return b==null?pv.Color.transparent:typeof b=="string"?pv.color(b):b};return this};pv.Image.prototype.bind=function(){pv.Bar.prototype.bind.call(this);var a=this.binds,b=this;do{a.image=b.$image}while(!a.image&&(b=b.proto))};pv.Image.prototype.buildImplied=function(m){pv.Bar.prototype.buildImplied.call(this,m);if(!m.visible){return}if(m.imageWidth==null){m.imageWidth=m.width}if(m.imageHeight==null){m.imageHeight=m.height}if((m.url==null)&&this.binds.image){var c=this.$canvas||(this.$canvas=document.createElement("canvas")),b=c.getContext("2d"),l=m.imageWidth,g=m.imageHeight,j=pv.Mark.stack,f;c.width=l;c.height=g;f=(m.image=b.createImageData(l,g)).data;j.unshift(null,null);for(var i=0,a=0;i<g;i++){j[1]=i;for(var k=0;k<l;k++){j[0]=k;var d=this.binds.image.apply(this,j);f[a++]=d.r;f[a++]=d.g;f[a++]=d.b;f[a++]=255*d.a}}j.splice(0,2)}};pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Wedge.prototype.type="wedge";pv.Wedge.prototype.defaults=new pv.Wedge().extend(pv.Mark.prototype.defaults).startAngle(function(){var a=this.sibling();return a?a.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index));pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2};pv.Wedge.prototype.anchor=function(c){function b(g){return g.innerRadius||g.angle<2*Math.PI}function a(g){return(g.innerRadius+g.outerRadius)/2}function f(g){return(g.startAngle+g.endAngle)/2}var d;return pv.Mark.prototype.anchor.call(this,c).def("$wedge.anchor",function(){d=this.scene.target}).left(function(){var g=d[this.index];if(b(g)){switch(this.name()){case"outer":return g.left+g.outerRadius*Math.cos(f(g));case"inner":return g.left+g.innerRadius*Math.cos(f(g));case"start":return g.left+a(g)*Math.cos(g.startAngle);case"center":return g.left+a(g)*Math.cos(f(g));case"end":return g.left+a(g)*Math.cos(g.endAngle)}}return g.left}).top(function(){var g=d[this.index];if(b(g)){switch(this.name()){case"outer":return g.top+g.outerRadius*Math.sin(f(g));case"inner":return g.top+g.innerRadius*Math.sin(f(g));case"start":return g.top+a(g)*Math.sin(g.startAngle);case"center":return g.top+a(g)*Math.sin(f(g));case"end":return g.top+a(g)*Math.sin(g.endAngle)}}return g.top}).textAlign(function(){var g=d[this.index];if(b(g)){switch(this.name()){case"outer":return pv.Wedge.upright(f(g))?"right":"left";case"inner":return pv.Wedge.upright(f(g))?"left":"right"}}return"center"}).textBaseline(function(){var g=d[this.index];if(b(g)){switch(this.name()){case"start":return pv.Wedge.upright(g.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(g.endAngle)?"bottom":"top"}}return"middle"}).textAngle(function(){var h=d[this.index],g=0;if(b(h)){switch(this.name()){case"center":case"inner":case"outer":g=f(h);
break;case"start":g=h.startAngle;break;case"end":g=h.endAngle;break}}return pv.Wedge.upright(g)?g:(g+Math.PI)})};pv.Wedge.upright=function(a){a=a%(2*Math.PI);a=(a<0)?(2*Math.PI+a):a;return(a<Math.PI/2)||(a>=3*Math.PI/2)};pv.Wedge.prototype.buildImplied=function(a){if(a.angle==null){a.angle=a.endAngle-a.startAngle}else{if(a.endAngle==null){a.endAngle=a.startAngle+a.angle}}pv.Mark.prototype.buildImplied.call(this,a)};pv.simulation=function(a){return new pv.Simulation(a)};pv.Simulation=function(b){for(var a=0;a<b.length;a++){this.particle(b[a])}};pv.Simulation.prototype.particle=function(a){a.next=this.particles;if(isNaN(a.px)){a.px=a.x}if(isNaN(a.py)){a.py=a.y}if(isNaN(a.fx)){a.fx=0}if(isNaN(a.fy)){a.fy=0}this.particles=a;return this};pv.Simulation.prototype.force=function(a){a.next=this.forces;this.forces=a;return this};pv.Simulation.prototype.constraint=function(a){a.next=this.constraints;this.constraints=a;return this};pv.Simulation.prototype.stabilize=function(g){var f;if(!arguments.length){g=3}for(var a=0;a<g;a++){var b=new pv.Quadtree(this.particles);for(f=this.constraints;f;f=f.next){f.apply(this.particles,b)}}for(var d=this.particles;d;d=d.next){d.px=d.x;d.py=d.y}return this};pv.Simulation.prototype.step=function(){var h,g,i;for(h=this.particles;h;h=h.next){var b=h.px,a=h.py;h.px=h.x;h.py=h.y;h.x+=h.vx=((h.x-b)+h.fx);h.y+=h.vy=((h.y-a)+h.fy)}var d=new pv.Quadtree(this.particles);for(i=this.constraints;i;i=i.next){i.apply(this.particles,d)}for(h=this.particles;h;h=h.next){h.fx=h.fy=0}for(g=this.forces;g;g=g.next){g.apply(this.particles,d)}};pv.Quadtree=function(i){var b;var c=Number.POSITIVE_INFINITY,g=c,a=Number.NEGATIVE_INFINITY,f=a;for(b=i;b;b=b.next){if(b.x<c){c=b.x}if(b.y<g){g=b.y}if(b.x>a){a=b.x}if(b.y>f){f=b.y}}var k=a-c,j=f-g;if(k>j){f=g+k}else{a=c+j}this.xMin=c;this.yMin=g;this.xMax=a;this.yMax=f;function h(t,s,o,r,m,q){if(isNaN(s.x)||isNaN(s.y)){return}if(t.leaf){if(t.p){if((Math.abs(t.p.x-s.x)+Math.abs(t.p.y-s.y))<0.01){d(t,s,o,r,m,q)}else{var l=t.p;t.p=null;d(t,l,o,r,m,q);d(t,s,o,r,m,q)}}else{t.p=s}}else{d(t,s,o,r,m,q)}}function d(r,o,q,v,m,t){var u=(q+m)*0.5,s=(v+t)*0.5,w=o.x>=u,l=o.y>=s;r.leaf=false;switch((l<<1)+w){case 0:r=r.c1||(r.c1=new pv.Quadtree.Node());break;case 1:r=r.c2||(r.c2=new pv.Quadtree.Node());break;case 2:r=r.c3||(r.c3=new pv.Quadtree.Node());break;case 3:r=r.c4||(r.c4=new pv.Quadtree.Node());break}if(w){q=u}else{m=u}if(l){v=s}else{t=s}h(r,o,q,v,m,t)}this.root=new pv.Quadtree.Node();for(b=i;b;b=b.next){h(this.root,b,c,g,a,f)}};pv.Quadtree.Node=function(){this.leaf=true;this.c1=null;this.c2=null;this.c3=null;this.c4=null;this.p=null};pv.Force={};pv.Force.charge=function(d){var f=2,j=1/f,g=500,h=1/g,b=0.9,a={};if(!arguments.length){d=-40}a.constant=function(k){if(arguments.length){d=Number(k);return a}return d};a.domain=function(l,k){if(arguments.length){f=Number(l);j=1/f;g=Number(k);h=1/g;return a}return[f,g]};a.theta=function(k){if(arguments.length){b=Number(k);return a}return b};function i(o){var k=0,m=0;o.cn=0;function l(n){i(n);o.cn+=n.cn;k+=n.cn*n.cx;m+=n.cn*n.cy}if(!o.leaf){if(o.c1){l(o.c1)}if(o.c2){l(o.c2)}if(o.c3){l(o.c3)}if(o.c4){l(o.c4)}}if(o.p){o.cn+=d;k+=d*o.p.x;m+=d*o.p.y}o.cx=k/o.cn;o.cy=m/o.cn}function c(o,l,m,x,k,v){var z=o.cx-l.x,y=o.cy-l.y,s=1/Math.sqrt(z*z+y*y);if((o.leaf&&(o.p!=l))||((k-m)*s<b)){if(s<h){return}if(s>j){s=j}var t=o.cn*s*s*s,r=z*t,q=y*t;l.fx+=r;l.fy+=q}else{if(!o.leaf){var w=(m+k)*0.5,u=(x+v)*0.5;if(o.c1){c(o.c1,l,m,x,w,u)}if(o.c2){c(o.c2,l,w,x,k,u)}if(o.c3){c(o.c3,l,m,u,w,v)}if(o.c4){c(o.c4,l,w,u,k,v)}if(s<h){return}if(s>j){s=j}if(o.p&&(o.p!=l)){var t=d*s*s*s,r=z*t,q=y*t;l.fx+=r;l.fy+=q}}}}a.apply=function(k,l){i(l.root);for(var m=k;m;m=m.next){c(l.root,m,l.xMin,l.yMin,l.xMax,l.yMax)}};return a};pv.Force.drag=function(a){var b={};if(!arguments.length){a=0.1}b.constant=function(c){if(arguments.length){a=c;return b}return a};b.apply=function(c){if(a){for(var d=c;d;d=d.next){d.fx-=a*d.vx;d.fy-=a*d.vy}}};return b};pv.Force.spring=function(c){var h=0.1,a=20,b,f,g={};
if(!arguments.length){c=0.1}g.links=function(d){if(arguments.length){b=d;f=d.map(function(i){return 1/Math.sqrt(Math.max(i.sourceNode.linkDegree,i.targetNode.linkDegree))});return g}return b};g.constant=function(d){if(arguments.length){c=Number(d);return g}return c};g.damping=function(d){if(arguments.length){h=Number(d);return g}return h};g.length=function(d){if(arguments.length){a=Number(d);return g}return a};g.apply=function(s){for(var m=0;m<b.length;m++){var q=b[m].sourceNode,o=b[m].targetNode,u=q.x-o.x,t=q.y-o.y,n=Math.sqrt(u*u+t*t),r=n?(1/n):1,p=c*f[m],l=h*f[m],d=(p*(n-a)+l*(u*(q.vx-o.vx)+t*(q.vy-o.vy))*r)*r,k=-d*(n?u:(0.01*(0.5-Math.random()))),j=-d*(n?t:(0.01*(0.5-Math.random())));q.fx+=k;q.fy+=j;o.fx-=k;o.fy-=j}};return g};pv.Constraint={};pv.Constraint.collision=function(i){var d=1,f,h,b,g,a,c={};if(!arguments.length){f=10}c.repeat=function(k){if(arguments.length){d=Number(k);return c}return d};function j(s,q,r,B,o,z){if(!s.leaf){var A=(r+o)*0.5,y=(B+z)*0.5,x=y>b,m=y<a,t=A>h,C=A<g;if(x){if(s.c1&&t){j(s.c1,q,r,B,A,y)}if(s.c2&&C){j(s.c2,q,A,B,o,y)}}if(m){if(s.c3&&t){j(s.c3,q,r,y,A,z)}if(s.c4&&C){j(s.c4,q,A,y,o,z)}}}if(s.p&&(s.p!=q)){var E=q.x-s.p.x,D=q.y-s.p.y,u=Math.sqrt(E*E+D*D),w=f+i(s.p);if(u<w){var v=(u-w)/u*0.5;E*=v;D*=v;q.x-=E;q.y-=D;s.p.x+=E;s.p.y+=D}}}c.apply=function(n,o){var s,m,k=-Infinity;for(s=n;s;s=s.next){m=i(s);if(m>k){k=m}}for(var l=0;l<d;l++){for(s=n;s;s=s.next){m=(f=i(s))+k;h=s.x-m;g=s.x+m;b=s.y-m;a=s.y+m;j(o.root,s,o.xMin,o.yMin,o.xMax,o.yMax)}}};return c};pv.Constraint.position=function(c){var b=1,d={};if(!arguments.length){c=function(a){return a.fix}}d.alpha=function(a){if(arguments.length){b=Number(a);return d}return b};d.apply=function(f){for(var g=f;g;g=g.next){var a=c(g);if(a){g.x+=(a.x-g.x)*b;g.y+=(a.y-g.y)*b;g.fx=g.fy=g.vx=g.vy=0}}};return d};pv.Constraint.bound=function(){var b={},a,c;b.x=function(f,d){if(arguments.length){a={min:Math.min(f,d),max:Math.max(f,d)};return this}return a};b.y=function(f,d){if(arguments.length){c={min:Math.min(f,d),max:Math.max(f,d)};return this}return c};b.apply=function(d){if(a){for(var f=d;f;f=f.next){f.x=f.x<a.min?a.min:(f.x>a.max?a.max:f.x)}}if(c){for(var f=d;f;f=f.next){f.y=f.y<c.min?c.min:(f.y>c.max?c.max:f.y)}}};return b};pv.Layout=function(){pv.Panel.call(this)};pv.Layout.prototype=pv.extend(pv.Panel);pv.Layout.prototype.property=function(b,a){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties)}this.properties[b]=true;this.propertyMethod(b,false,pv.Mark.cast[b]=a);return this};pv.Layout.Network=function(){pv.Layout.call(this);var a=this;this.$id=pv.id();(this.node=new pv.Mark().data(function(){return a.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(b){return b.x}).top(function(b){return b.y})).parent=this;this.link=new pv.Mark().extend(this.node).data(function(b){return[b.sourceNode,b.targetNode]}).fillStyle(null).lineWidth(function(c,b){return b.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(b){return a.add(pv.Panel).data(function(){return a.links()}).add(b).extend(this)};(this.label=new pv.Mark().extend(this.node).textMargin(7).textBaseline("middle").text(function(b){return b.nodeName||b.nodeValue}).textAngle(function(c){var b=c.midAngle;return pv.Wedge.upright(b)?b:(b+Math.PI)}).textAlign(function(b){return pv.Wedge.upright(b.midAngle)?"left":"right"})).parent=this};pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(a){return a.map(function(c,b){if(typeof c!="object"){c={nodeValue:c}}c.index=b;c.linkDegree=0;return c})}).property("links",function(a){return a.map(function(b){if(isNaN(b.linkValue)){b.linkValue=isNaN(b.value)?1:b.value}return b})});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this};pv.Layout.Network.prototype.buildProperties=function(b,a){if((b.$id||0)<this.$id){pv.Layout.prototype.buildProperties.call(this,b,a)}};pv.Layout.Network.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);if(a.$id>=this.$id){return true
}a.$id=this.$id;a.links.forEach(function(c){var b=c.linkValue;(c.sourceNode||(c.sourceNode=a.nodes[c.source])).linkDegree+=b;(c.targetNode||(c.targetNode=a.nodes[c.target])).linkDegree+=b})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc")};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.buildImplied=function(a){if(!a.links){a.links=pv.Layout.Hierarchy.links.call(this)}pv.Layout.Network.prototype.buildImplied.call(this,a)};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(a){return a.parentNode}).map(function(a){return{sourceNode:a,targetNode:a.parentNode,linkValue:1}})};pv.Layout.Hierarchy.NodeLink={buildImplied:function(r){var a=r.nodes,f=r.orient,b=/^(top|bottom)$/.test(f),q=r.width,k=r.height;if(f=="radial"){var l=r.innerRadius,j=r.outerRadius;if(l==null){l=0}if(j==null){j=Math.min(q,k)/2}}function m(h){return h.parentNode?(h.depth*(j-l)+l):0}function d(h){return(h.parentNode?(h.breadth-0.25)*2*Math.PI:0)}function p(h){switch(f){case"left":return h.depth*q;case"right":return q-h.depth*q;case"top":return h.breadth*q;case"bottom":return q-h.breadth*q;case"radial":return q/2+m(h)*Math.cos(h.midAngle)}}function o(h){switch(f){case"left":return h.breadth*k;case"right":return k-h.breadth*k;case"top":return h.depth*k;case"bottom":return k-h.depth*k;case"radial":return k/2+m(h)*Math.sin(h.midAngle)}}for(var g=0;g<a.length;g++){var c=a[g];c.midAngle=f=="radial"?d(c):b?Math.PI/2:0;c.x=p(c);c.y=o(c);if(c.firstChild){c.midAngle+=Math.PI}}}};pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(a){return a.dx}).height(function(a){return a.dy}).innerRadius(function(a){return a.innerRadius}).outerRadius(function(a){return a.outerRadius}).startAngle(function(a){return a.startAngle}).angle(function(a){return a.angle});this.label.textAlign("center").left(function(a){return a.x+(a.dx/2)}).top(function(a){return a.y+(a.dy/2)});delete this.link},buildImplied:function(m){var p=m.nodes,g=m.orient,z=/^(top|bottom)$/.test(g),k=m.width,u=m.height,A=-p[0].minDepth;if(g=="radial"){var a=m.innerRadius,c=m.outerRadius;if(a==null){a=0}if(a){A*=2}if(c==null){c=Math.min(k,u)/2}}function B(i,h){return(i+h)/(1+h)}function f(h){switch(g){case"left":return B(h.minDepth,A)*k;case"right":return(1-B(h.maxDepth,A))*k;case"top":return h.minBreadth*k;case"bottom":return(1-h.maxBreadth)*k;case"radial":return k/2}}function d(h){switch(g){case"left":return h.minBreadth*u;case"right":return(1-h.maxBreadth)*u;case"top":return B(h.minDepth,A)*u;case"bottom":return(1-B(h.maxDepth,A))*u;case"radial":return u/2}}function l(h){switch(g){case"left":case"right":return(h.maxDepth-h.minDepth)/(1+A)*k;case"top":case"bottom":return(h.maxBreadth-h.minBreadth)*k;case"radial":return h.parentNode?(h.innerRadius+h.outerRadius)*Math.cos(h.midAngle):0}}function j(h){switch(g){case"left":case"right":return(h.maxBreadth-h.minBreadth)*u;case"top":case"bottom":return(h.maxDepth-h.minDepth)/(1+A)*u;case"radial":return h.parentNode?(h.innerRadius+h.outerRadius)*Math.sin(h.midAngle):0}}function b(h){return Math.max(0,B(h.minDepth,A/2))*(c-a)+a}function q(h){return B(h.maxDepth,A/2)*(c-a)+a}function r(h){return(h.parentNode?h.minBreadth-0.25:0)*2*Math.PI}function v(h){return(h.parentNode?h.maxBreadth-h.minBreadth:1)*2*Math.PI}for(var t=0;t<p.length;t++){var o=p[t];o.x=f(o);o.y=d(o);if(g=="radial"){o.innerRadius=b(o);o.outerRadius=q(o);o.startAngle=r(o);o.angle=v(o);o.midAngle=o.startAngle+o.angle/2}else{o.midAngle=z?-Math.PI/2:0}o.dx=l(o);o.dy=j(o)}}};pv.Layout.Grid=function(){pv.Layout.call(this);var a=this;(this.cell=new pv.Mark().data(function(){return a.scene[a.index].$grid}).width(function(){return a.width()/a.cols()}).height(function(){return a.height()/a.rows()}).left(function(){return this.width()*(this.index%a.cols())}).top(function(){return this.height()*Math.floor(this.index/a.cols())})).parent=this};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");
pv.Layout.Grid.prototype.defaults=new pv.Layout.Grid().extend(pv.Layout.prototype.defaults).rows(1).cols(1);pv.Layout.Grid.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);var b=a.rows,d=a.cols;if(typeof d=="object"){b=pv.transpose(d)}if(typeof b=="object"){a.$grid=pv.blend(b);a.rows=b.length;a.cols=b[0]?b[0].length:0}else{a.$grid=pv.repeat([a.data],b*d)}};pv.Layout.Stack=function(){pv.Layout.call(this);var f=this,c=function(){return null},g={t:c,l:c,r:c,b:c,w:c,h:c},a,d=f.buildImplied;function b(h){return function(){return g[h](this.parent.index,this.index)}}this.buildImplied=function(H){d.call(this,H);var W=H.layers,M=W.length,O,C=H.orient,U=/^(top|bottom)\b/.test(C),T=this.parent[U?"height":"width"](),B=[],A=[],D=[];var t=pv.Mark.stack,L={parent:{parent:this}};t.unshift(null);a=[];for(var S=0;S<M;S++){D[S]=[];A[S]=[];L.parent.index=S;t[0]=W[S];a[S]=this.$values.apply(L.parent,t);if(!S){O=a[S].length}t.unshift(null);for(var Q=0;Q<O;Q++){t[0]=a[S][Q];L.index=Q;if(!S){B[Q]=this.$x.apply(L,t)}D[S][Q]=this.$y.apply(L,t)}t.shift()}t.shift();var u;switch(H.order){case"inside-out":var R=D.map(function(h){return pv.max.index(h)}),V=pv.range(M).sort(function(i,h){return R[i]-R[h]}),F=D.map(function(h){return pv.sum(h)}),J=0,w=0,v=[],N=[];for(var S=0;S<M;S++){var Q=V[S];if(J<w){J+=F[Q];v.push(Q)}else{w+=F[Q];N.push(Q)}}u=N.reverse().concat(v);break;case"reverse":u=pv.range(M-1,-1,-1);break;default:u=pv.range(M);break}switch(H.offset){case"silohouette":for(var Q=0;Q<O;Q++){var L=0;for(var S=0;S<M;S++){L+=D[S][Q]}A[u[0]][Q]=(T-L)/2}break;case"wiggle":var L=0;for(var S=0;S<M;S++){L+=D[S][0]}A[u[0]][0]=L=(T-L)/2;for(var Q=1;Q<O;Q++){var r=0,q=0,E=B[Q]-B[Q-1];for(var S=0;S<M;S++){r+=D[S][Q]}for(var S=0;S<M;S++){var l=(D[u[S]][Q]-D[u[S]][Q-1])/(2*E);for(var P=0;P<S;P++){l+=(D[u[P]][Q]-D[u[P]][Q-1])/E}q+=l*D[u[S]][Q]}A[u[0]][Q]=L-=r?q/r*E:0}break;case"expand":for(var Q=0;Q<O;Q++){A[u[0]][Q]=0;var P=0;for(var S=0;S<M;S++){P+=D[S][Q]}if(P){P=T/P;for(var S=0;S<M;S++){D[S][Q]*=P}}else{P=T/M;for(var S=0;S<M;S++){D[S][Q]=P}}}break;default:for(var Q=0;Q<O;Q++){A[u[0]][Q]=0}break}for(var Q=0;Q<O;Q++){var L=A[u[0]][Q];for(var S=1;S<M;S++){L+=D[u[S-1]][Q];A[u[S]][Q]=L}}var S=C.indexOf("-"),z=U?"h":"w",I=S<0?(U?"l":"b"):C.charAt(S+1),G=C.charAt(0);for(var K in g){g[K]=c}g[I]=function(k,h){return B[h]};g[G]=function(k,h){return A[k][h]};g[z]=function(k,h){return D[k][h]}};this.layer=new pv.Mark().data(function(){return a[this.parent.index]}).top(b("t")).left(b("l")).right(b("r")).bottom(b("b")).width(b("w")).height(b("h"));this.layer.add=function(h){return f.add(pv.Panel).data(function(){return f.layers()}).add(h).extend(this)}};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");pv.Layout.Stack.prototype.defaults=new pv.Layout.Stack().extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);pv.Layout.Stack.prototype.$x=pv.Layout.Stack.prototype.$y=function(){return 0};pv.Layout.Stack.prototype.x=function(a){this.$x=pv.functor(a);return this};pv.Layout.Stack.prototype.y=function(a){this.$y=pv.functor(a);return this};pv.Layout.Stack.prototype.$values=pv.identity;pv.Layout.Stack.prototype.values=function(a){this.$values=pv.functor(a);return this};pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(a){return a.dx}).height(function(a){return a.dy});this.label.visible(function(a){return !a.firstChild}).left(function(a){return a.x+(a.dx/2)}).top(function(a){return a.y+(a.dy/2)}).textAlign("center").textAngle(function(a){return a.dx>a.dy?0:-Math.PI/2});(this.leaf=new pv.Mark().extend(this.node).fillStyle(null).strokeStyle(null).visible(function(a){return !a.firstChild})).parent=this;delete this.link};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String);
pv.Layout.Treemap.prototype.defaults=new pv.Layout.Treemap().extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");pv.Layout.Treemap.prototype.padding=function(a){return this.paddingLeft(a).paddingRight(a).paddingTop(a).paddingBottom(a)};pv.Layout.Treemap.prototype.$size=function(a){return Number(a.nodeValue)};pv.Layout.Treemap.prototype.size=function(a){this.$size=pv.functor(a);return this};pv.Layout.Treemap.prototype.buildImplied=function(p){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,p)){return}var g=this,b=p.nodes,j=b[0],k=pv.Mark.stack,c=p.paddingLeft,m=p.paddingRight,i=p.paddingTop,a=p.paddingBottom,o=function(q){return q.size},n=p.round?Math.round:Number,f=p.mode;function l(C,u,q,A,z,B,t){for(var s=0,v=0;s<C.length;s++){var r=C[s];if(q){r.x=A+v;r.y=z;v+=r.dx=n(B*r.size/u);r.dy=t}else{r.x=A;r.y=z+v;r.dx=B;v+=r.dy=n(t*r.size/u)}}if(r){if(q){r.dx+=B-v}else{r.dy+=t-v}}}function h(x,q){var y=-Infinity,t=Infinity,v=0;for(var u=0;u<x.length;u++){var w=x[u].size;if(w<t){t=w}if(w>y){y=w}v+=w}v=v*v;q=q*q;return Math.max(q*y/v,v/(q*t))}function d(s,v){var D=s.x+c,C=s.y+i,E=s.dx-c-m,A=s.dy-i-a;if(f!="squarify"){l(s.childNodes,s.size,f=="slice"?true:f=="dice"?false:v&1,D,C,E,A);return}var F=[],B=Infinity,t=Math.min(E,A),u=E*A/s.size;if(s.size<=0){return}s.visitBefore(function(w){w.size*=u});function z(G){var w=E==t,x=pv.sum(G,o),y=t?n(x/t):0;l(G,x,w,D,C,w?E:y,w?y:A);if(w){C+=y;A-=y}else{D+=y;E-=y}t=Math.min(E,A);return w}var r=s.childNodes.slice();while(r.length){var q=r[r.length-1];if(!q.size){r.pop();continue}F.push(q);var u=h(F,t);if(u<=B){r.pop();B=u}else{F.pop();z(F);F.length=0;B=Infinity}}if(z(F)){for(var v=0;v<F.length;v++){F[v].dy+=A}}else{for(var v=0;v<F.length;v++){F[v].dx+=E}}}k.unshift(null);j.visitAfter(function(r,q){r.depth=q;r.x=r.y=r.dx=r.dy=0;r.size=r.firstChild?pv.sum(r.childNodes,function(s){return s.size}):g.$size.apply(g,(k[0]=r,k))});k.shift();switch(p.order){case"ascending":j.sort(function(r,q){return r.size-q.size});break;case"descending":j.sort(function(r,q){return q.size-r.size});break;case"reverse":j.reverse();break}j.x=0;j.y=0;j.dx=p.width;j.dy=p.height;j.visitBefore(d)};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=new pv.Layout.Tree().extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");pv.Layout.Tree.prototype.buildImplied=function(l){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,l)){return}var o=l.nodes,i=l.orient,z=l.depth,k=l.breadth,b=l.group,j=l.width,t=l.height;function u(w){var s,y,h;if(!w.firstChild){if(s=w.previousSibling){w.prelim=s.prelim+a(w.depth,true)}}else{s=w.firstChild;y=w.lastChild;h=s;for(var B=s;B;B=B.nextSibling){u(B);h=n(B,h)}g(w);var x=0.5*(s.prelim+y.prelim);if(s=w.previousSibling){w.prelim=s.prelim+a(w.depth,true);w.mod=w.prelim-x}else{w.prelim=x}}}function p(s,h,w){s.breadth=s.prelim+h;h+=s.mod;for(var x=s.firstChild;x;x=x.nextSibling){p(x,h,w)}}function n(K,I){var J=K.previousSibling;if(J){var y=K,x=K,C=J,B=K.parentNode.firstChild,E=y.mod,D=x.mod,G=C.mod,F=B.mod,H=A(C),h=r(y);while(H&&h){C=H;y=h;B=r(B);x=A(x);x.ancestor=K;var s=(C.prelim+G)-(y.prelim+E)+a(C.depth,false);if(s>0){m(v(C,K,I),K,s);E+=s;D+=s}G+=C.mod;E+=y.mod;F+=B.mod;D+=x.mod;H=A(C);h=r(y)}if(H&&!A(x)){x.thread=H;x.mod+=G-D}if(h&&!r(B)){B.thread=h;B.mod+=E-F;I=K}}return I}function r(h){return h.firstChild||h.thread}function A(h){return h.lastChild||h.thread}function m(w,s,h){var x=s.number-w.number;s.change-=h/x;s.shift+=h;w.change+=h/x;s.prelim+=h;s.mod+=h}function g(s){var h=0,x=0;for(var w=s.lastChild;w;w=w.previousSibling){w.prelim+=h;w.mod+=h;x+=w.change;h+=w.shift+x}}function v(w,s,h){return(w.ancestor.parentNode==s.parentNode)?w.ancestor:h}function a(s,h){return(h?1:(b+1))/((i=="radial")?s:1)}var q=o[0];q.visitAfter(function(h,s){h.ancestor=h;
h.prelim=0;h.mod=0;h.change=0;h.shift=0;h.number=h.previousSibling?(h.previousSibling.number+1):0;h.depth=s});u(q);p(q,-q.prelim,0);function f(h){return(i=="radial")?h.breadth/z:0}function d(h){switch(i){case"left":return h.depth;case"right":return j-h.depth;case"top":case"bottom":return h.breadth+j/2;case"radial":return j/2+h.depth*Math.cos(f(h))}}function c(h){switch(i){case"left":case"right":return h.breadth+t/2;case"top":return h.depth;case"bottom":return t-h.depth;case"radial":return t/2+h.depth*Math.sin(f(h))}}q.visitAfter(function(h){h.breadth*=k;h.depth*=z;h.midAngle=f(h);h.x=d(h);h.y=c(h);if(h.firstChild){h.midAngle+=Math.PI}delete h.breadth;delete h.depth;delete h.ancestor;delete h.prelim;delete h.mod;delete h.change;delete h.shift;delete h.number;delete h.thread})};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=new pv.Layout.Indent().extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);pv.Layout.Indent.prototype.buildImplied=function(c){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,c)){return}var b=c.nodes,h=c.breadth,g=c.depth,f=0,d=0;function a(l,k,i){l.x=f+i++*g;l.y=d+k++*h;l.midAngle=0;for(var j=l.firstChild;j;j=j.nextSibling){k=a(j,k,i)}return k}a(b[0],1,1)};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.radius(function(a){return a.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=new pv.Layout.Pack().extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1};pv.Layout.Pack.prototype.size=function(a){this.$radius=typeof a=="function"?function(){return Math.sqrt(a.apply(this,arguments))}:(a=Math.sqrt(a),function(){return a});return this};pv.Layout.Pack.prototype.buildImplied=function(o){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,o)){return}var j=this,a=o.nodes,l=a[0];function g(k){var h=pv.Mark.stack;h.unshift(null);for(var p=0,r=k.length;p<r;p++){var q=k[p];if(!q.firstChild){q.radius=j.$radius.apply(j,(h[0]=q,h))}}h.shift()}function n(p){var h=[];for(var k=p.firstChild;k;k=k.nextSibling){if(k.firstChild){k.radius=n(k)}k.n=k.p=k;h.push(k)}switch(o.order){case"ascending":h.sort(function(r,q){return r.radius-q.radius});break;case"descending":h.sort(function(r,q){return q.radius-r.radius});break;case"reverse":h.reverse();break}return f(h)}function f(A){var E=Infinity,I=-Infinity,h=Infinity,u=-Infinity,H,G,F,C,B;function q(k){E=Math.min(k.x-k.radius,E);I=Math.max(k.x+k.radius,I);h=Math.min(k.y-k.radius,h);u=Math.max(k.y+k.radius,u)}function r(K,k){var L=K.n;K.n=k;k.p=K;k.n=L;L.p=k}function J(K,k){K.n=k;k.p=K}function s(L,k){var M=k.x-L.x,K=k.y-L.y,N=L.radius+k.radius;return(N*N-M*M-K*K)>0.001}H=A[0];H.x=-H.radius;H.y=0;q(H);if(A.length>1){G=A[1];G.x=G.radius;G.y=0;q(G);if(A.length>2){F=A[2];d(H,G,F);q(F);r(H,F);H.p=F;r(F,G);G=H.n;for(var D=3;D<A.length;D++){d(H,G,F=A[D]);var p=0,v=1,t=1;for(C=G.n;C!=G;C=C.n,v++){if(s(C,F)){p=1;break}}if(p==1){for(B=H.p;B!=C.p;B=B.p,t++){if(s(B,F)){if(t<v){p=-1;C=B}break}}}if(p==0){r(H,F);G=F;q(F)}else{if(p>0){J(H,C);G=C;D--}else{if(p<0){J(C,G);H=C;D--}}}}}}var x=(E+I)/2,w=(h+u)/2,y=0;for(var D=0;D<A.length;D++){var z=A[D];z.x-=x;z.y-=w;y=Math.max(y,z.radius+Math.sqrt(z.x*z.x+z.y*z.y))}return y+o.spacing}function d(t,r,q){var z=r.radius+q.radius,w=t.radius+q.radius,A=r.x-t.x,y=r.y-t.y,v=Math.sqrt(A*A+y*y),u=(w*w+v*v-z*z)/(2*w*v),k=Math.acos(u),s=u*w,p=Math.sin(k)*w;A/=v;y/=v;q.x=t.x+s*A+p*y;q.y=t.y+s*y-p*A}function b(s,h,r,p){for(var q=s.firstChild;q;q=q.nextSibling){q.x+=s.x;q.y+=s.y;b(q,h,r,p)}s.x=h+p*s.x;s.y=r+p*s.y;s.radius*=p}g(a);l.x=0;l.y=0;l.radius=n(l);
var m=this.width(),i=this.height(),c=1/Math.max(2*l.radius/m,2*l.radius/i);b(l,m/2,i/2,c)};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(b,a){return Math.sqrt(a.linkValue)*1.5});this.label.textAlign("center")};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=new pv.Layout.Force().extend(pv.Layout.Network.prototype.defaults).dragConstant(0.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(0.9).springConstant(0.1).springDamping(0.3).springLength(20);pv.Layout.Force.prototype.buildImplied=function(t){if(pv.Layout.Network.prototype.buildImplied.call(this,t)){var m=t.$force;if(m){m.next=this.binds.$force;this.binds.$force=m}return}var o=this,a=t.nodes,r=t.links,g=t.iterations,q=t.width,l=t.height;for(var j=0,c;j<a.length;j++){c=a[j];if(isNaN(c.x)){c.x=q/2+40*Math.random()-20}if(isNaN(c.y)){c.y=l/2+40*Math.random()-20}}var p=pv.simulation(a);p.force(pv.Force.drag(t.dragConstant));p.force(pv.Force.charge(t.chargeConstant).domain(t.chargeMinDistance,t.chargeMaxDistance).theta(t.chargeTheta));p.force(pv.Force.spring(t.springConstant).damping(t.springDamping).length(t.springLength).links(r));p.constraint(pv.Constraint.position());if(t.bound){p.constraint(pv.Constraint.bound().x(6,q-6).y(6,l-6))}function d(f){return f.fix?1:f.vx*f.vx+f.vy*f.vy}if(g==null){p.step();p.step();var b=t.$force=this.binds.$force={next:this.binds.$force,nodes:a,min:0.0001*(r.length+1),sim:p};if(!this.$timer){this.$timer=setInterval(function(){var h=false;for(var i=o.binds.$force;i;i=i.next){if(pv.max(i.nodes,d)>i.min){i.sim.step();h=true}}if(h){o.render()}},42)}}else{for(var j=0;j<g;j++){p.step()}}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var a,b=this.buildImplied;this.buildImplied=function(c){b.call(this,c);a=/^(top|bottom)$/.test(c.orient)?"step-before":/^(left|right)$/.test(c.orient)?"step-after":"linear"};this.link.interpolate(function(){return a})};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=new pv.Layout.Cluster().extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");pv.Layout.Cluster.prototype.buildImplied=function(c){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,c)){return}var a=c.nodes[0],g=c.group,i,h,f=0,b=0.5-g/2;var d=undefined;a.visitAfter(function(j){if(j.firstChild){j.depth=1+pv.max(j.childNodes,function(k){return k.depth})}else{if(g&&(d!=j.parentNode)){d=j.parentNode;f+=g}f++;j.depth=0}});i=1/f;h=1/a.depth;var d=undefined;a.visitAfter(function(j){if(j.firstChild){j.breadth=pv.mean(j.childNodes,function(k){return k.breadth})}else{if(g&&(d!=j.parentNode)){d=j.parentNode;b+=g}j.breadth=i*b++}j.depth=1-j.depth*h});a.visitAfter(function(j){j.minBreadth=j.firstChild?j.firstChild.minBreadth:(j.breadth-i/2);j.maxBreadth=j.firstChild?j.lastChild.maxBreadth:(j.breadth+i/2)});a.visitBefore(function(j){j.minDepth=j.parentNode?j.parentNode.maxDepth:0;j.maxDepth=j.parentNode?(j.depth+a.depth):(j.minDepth+2*a.depth)});a.minDepth=-h;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,c)};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(a){if(pv.Layout.Cluster.prototype.buildImplied.call(this,a)){return}pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);
pv.Layout.Partition.prototype.defaults=new pv.Layout.Partition().extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1};pv.Layout.Partition.prototype.size=function(a){this.$size=a;return this};pv.Layout.Partition.prototype.buildImplied=function(c){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,c)){return}var d=this,b=c.nodes[0],a=pv.Mark.stack,g=0;a.unshift(null);b.visitAfter(function(j,h){if(h>g){g=h}j.size=j.firstChild?pv.sum(j.childNodes,function(i){return i.size}):d.$size.apply(d,(a[0]=j,a))});a.shift();switch(c.order){case"ascending":b.sort(function(i,h){return i.size-h.size});break;case"descending":b.sort(function(h,i){return i.size-h.size});break}var f=1/g;b.minBreadth=0;b.breadth=0.5;b.maxBreadth=1;b.visitBefore(function(k){var h=k.minBreadth,i=k.maxBreadth-h;for(var j=k.firstChild;j;j=j.nextSibling){j.minBreadth=h;j.maxBreadth=h+=(j.size/k.size)*i;j.breadth=(h+j.minBreadth)/2}});b.visitAfter(function(j,h){j.minDepth=(h-1)*f;j.maxDepth=j.depth=h*f});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,c)};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);pv.Layout.Partition.Fill.prototype.buildImplied=function(a){if(pv.Layout.Partition.prototype.buildImplied.call(this,a)){return}pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var b,d,a,c=this.buildImplied;this.buildImplied=function(f){c.call(this,f);d=f.directed;b=f.orient=="radial"?"linear":"polar";a=f.orient=="right"||f.orient=="top"};this.link.data(function(h){var g=h.sourceNode,f=h.targetNode;return a!=(d||(g.breadth<f.breadth))?[g,f]:[f,g]}).interpolate(function(){return b})};pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=new pv.Layout.Arc().extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(a){this.$sort=a;return this};pv.Layout.Arc.prototype.buildImplied=function(u){if(pv.Layout.Network.prototype.buildImplied.call(this,u)){return}var c=u.nodes,g=u.orient,k=this.$sort,m=pv.range(c.length),t=u.width,l=u.height,a=Math.min(t,l)/2;if(k){m.sort(function(i,h){return k(c[i],c[h])})}function f(h){switch(g){case"top":return -Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return(h-0.25)*2*Math.PI}}function q(h){switch(g){case"top":case"bottom":return h*t;case"left":return 0;case"right":return t;case"radial":return t/2+a*Math.cos(f(h))}}function p(h){switch(g){case"top":return 0;case"bottom":return l;case"left":case"right":return h*l;case"radial":return l/2+a*Math.sin(f(h))}}for(var j=0;j<c.length;j++){var d=c[m[j]],o=d.breadth=(j+0.5)/c.length;d.x=q(o);d.y=p(o);d.midAngle=f(o)}};pv.Layout.Horizon=function(){pv.Layout.call(this);var d=this,f,i,b,h,g,a,c=this.buildImplied;this.buildImplied=function(j){c.call(this,j);f=j.bands;i=j.mode;b=Math.round((i=="color"?0.5:1)*j.height);h=j.backgroundStyle;g=pv.ramp(h,j.negativeStyle).domain(0,f);a=pv.ramp(h,j.positiveStyle).domain(0,f)};var f=new pv.Panel().data(function(){return pv.range(f*2)}).overflow("hidden").height(function(){return b}).top(function(j){return i=="color"?(j&1)*b:0}).fillStyle(function(j){return j?null:h});this.band=new pv.Mark().top(function(k,j){return i=="mirror"&&j&1?(j+1>>1)*b:null}).bottom(function(k,j){return i=="mirror"?(j&1?null:(j+1>>1)*-b):((j&1||-1)*(j+1>>1)*b)}).fillStyle(function(k,j){return(j&1?g:a)((j>>1)+1)});this.band.add=function(j){return d.add(pv.Panel).extend(f).add(j).extend(this)}};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color);pv.Layout.Horizon.prototype.defaults=new pv.Layout.Horizon().extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");
pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var d=this,b,a,c=d.buildImplied;this.buildImplied=function(f){c.call(this,f);b=f.$rollup.nodes;a=f.$rollup.links};this.node.data(function(){return b}).size(function(f){return f.nodes.length*20});this.link.interpolate("polar").eccentricity(0.8);this.link.add=function(f){return d.add(pv.Panel).data(function(){return a}).add(f).extend(this)}};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Rollup.prototype.x=function(a){this.$x=pv.functor(a);return this};pv.Layout.Rollup.prototype.y=function(a){this.$y=pv.functor(a);return this};pv.Layout.Rollup.prototype.buildImplied=function(q){if(pv.Layout.Network.prototype.buildImplied.call(this,q)){return}var v=q.nodes,a=q.links,d=q.directed,u=v.length,k=[],j=[],C=0,w={},b={};function r(n){return k[n]+","+j[n]}var g=pv.Mark.stack,t={parent:this};g.unshift(null);for(var A=0;A<u;A++){t.index=A;g[0]=v[A];k[A]=this.$x.apply(t,g);j[A]=this.$y.apply(t,g)}g.shift();for(var A=0;A<v.length;A++){var m=r(A),l=w[m];if(!l){l=w[m]=pv.extend(v[A]);l.index=C++;l.x=k[A];l.y=j[A];l.nodes=[]}l.nodes.push(v[A])}for(var A=0;A<a.length;A++){var z=a[A].sourceNode,D=a[A].targetNode,B=w[r(z.index)],c=w[r(D.index)],h=!d&&B.index>c.index,f=h?c.index+","+B.index:B.index+","+c.index,p=b[f];if(!p){p=b[f]={sourceNode:B,targetNode:c,linkValue:0,links:[]}}p.links.push(a[A]);p.linkValue+=a[A].linkValue}q.$rollup={nodes:pv.values(w),links:pv.values(b)}};pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var d=this,h,b,a,g,f,c=d.buildImplied;this.buildImplied=function(i){c.call(this,i);h=i.nodes.length;b=i.width/h;a=i.height/h;g=i.$matrix.labels;f=i.$matrix.pairs};this.link.data(function(){return f}).left(function(){return b*(this.index%h)}).top(function(){return a*Math.floor(this.index/h)}).width(function(){return b}).height(function(){return a}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(i){return i.linkValue?"#555":"#eee"}).parent=this;delete this.link.add;this.label.data(function(){return g}).left(function(){return this.index&1?b*((this.index>>1)+0.5):null}).top(function(){return this.index&1?null:a*((this.index>>1)+0.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0});delete this.node};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(a){this.$sort=a;return this};pv.Layout.Matrix.prototype.buildImplied=function(f){if(pv.Layout.Network.prototype.buildImplied.call(this,f)){return}var k=f.nodes,c=f.links,v=this.$sort,h=k.length,d=pv.range(h),u=[],A=[],y={};f.$matrix={labels:u,pairs:A};if(v){d.sort(function(j,i){return v(k[j],k[i])})}for(var t=0;t<h;t++){for(var r=0;r<h;r++){var x=d[t],w=d[r],g={row:t,col:r,sourceNode:k[x],targetNode:k[w],linkValue:0};A.push(y[x+"."+w]=g)}}for(var t=0;t<h;t++){var x=d[t];u.push(k[x],k[x])}for(var t=0;t<c.length;t++){var q=c[t],m=q.sourceNode.index,z=q.targetNode.index,o=q.linkValue;y[m+"."+z].linkValue+=o;if(!f.directed){y[z+"."+m].linkValue+=o}}};pv.Layout.Bullet=function(){pv.Layout.call(this);var g=this,f=g.buildImplied,h=g.x=pv.Scale.linear(),c,b,i,d,a;this.buildImplied=function(j){f.call(this,a=j);c=j.orient;b=/^left|right$/.test(c);i=pv.ramp("#bbb","#eee").domain(0,Math.max(1,a.ranges.length-1));d=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,a.measures.length-1))};(this.range=new pv.Mark()).data(function(){return a.ranges}).reverse(true).left(function(){return c=="left"?0:null}).top(function(){return c=="top"?0:null}).right(function(){return c=="right"?0:null}).bottom(function(){return c=="bottom"?0:null}).width(function(j){return b?h(j):null}).height(function(j){return b?null:h(j)}).fillStyle(function(){return i(this.index)}).antialias(false).parent=g;(this.measure=new pv.Mark()).extend(this.range).data(function(){return a.measures}).left(function(){return c=="left"?0:b?null:this.parent.width()/3.25}).top(function(){return c=="top"?0:b?this.parent.height()/3.25:null
}).right(function(){return c=="right"?0:b?null:this.parent.width()/3.25}).bottom(function(){return c=="bottom"?0:b?this.parent.height()/3.25:null}).fillStyle(function(){return d(this.index)}).parent=g;(this.marker=new pv.Mark()).data(function(){return a.markers}).left(function(j){return c=="left"?h(j):b?null:this.parent.width()/2}).top(function(j){return c=="top"?h(j):b?this.parent.height()/2:null}).right(function(j){return c=="right"?h(j):null}).bottom(function(j){return c=="bottom"?h(j):null}).strokeStyle("black").shape("bar").angle(function(){return b?0:Math.PI/2}).parent=g;(this.tick=new pv.Mark()).data(function(){return h.ticks(7)}).left(function(j){return c=="left"?h(j):null}).top(function(j){return c=="top"?h(j):null}).right(function(j){return c=="right"?h(j):b?null:-6}).bottom(function(j){return c=="bottom"?h(j):b?-8:null}).height(function(){return b?6:null}).width(function(){return b?null:6}).parent=g};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number);pv.Layout.Bullet.prototype.defaults=new pv.Layout.Bullet().extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);pv.Layout.Bullet.prototype.buildImplied=function(b){pv.Layout.prototype.buildImplied.call(this,b);var a=this.parent[/^left|right$/.test(b.orient)?"width":"height"]();b.maximum=b.maximum||pv.max([].concat(b.ranges,b.markers,b.measures));this.x.domain(0,b.maximum).range(0,a)};pv.Behavior={};pv.Behavior.drag=function(){var g,c,f,i,a;function b(k){c=this.index;g=this.scene;var j=this.mouse();i=((f=k).fix=pv.vector(k.x,k.y)).minus(j);a={x:this.parent.width()-(k.dx||0),y:this.parent.height()-(k.dy||0)};g.mark.context(g,c,function(){this.render()});pv.Mark.dispatch("dragstart",g,c)}function d(){if(!g){return}g.mark.context(g,c,function(){var j=this.mouse();f.x=f.fix.x=Math.max(0,Math.min(i.x+j.x,a.x));f.y=f.fix.y=Math.max(0,Math.min(i.y+j.y,a.y));this.render()});pv.Mark.dispatch("drag",g,c)}function h(){if(!g){return}f.fix=null;g.mark.context(g,c,function(){this.render()});pv.Mark.dispatch("dragend",g,c);g=null}pv.listen(window,"mousemove",d);pv.listen(window,"mouseup",h);return b};pv.Behavior.point=function(a){var i,h=null,g=1,f=1,b=arguments.length?a*a:900;function j(w,x){var E=w[x],z={cost:Infinity};for(var u=0,o=E.visible&&E.children.length;u<o;u++){var l=E.children[u],r=l.mark,k;if(r.type=="panel"){r.scene=l;for(var t=0,q=l.length;t<q;t++){r.index=t;k=j(l,t);if(k.cost<z.cost){z=k}}delete r.scene;delete r.index}else{if(r.$handlers.point){var B=r.mouse();for(var t=0,q=l.length;t<q;t++){var y=l[t],D=B.x-y.left-(y.width||0)/2,C=B.y-y.top-(y.height||0)/2,A=g*D*D+f*C*C;if(A<z.cost){z.distance=D*D+C*C;z.cost=A;z.scene=l;z.index=t}}}}}return z}function d(){var k=j(this.scene,this.index);if((k.cost==Infinity)||(k.distance>b)){k=null}if(i){if(k&&(i.scene==k.scene)&&(i.index==k.index)){return}pv.Mark.dispatch("unpoint",i.scene,i.index)}if(i=k){pv.Mark.dispatch("point",k.scene,k.index);pv.listen(this.root.canvas(),"mouseout",c)}}function c(k){if(i&&!pv.ancestor(this,k.relatedTarget)){pv.Mark.dispatch("unpoint",i.scene,i.index);i=null}}d.collapse=function(k){if(arguments.length){h=String(k);switch(h){case"y":g=1;f=0;break;case"x":g=0;f=1;break;default:g=1;f=1;break}return d}return h};return d};pv.Behavior.select=function(){var g,c,f,b;function a(i){c=this.index;g=this.scene;b=this.mouse();f=i;f.x=b.x;f.y=b.y;f.dx=f.dy=0;pv.Mark.dispatch("selectstart",g,c)}function d(){if(!g){return}g.mark.context(g,c,function(){var i=this.mouse();f.x=Math.max(0,Math.min(b.x,i.x));f.y=Math.max(0,Math.min(b.y,i.y));f.dx=Math.min(this.width(),Math.max(i.x,b.x))-f.x;f.dy=Math.min(this.height(),Math.max(i.y,b.y))-f.y;this.render()});pv.Mark.dispatch("select",g,c)}function h(){if(!g){return}pv.Mark.dispatch("selectend",g,c);g=null}pv.listen(window,"mousemove",d);pv.listen(window,"mouseup",h);return a};pv.Behavior.resize=function(d){var h,c,g,b;function a(j){c=this.index;
h=this.scene;b=this.mouse();g=j;switch(d){case"left":b.x=g.x+g.dx;break;case"right":b.x=g.x;break;case"top":b.y=g.y+g.dy;break;case"bottom":b.y=g.y;break}pv.Mark.dispatch("resizestart",h,c)}function f(){if(!h){return}h.mark.context(h,c,function(){var j=this.mouse();g.x=Math.max(0,Math.min(b.x,j.x));g.y=Math.max(0,Math.min(b.y,j.y));g.dx=Math.min(this.parent.width(),Math.max(j.x,b.x))-g.x;g.dy=Math.min(this.parent.height(),Math.max(j.y,b.y))-g.y;this.render()});pv.Mark.dispatch("resize",h,c)}function i(){if(!h){return}pv.Mark.dispatch("resizeend",h,c);h=null}pv.listen(window,"mousemove",f);pv.listen(window,"mouseup",i);return a};pv.Behavior.pan=function(){var f,h,j,i,c,b;function a(){h=this.index;f=this.scene;i=pv.vector(pv.event.pageX,pv.event.pageY);j=this.transform();c=1/(j.k*this.scale);if(b){b={x:(1-j.k)*this.width(),y:(1-j.k)*this.height()}}}function g(){if(!f){return}f.mark.context(f,h,function(){var l=(pv.event.pageX-i.x)*c,n=(pv.event.pageY-i.y)*c,k=j.translate(l,n);if(b){k.x=Math.max(b.x,Math.min(0,k.x));k.y=Math.max(b.y,Math.min(0,k.y))}this.transform(k).render()});pv.Mark.dispatch("pan",f,h)}function d(){f=null}a.bound=function(k){if(arguments.length){b=Boolean(k);return this}return Boolean(b)};pv.listen(window,"mousemove",g);pv.listen(window,"mouseup",d);return a};pv.Behavior.zoom=function(c){var b;if(!arguments.length){c=1/48}function a(){var g=this.mouse(),f=pv.event.wheel*c,d=this.transform().translate(g.x,g.y).scale((f<0)?(1000/(1000-f)):((1000+f)/1000)).translate(-g.x,-g.y);if(b){d.k=Math.max(1,d.k);d.x=Math.max((1-d.k)*this.width(),Math.min(0,d.x));d.y=Math.max((1-d.k)*this.height(),Math.min(0,d.y))}this.transform(d).render();pv.Mark.dispatch("zoom",this.scene,this.index)}a.bound=function(d){if(arguments.length){b=Boolean(d);return this}return Boolean(b)};return a};pv.Geo=function(){};pv.Geo.projections={mercator:{project:function(a){return{x:a.lng/180,y:a.lat>85?1:a.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(a.lat)/2))/Math.PI}},invert:function(a){return{lng:a.x*180,lat:pv.degrees(2*Math.atan(Math.exp(a.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(a){return{x:a.lng/180,y:Math.sin(pv.radians(a.lat))}},invert:function(a){return{lng:a.x*180,lat:pv.degrees(Math.asin(a.y))}}},sinusoidal:{project:function(a){return{x:pv.radians(a.lng)*Math.cos(pv.radians(a.lat))/Math.PI,y:a.lat/90}},invert:function(a){return{lng:pv.degrees((a.x*Math.PI)/Math.cos(a.y*Math.PI/2)),lat:a.y*90}}},aitoff:{project:function(g){var c=pv.radians(g.lng),d=pv.radians(g.lat),b=Math.acos(Math.cos(d)*Math.cos(c/2));return{x:2*(b?(Math.cos(d)*Math.sin(c/2)*b/Math.sin(b)):0)/Math.PI,y:2*(b?(Math.sin(d)*b/Math.sin(b)):0)/Math.PI}},invert:function(b){var a=b.x*Math.PI/2,c=b.y*Math.PI/2;return{lng:pv.degrees(a/Math.cos(c)),lat:pv.degrees(c)}}},hammer:{project:function(g){var a=pv.radians(g.lng),b=pv.radians(g.lat),d=Math.sqrt(1+Math.cos(b)*Math.cos(a/2));return{x:2*Math.SQRT2*Math.cos(b)*Math.sin(a/2)/d/3,y:Math.SQRT2*Math.sin(b)/d/1.5}},invert:function(b){var a=b.x*3,d=b.y*1.5,c=Math.sqrt(1-a*a/16-d*d/4);return{lng:pv.degrees(2*Math.atan2(c*a,2*(2*c*c-1))),lat:pv.degrees(Math.asin(c*d))}}},identity:{project:function(a){return{x:a.lng/180,y:a.lat/90}},invert:function(a){return{lng:a.x*180,lat:a.y*90}}}};pv.Geo.scale=function(b){var i={x:0,y:0},r={x:1,y:1},h=[],g=pv.Geo.projections.identity,n=pv.Scale.linear(-1,1).range(0,1),l=pv.Scale.linear(-1,1).range(1,0),k={lng:0,lat:0},q,m;function f(d){if(!q||(d.lng!=q.lng)||(d.lat!=q.lat)){q=d;var c=o(d);m={x:n(c.x),y:l(c.y)}}return m}function o(d){var c={lng:d.lng-k.lng,lat:d.lat};return g.project(c)}function a(c){var d=g.invert(c);d.lng+=k.lng;return d}f.x=function(c){return f(c).x};f.y=function(c){return f(c).y};f.ticks={lng:function(c){var p,d;if(h.length>1){var j=pv.Scale.linear();if(c==undefined){c=10}p=j.domain(h,function(s){return s.lat}).ticks(c);d=j.domain(h,function(s){return s.lng}).ticks(c)}else{p=pv.range(-80,81,10);d=pv.range(-180,181,10)}return d.map(function(s){return p.map(function(t){return{lat:t,lng:s}
})})},lat:function(c){return pv.transpose(f.ticks.lng(c))}};f.invert=function(c){return a({x:n.invert(c.x),y:l.invert(c.y)})};f.domain=function(s,c){if(arguments.length){h=(s instanceof Array)?((arguments.length>1)?pv.map(s,c):s):Array.prototype.slice.call(arguments);if(h.length>1){var d=h.map(function(t){return t.lng});var j=h.map(function(t){return t.lat});k={lng:(pv.max(d)+pv.min(d))/2,lat:(pv.max(j)+pv.min(j))/2};var p=h.map(o);n.domain(p,function(t){return t.x});l.domain(p,function(t){return t.y})}else{k={lng:0,lat:0};n.domain(-1,1);l.domain(-1,1)}q=null;return this}return h};f.range=function(d,c){if(arguments.length){if(typeof d=="object"){i={x:Number(d.x),y:Number(d.y)};r={x:Number(c.x),y:Number(c.y)}}else{i={x:0,y:0};r={x:Number(d),y:Number(c)}}n.range(i.x,r.x);l.range(r.y,i.y);q=null;return this}return[i,r]};f.projection=function(c){if(arguments.length){g=typeof c=="string"?pv.Geo.projections[c]||pv.Geo.projections.identity:c;return this.domain(h)}return c};f.by=function(c){function d(){return f(c.apply(this,arguments))}for(var j in f){d[j]=f[j]}return d};if(arguments.length){f.projection(b)}return f};